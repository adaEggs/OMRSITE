function e(e,t){for(var r=0;r<t.length;r++){const n=t[r];if("string"!=typeof n&&!Array.isArray(n))for(const t in n)if("default"!==t&&!(t in e)){const r=Object.getOwnPropertyDescriptor(n,t);r&&Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:()=>n[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}function t(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}),r}for(var r={},n={},o={byteLength:function(e){var t=f(e),r=t[0],n=t[1];return 3*(r+n)/4-n},toByteArray:function(e){var t,r,n=f(e),o=n[0],i=n[1],a=new u(function(e,t,r){return 3*(t+r)/4-r}(0,o,i)),c=0,h=i>0?o-4:o;for(r=0;r<h;r+=4)t=s[e.charCodeAt(r)]<<18|s[e.charCodeAt(r+1)]<<12|s[e.charCodeAt(r+2)]<<6|s[e.charCodeAt(r+3)],a[c++]=t>>16&255,a[c++]=t>>8&255,a[c++]=255&t;return 2===i&&(t=s[e.charCodeAt(r)]<<2|s[e.charCodeAt(r+1)]>>4,a[c++]=255&t),1===i&&(t=s[e.charCodeAt(r)]<<10|s[e.charCodeAt(r+1)]<<4|s[e.charCodeAt(r+2)]>>2,a[c++]=t>>8&255,a[c++]=255&t),a},fromByteArray:function(e){for(var t,r=e.length,n=r%3,o=[],s=16383,u=0,a=r-n;u<a;u+=s)o.push(p(e,u,u+s>a?a:u+s));return 1===n?(t=e[r-1],o.push(i[t>>2]+i[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],o.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"=")),o.join("")}},i=[],s=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0;c<64;++c)i[c]=a[c],s[a.charCodeAt(c)]=c;function f(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function h(e){return i[e>>18&63]+i[e>>12&63]+i[e>>6&63]+i[63&e]}function p(e,t,r){for(var n,o=[],i=t;i<r;i+=3)n=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),o.push(h(n));return o.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63;var l={read:function(e,t,r,n,o){var i,s,u=8*o-n-1,a=(1<<u)-1,c=a>>1,f=-7,h=r?o-1:0,p=r?-1:1,l=e[t+h];for(h+=p,i=l&(1<<-f)-1,l>>=-f,f+=u;f>0;i=256*i+e[t+h],h+=p,f-=8);for(s=i&(1<<-f)-1,i>>=-f,f+=n;f>0;s=256*s+e[t+h],h+=p,f-=8);if(0===i)i=1-c;else{if(i===a)return s?NaN:1/0*(l?-1:1);s+=Math.pow(2,n),i-=c}return(l?-1:1)*s*Math.pow(2,i-n)},write:function(e,t,r,n,o,i){var s,u,a,c=8*i-o-1,f=(1<<c)-1,h=f>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,l=n?0:i-1,d=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(u=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(a=Math.pow(2,-s))<1&&(s--,a*=2),(t+=s+h>=1?p/a:p*Math.pow(2,1-h))*a>=2&&(s++,a/=2),s+h>=f?(u=0,s=f):s+h>=1?(u=(t*a-1)*Math.pow(2,o),s+=h):(u=t*Math.pow(2,h-1)*Math.pow(2,o),s=0));o>=8;e[r+l]=255&u,l+=d,u/=256,o-=8);for(s=s<<o|u,c+=o;c>0;e[r+l]=255&s,l+=d,s/=256,c-=8);e[r+l-d]|=128*y}};!function(e){const t=o,r=l,n="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=f,e.SlowBuffer=function(e){return+e!=e&&(e=0),f.alloc(+e)},e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:u,SharedArrayBuffer:a}=globalThis;function c(e){if(e>i)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new s(e);return Object.setPrototypeOf(t,f.prototype),t}function f(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return h(e,t,r)}function h(e,t,r){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!f.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|b(e,t);let n=c(r);const o=n.write(e,t);return o!==r&&(n=n.slice(0,o)),n}(e,t);if(u.isView(e))return function(e){if(J(e,s)){const t=new s(e);return w(t.buffer,t.byteOffset,t.byteLength)}return y(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(J(e,u)||e&&J(e.buffer,u))return w(e,t,r);if(void 0!==a&&(J(e,a)||e&&J(e.buffer,a)))return w(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return f.from(n,t,r);const o=function(e){if(f.isBuffer(e)){const t=0|g(e.length),r=c(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||Q(e.length)?c(0):y(e):"Buffer"===e.type&&Array.isArray(e.data)?y(e.data):void 0}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return f.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function p(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return p(e),c(e<0?0:0|g(e))}function y(e){const t=e.length<0?0:0|g(e.length),r=c(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function w(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new s(e):void 0===r?new s(e,t):new s(e,t,r),Object.setPrototypeOf(n,f.prototype),n}function g(e){if(e>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|e}function b(e,t){if(f.isBuffer(e))return e.length;if(u.isView(e)||J(e,u))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let o=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Y(e).length;default:if(o)return n?-1:z(e).length;t=(""+t).toLowerCase(),o=!0}}function m(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return U(this,t,r);case"utf8":case"utf-8":return k(this,t,r);case"ascii":return x(this,t,r);case"latin1":case"binary":return H(this,t,r);case"base64":return B(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function E(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function S(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),Q(r=+r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=f.from(t,n)),f.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,o);if("number"==typeof t)return t&=255,"function"==typeof s.prototype.indexOf?o?s.prototype.indexOf.call(e,t,r):s.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,o){let i,s=1,u=e.length,a=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,u/=2,a/=2,r/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){let n=-1;for(i=r;i<u;i++)if(c(e,i)===c(t,-1===n?0:i-n)){if(-1===n&&(n=i),i-n+1===a)return n*s}else-1!==n&&(i-=i-n),n=-1}else for(r+a>u&&(r=u-a),i=r;i>=0;i--){let r=!0;for(let n=0;n<a;n++)if(c(e,i+n)!==c(t,n)){r=!1;break}if(r)return i}return-1}function T(e,t,r,n){r=Number(r)||0;const o=e.length-r;n?(n=Number(n))>o&&(n=o):n=o;const i=t.length;let s;for(n>i/2&&(n=i/2),s=0;s<n;++s){const n=parseInt(t.substr(2*s,2),16);if(Q(n))return s;e[r+s]=n}return s}function _(e,t,r,n){return Z(z(t,e.length-r),e,r,n)}function I(e,t,r,n){return Z(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function O(e,t,r,n){return Z(Y(t),e,r,n)}function A(e,t,r,n){return Z(function(e,t){let r,n,o;const i=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,o=r%256,i.push(o),i.push(n);return i}(t,e.length-r),e,r,n)}function B(e,r,n){return 0===r&&n===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(r,n))}function k(e,t,r){r=Math.min(e.length,r);const n=[];let o=t;for(;o<r;){const t=e[o];let i=null,s=t>239?4:t>223?3:t>191?2:1;if(o+s<=r){let r,n,u,a;switch(s){case 1:t<128&&(i=t);break;case 2:r=e[o+1],128==(192&r)&&(a=(31&t)<<6|63&r,a>127&&(i=a));break;case 3:r=e[o+1],n=e[o+2],128==(192&r)&&128==(192&n)&&(a=(15&t)<<12|(63&r)<<6|63&n,a>2047&&(a<55296||a>57343)&&(i=a));break;case 4:r=e[o+1],n=e[o+2],u=e[o+3],128==(192&r)&&128==(192&n)&&128==(192&u)&&(a=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&u,a>65535&&a<1114112&&(i=a))}}null===i?(i=65533,s=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),o+=s}return function(e){const t=e.length;if(t<=P)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=P));return r}(n)}f.TYPED_ARRAY_SUPPORT=function(){try{const e=new s(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,s.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!f.TYPED_ARRAY_SUPPORT&&"undefined"!=typeof console&&console.error,Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}}),f.poolSize=8192,f.from=function(e,t,r){return h(e,t,r)},Object.setPrototypeOf(f.prototype,s.prototype),Object.setPrototypeOf(f,s),f.alloc=function(e,t,r){return function(e,t,r){return p(e),e<=0?c(e):void 0!==t?"string"==typeof r?c(e).fill(t,r):c(e).fill(t):c(e)}(e,t,r)},f.allocUnsafe=function(e){return d(e)},f.allocUnsafeSlow=function(e){return d(e)},f.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==f.prototype},f.compare=function(e,t){if(J(e,s)&&(e=f.from(e,e.offset,e.byteLength)),J(t,s)&&(t=f.from(t,t.offset,t.byteLength)),!f.isBuffer(e)||!f.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},f.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return f.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=f.allocUnsafe(t);let o=0;for(r=0;r<e.length;++r){let t=e[r];if(J(t,s))o+t.length>n.length?(f.isBuffer(t)||(t=f.from(t)),t.copy(n,o)):s.prototype.set.call(n,t,o);else{if(!f.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,o)}o+=t.length}return n},f.byteLength=b,f.prototype._isBuffer=!0,f.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)E(this,t,t+1);return this},f.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)E(this,t,t+3),E(this,t+1,t+2);return this},f.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)E(this,t,t+7),E(this,t+1,t+6),E(this,t+2,t+5),E(this,t+3,t+4);return this},f.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?k(this,0,e):m.apply(this,arguments)},f.prototype.toLocaleString=f.prototype.toString,f.prototype.equals=function(e){if(!f.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===f.compare(this,e)},f.prototype.inspect=function(){let t="";const r=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},n&&(f.prototype[n]=f.prototype.inspect),f.prototype.compare=function(e,t,r,n,o){if(J(e,s)&&(e=f.from(e,e.offset,e.byteLength)),!f.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&t>=r)return 0;if(n>=o)return-1;if(t>=r)return 1;if(this===e)return 0;let i=(o>>>=0)-(n>>>=0),u=(r>>>=0)-(t>>>=0);const a=Math.min(i,u),c=this.slice(n,o),h=e.slice(t,r);for(let s=0;s<a;++s)if(c[s]!==h[s]){i=c[s],u=h[s];break}return i<u?-1:u<i?1:0},f.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},f.prototype.indexOf=function(e,t,r){return S(this,e,t,r,!0)},f.prototype.lastIndexOf=function(e,t,r){return S(this,e,t,r,!1)},f.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const o=this.length-t;if((void 0===r||r>o)&&(r=o),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let i=!1;for(;;)switch(n){case"hex":return T(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":case"latin1":case"binary":return I(this,e,t,r);case"base64":return O(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const P=4096;function x(e,t,r){let n="";r=Math.min(e.length,r);for(let o=t;o<r;++o)n+=String.fromCharCode(127&e[o]);return n}function H(e,t,r){let n="";r=Math.min(e.length,r);for(let o=t;o<r;++o)n+=String.fromCharCode(e[o]);return n}function U(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let o="";for(let i=t;i<r;++i)o+=ee[e[i]];return o}function N(e,t,r){const n=e.slice(t,r);let o="";for(let i=0;i<n.length-1;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}function R(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function C(e,t,r,n,o,i){if(!f.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function L(e,t,r,n,o){W(t,n,o,e,r,7);let i=Number(t&BigInt(4294967295));e[r++]=i,i>>=8,e[r++]=i,i>>=8,e[r++]=i,i>>=8,e[r++]=i;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,r}function F(e,t,r,n,o){W(t,n,o,e,r,7);let i=Number(t&BigInt(4294967295));e[r+7]=i,i>>=8,e[r+6]=i,i>>=8,e[r+5]=i,i>>=8,e[r+4]=i;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=s,s>>=8,e[r+2]=s,s>>=8,e[r+1]=s,s>>=8,e[r]=s,r+8}function V(e,t,r,n,o,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(e,t,n,o,i){return t=+t,n>>>=0,i||V(e,0,n,4),r.write(e,t,n,o,23,4),n+4}function M(e,t,n,o,i){return t=+t,n>>>=0,i||V(e,0,n,8),r.write(e,t,n,o,52,8),n+8}f.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,f.prototype),n},f.prototype.readUintLE=f.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);let n=this[e],o=1,i=0;for(;++i<t&&(o*=256);)n+=this[e+i]*o;return n},f.prototype.readUintBE=f.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);let n=this[e+--t],o=1;for(;t>0&&(o*=256);)n+=this[e+--t]*o;return n},f.prototype.readUint8=f.prototype.readUInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),this[e]},f.prototype.readUint16LE=f.prototype.readUInt16LE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]|this[e+1]<<8},f.prototype.readUint16BE=f.prototype.readUInt16BE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]<<8|this[e+1]},f.prototype.readUint32LE=f.prototype.readUInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},f.prototype.readUint32BE=f.prototype.readUInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},f.prototype.readBigUInt64LE=te(function(e){q(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||X(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,o=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(o)<<BigInt(32))}),f.prototype.readBigUInt64BE=te(function(e){q(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||X(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],o=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(o)}),f.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);let n=this[e],o=1,i=0;for(;++i<t&&(o*=256);)n+=this[e+i]*o;return o*=128,n>=o&&(n-=Math.pow(2,8*t)),n},f.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);let n=t,o=1,i=this[e+--n];for(;n>0&&(o*=256);)i+=this[e+--n]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*t)),i},f.prototype.readInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},f.prototype.readInt16LE=function(e,t){e>>>=0,t||R(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},f.prototype.readInt16BE=function(e,t){e>>>=0,t||R(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},f.prototype.readInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},f.prototype.readInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},f.prototype.readBigInt64LE=te(function(e){q(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||X(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)}),f.prototype.readBigInt64BE=te(function(e){q(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||X(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)}),f.prototype.readFloatLE=function(e,t){return e>>>=0,t||R(e,4,this.length),r.read(this,e,!0,23,4)},f.prototype.readFloatBE=function(e,t){return e>>>=0,t||R(e,4,this.length),r.read(this,e,!1,23,4)},f.prototype.readDoubleLE=function(e,t){return e>>>=0,t||R(e,8,this.length),r.read(this,e,!0,52,8)},f.prototype.readDoubleBE=function(e,t){return e>>>=0,t||R(e,8,this.length),r.read(this,e,!1,52,8)},f.prototype.writeUintLE=f.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||C(this,e,t,r,Math.pow(2,8*r)-1,0);let o=1,i=0;for(this[t]=255&e;++i<r&&(o*=256);)this[t+i]=e/o&255;return t+r},f.prototype.writeUintBE=f.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||C(this,e,t,r,Math.pow(2,8*r)-1,0);let o=r-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+r},f.prototype.writeUint8=f.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,255,0),this[t]=255&e,t+1},f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},f.prototype.writeBigUInt64LE=te(function(e,t=0){return L(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeBigUInt64BE=te(function(e,t=0){return F(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);C(this,e,t,r,n-1,-n)}let o=0,i=1,s=0;for(this[t]=255&e;++o<r&&(i*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/i|0)-s&255;return t+r},f.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);C(this,e,t,r,n-1,-n)}let o=r-1,i=1,s=0;for(this[t+o]=255&e;--o>=0&&(i*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/i|0)-s&255;return t+r},f.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},f.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},f.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},f.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},f.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},f.prototype.writeBigInt64LE=te(function(e,t=0){return L(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),f.prototype.writeBigInt64BE=te(function(e,t=0){return F(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),f.prototype.writeFloatLE=function(e,t,r){return D(this,e,t,!0,r)},f.prototype.writeFloatBE=function(e,t,r){return D(this,e,t,!1,r)},f.prototype.writeDoubleLE=function(e,t,r){return M(this,e,t,!0,r)},f.prototype.writeDoubleBE=function(e,t,r){return M(this,e,t,!1,r)},f.prototype.copy=function(e,t,r,n){if(!f.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const o=n-r;return this===e&&"function"==typeof s.prototype.copyWithin?this.copyWithin(t,r,n):s.prototype.set.call(e,this.subarray(r,n),t),o},f.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!f.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{const i=f.isBuffer(e)?e:f.from(e,n),s=i.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<r-t;++o)this[o+t]=i[o%s]}return this};const K={};function j(e,t,r){K[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function G(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function W(e,t,r,n,o,i){if(e>r||e<t){const r="bigint"==typeof t?"n":"";let n;throw n=0===t||t===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(i+1)}${r}`:`>= -(2${r} ** ${8*(i+1)-1}${r}) and < 2 ** ${8*(i+1)-1}${r}`,new K.ERR_OUT_OF_RANGE("value",n,e)}!function(e,t,r){q(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||X(t,e.length-(r+1))}(n,o,i)}function q(e,t){if("number"!=typeof e)throw new K.ERR_INVALID_ARG_TYPE(t,"number",e)}function X(e,t,r){if(Math.floor(e)!==e)throw q(e,r),new K.ERR_OUT_OF_RANGE("offset","an integer",e);if(t<0)throw new K.ERR_BUFFER_OUT_OF_BOUNDS;throw new K.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${t}`,e)}j("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),j("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),j("ERR_OUT_OF_RANGE",function(e,t,r){let n=`The value of "${e}" is out of range.`,o=r;return Number.isInteger(r)&&Math.abs(r)>2**32?o=G(String(r)):"bigint"==typeof r&&(o=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(o=G(o)),o+="n"),n+=` It must be ${t}. Received ${o}`,n},RangeError);const $=/[^+/0-9A-Za-z-_]/g;function z(e,t){let r;t=t||1/0;const n=e.length;let o=null;const i=[];for(let s=0;s<n;++s){if(r=e.charCodeAt(s),r>55295&&r<57344){if(!o){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function Y(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace($,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Z(e,t,r,n){let o;for(o=0;o<n&&!(o+r>=t.length||o>=e.length);++o)t[o+r]=e[o];return o}function J(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Q(e){return e!=e}const ee=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let o=0;o<16;++o)t[n+o]=e[r]+e[o]}return t}();function te(e){return"undefined"==typeof BigInt?re:e}function re(){throw new Error("BigInt not supported")}}(n);const d=n.Buffer,y=n.Buffer,w=Object.freeze(Object.defineProperty({__proto__:null,Buffer:y,default:d},Symbol.toStringTag,{value:"Module"}));var g={},b={};Object.defineProperty(b,"__esModule",{value:!0}),b.testnet=b.regtest=b.bitcoin=void 0,b.bitcoin={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},b.regtest={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},b.testnet={messagePrefix:"Bitcoin Signed Message:\n",bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239};var m={},E={},S={},v={};Object.defineProperty(v,"__esModule",{value:!0}),v.encode=v.decode=v.check=void 0,v.check=function(e){if(e.length<8)return!1;if(e.length>72)return!1;if(48!==e[0])return!1;if(e[1]!==e.length-2)return!1;if(2!==e[2])return!1;const t=e[3];if(0===t)return!1;if(5+t>=e.length)return!1;if(2!==e[4+t])return!1;const r=e[5+t];return!(0===r||6+t+r!==e.length||128&e[4]||t>1&&0===e[4]&&!(128&e[5])||128&e[t+6]||r>1&&0===e[t+6]&&!(128&e[t+7]))},v.decode=function(e){if(e.length<8)throw new Error("DER sequence length is too short");if(e.length>72)throw new Error("DER sequence length is too long");if(48!==e[0])throw new Error("Expected DER sequence");if(e[1]!==e.length-2)throw new Error("DER sequence length is invalid");if(2!==e[2])throw new Error("Expected DER integer");const t=e[3];if(0===t)throw new Error("R length is zero");if(5+t>=e.length)throw new Error("R length is too long");if(2!==e[4+t])throw new Error("Expected DER integer (2)");const r=e[5+t];if(0===r)throw new Error("S length is zero");if(6+t+r!==e.length)throw new Error("S length is invalid");if(128&e[4])throw new Error("R value is negative");if(t>1&&0===e[4]&&!(128&e[5]))throw new Error("R value excessively padded");if(128&e[t+6])throw new Error("S value is negative");if(r>1&&0===e[t+6]&&!(128&e[t+7]))throw new Error("S value excessively padded");return{r:e.slice(4,4+t),s:e.slice(6+t)}},v.encode=function(e,t){const r=e.length,n=t.length;if(0===r)throw new Error("R length is zero");if(0===n)throw new Error("S length is zero");if(r>33)throw new Error("R length is too long");if(n>33)throw new Error("S length is too long");if(128&e[0])throw new Error("R value is negative");if(128&t[0])throw new Error("S value is negative");if(r>1&&0===e[0]&&!(128&e[1]))throw new Error("R value excessively padded");if(n>1&&0===t[0]&&!(128&t[1]))throw new Error("S value excessively padded");const o=d.allocUnsafe(6+r+n);return o[0]=48,o[1]=o.length-2,o[2]=2,o[3]=e.length,e.copy(o,4),o[4+r]=2,o[5+r]=t.length,t.copy(o,6+r),o};var T={};Object.defineProperty(T,"__esModule",{value:!0}),T.REVERSE_OPS=T.OPS=void 0;const _={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_CHECKLOCKTIMEVERIFY:177,OP_NOP3:178,OP_CHECKSEQUENCEVERIFY:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_CHECKSIGADD:186,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};T.OPS=_;const I={};T.REVERSE_OPS=I;for(const hc of Object.keys(_))I[_[hc]]=hc;var O={};Object.defineProperty(O,"__esModule",{value:!0}),O.decode=O.encode=O.encodingLength=void 0;const A=T;function B(e){return e<A.OPS.OP_PUSHDATA1?1:e<=255?2:e<=65535?3:5}O.encodingLength=B,O.encode=function(e,t,r){const n=B(t);return 1===n?e.writeUInt8(t,r):2===n?(e.writeUInt8(A.OPS.OP_PUSHDATA1,r),e.writeUInt8(t,r+1)):3===n?(e.writeUInt8(A.OPS.OP_PUSHDATA2,r),e.writeUInt16LE(t,r+1)):(e.writeUInt8(A.OPS.OP_PUSHDATA4,r),e.writeUInt32LE(t,r+1)),n},O.decode=function(e,t){const r=e.readUInt8(t);let n,o;if(r<A.OPS.OP_PUSHDATA1)n=r,o=1;else if(r===A.OPS.OP_PUSHDATA1){if(t+2>e.length)return null;n=e.readUInt8(t+1),o=2}else if(r===A.OPS.OP_PUSHDATA2){if(t+3>e.length)return null;n=e.readUInt16LE(t+1),o=3}else{if(t+5>e.length)return null;if(r!==A.OPS.OP_PUSHDATA4)throw new Error("Unexpected opcode");n=e.readUInt32LE(t+1),o=5}return{opcode:r,number:n,size:o}};var k={};Object.defineProperty(k,"__esModule",{value:!0}),k.encode=k.decode=void 0,k.decode=function(e,t,r){t=t||4,r=void 0===r||r;const n=e.length;if(0===n)return 0;if(n>t)throw new TypeError("Script number overflow");if(r&&!(127&e[n-1]||!(n<=1)&&128&e[n-2]))throw new Error("Non-minimally encoded script number");if(5===n){const t=e.readUInt32LE(0),r=e.readUInt8(4);return 128&r?-(4294967296*(-129&r)+t):4294967296*r+t}let o=0;for(let i=0;i<n;++i)o|=e[i]<<8*i;return 128&e[n-1]?-(o&~(128<<8*(n-1))):o},k.encode=function(e){let t=Math.abs(e);const r=function(e){return e>2147483647?5:e>8388607?4:e>32767?3:e>127?2:e>0?1:0}(t),n=d.allocUnsafe(r),o=e<0;for(let i=0;i<r;++i)n.writeUInt8(255&t,i),t>>=8;return 128&n[r-1]?n.writeUInt8(o?128:0,r-1):o&&(n[r-1]|=128),n};var P={},x={};const H=t(w);var U={Array:function(e){return null!=e&&e.constructor===Array},Boolean:function(e){return"boolean"==typeof e},Function:function(e){return"function"==typeof e},Nil:function(e){return null==e},Number:function(e){return"number"==typeof e},Object:function(e){return"object"==typeof e},String:function(e){return"string"==typeof e},"":function(){return!0}};for(var N in U.Null=U.Nil,U)U[N].toJSON=function(e){return e}.bind(null,N);var R=U,C=R;function L(e){return e.name||e.toString().match(/function (.*?)\s*\(/)[1]}function F(e){return C.Nil(e)?"":L(e.constructor)}function V(e,t){Error.captureStackTrace&&Error.captureStackTrace(e,t)}function D(e){return C.Function(e)?e.toJSON?e.toJSON():L(e):C.Array(e)?"Array":e&&C.Object(e)?"Object":void 0!==e?e:""}function M(e,t,r){var n=function(e){return C.Function(e)?"":C.String(e)?JSON.stringify(e):e&&C.Object(e)?"":e}(t);return"Expected "+D(e)+", got"+(""!==r?" "+r:"")+(""!==n?" "+n:"")}function K(e,t,r){r=r||F(t),this.message=M(e,t,r),V(this,K),this.__type=e,this.__value=t,this.__valueTypeName=r}function j(e,t,r,n,o){e?(o=o||F(n),this.message=function(e,t,r,n,o){var i='" of type ';return"key"===t&&(i='" with key type '),M('property "'+D(r)+i+D(e),n,o)}(e,r,t,n,o)):this.message='Unexpected property "'+t+'"',V(this,K),this.__label=r,this.__property=t,this.__type=e,this.__value=n,this.__valueTypeName=o}K.prototype=Object.create(Error.prototype),K.prototype.constructor=K,j.prototype=Object.create(Error.prototype),j.prototype.constructor=K;var G,W,q={TfTypeError:K,TfPropertyTypeError:j,tfCustomError:function(e,t){return new K(e,{},t)},tfSubError:function(e,t,r){return e instanceof j?(t=t+"."+e.__property,e=new j(e.__type,t,e.__label,e.__value,e.__valueTypeName)):e instanceof K&&(e=new j(e.__type,t,r,e.__value,e.__valueTypeName)),V(e),e},tfJSON:D,getValueTypeName:F},X=R,$=q.tfJSON,z=q.TfTypeError,Y=q.TfPropertyTypeError,Z=q.tfSubError,J=q.getValueTypeName,Q={arrayOf:function(e,t){function r(r,n){return!!X.Array(r)&&!X.Nil(r)&&!(void 0!==t.minLength&&r.length<t.minLength)&&!(void 0!==t.maxLength&&r.length>t.maxLength)&&(void 0===t.length||r.length===t.length)&&r.every(function(t,r){try{return te(e,t,n)}catch(o){throw Z(o,r)}})}return e=ee(e),t=t||{},r.toJSON=function(){var r="["+$(e)+"]";return void 0!==t.length?r+="{"+t.length+"}":void 0===t.minLength&&void 0===t.maxLength||(r+="{"+(void 0===t.minLength?0:t.minLength)+","+(void 0===t.maxLength?1/0:t.maxLength)+"}"),r},r},maybe:function e(t){function r(r,n){return X.Nil(r)||t(r,n,e)}return t=ee(t),r.toJSON=function(){return"?"+$(t)},r},map:function(e,t){function r(r,n){if(!X.Object(r))return!1;if(X.Nil(r))return!1;for(var o in r){try{t&&te(t,o,n)}catch(s){throw Z(s,o,"key")}try{var i=r[o];te(e,i,n)}catch(s){throw Z(s,o)}}return!0}return e=ee(e),t&&(t=ee(t)),r.toJSON=t?function(){return"{"+$(t)+": "+$(e)+"}"}:function(){return"{"+$(e)+"}"},r},object:function(e){var t={};for(var r in e)t[r]=ee(e[r]);function n(e,r){if(!X.Object(e))return!1;if(X.Nil(e))return!1;var n;try{for(n in t)te(t[n],e[n],r)}catch(o){throw Z(o,n)}if(r)for(n in e)if(!t[n])throw new Y(void 0,n);return!0}return n.toJSON=function(){return $(t)},n},anyOf:function(){var e=[].slice.call(arguments).map(ee);function t(t,r){return e.some(function(e){try{return te(e,t,r)}catch(n){return!1}})}return t.toJSON=function(){return e.map($).join("|")},t},allOf:function(){var e=[].slice.call(arguments).map(ee);function t(t,r){return e.every(function(e){try{return te(e,t,r)}catch(n){return!1}})}return t.toJSON=function(){return e.map($).join(" & ")},t},quacksLike:function(e){function t(t){return e===J(t)}return t.toJSON=function(){return e},t},tuple:function(){var e=[].slice.call(arguments).map(ee);function t(t,r){return!X.Nil(t)&&!X.Nil(t.length)&&(!r||t.length===e.length)&&e.every(function(e,n){try{return te(e,t[n],r)}catch(o){throw Z(o,n)}})}return t.toJSON=function(){return"("+e.map($).join(", ")+")"},t},value:function(e){function t(t){return t===e}return t.toJSON=function(){return e},t}};function ee(e){if(X.String(e))return"?"===e[0]?Q.maybe(e.slice(1)):X[e]||Q.quacksLike(e);if(e&&X.Object(e)){if(X.Array(e)){if(1!==e.length)throw new TypeError("Expected compile() parameter of type Array of length 1");return Q.arrayOf(e[0])}return Q.object(e)}return X.Function(e)?e:Q.value(e)}function te(e,t,r,n){if(X.Function(e)){if(e(t,r))return!0;throw new z(n||e,t)}return te(ee(e),t,r)}for(var re in Q.oneOf=Q.anyOf,X)te[re]=X[re];for(re in Q)te[re]=Q[re];var ne=function(){if(W)return G;W=1;var e=R,t=q;function r(e){return d.isBuffer(e)}function n(e){return"string"==typeof e&&/^([0-9a-f]{2})+$/i.test(e)}function o(e,r){var n=e.toJSON();function o(o){if(!e(o))return!1;if(o.length===r)return!0;throw t.tfCustomError(n+"(Length: "+r+")",n+"(Length: "+o.length+")")}return o.toJSON=function(){return n},o}var i=o.bind(null,e.Array),s=o.bind(null,r),u=o.bind(null,n),a=o.bind(null,e.String),c=Math.pow(2,53)-1,f={ArrayN:i,Buffer:r,BufferN:s,Finite:function(e){return"number"==typeof e&&isFinite(e)},Hex:n,HexN:u,Int8:function(e){return e<<24>>24===e},Int16:function(e){return e<<16>>16===e},Int32:function(e){return(0|e)===e},Int53:function(e){return"number"==typeof e&&e>=-c&&e<=c&&Math.floor(e)===e},Range:function(t,r,n){function o(e,o){return n(e,o)&&e>t&&e<r}return n=n||e.Number,o.toJSON=function(){return`${n.toJSON()} between [${t}, ${r}]`},o},StringN:a,UInt8:function(e){return(255&e)===e},UInt16:function(e){return(65535&e)===e},UInt32:function(e){return e>>>0===e},UInt53:function(e){return"number"==typeof e&&e>=0&&e<=c&&Math.floor(e)===e}};for(var h in f)f[h].toJSON=function(e){return e}.bind(null,h);return G=f}();for(re in ne)te[re]=ne[re];te.compile=ee,te.TfTypeError=z,te.TfPropertyTypeError=Y;var oe,ie,se=te;function ue(){return ie||(ie=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.signature=e.number=e.isCanonicalScriptSignature=e.isDefinedHashType=e.isCanonicalPubKey=e.toStack=e.fromASM=e.toASM=e.decompile=e.compile=e.countNonPushOnlyOPs=e.isPushOnly=e.OPS=void 0;const t=v,r=T;Object.defineProperty(e,"OPS",{enumerable:!0,get:function(){return r.OPS}});const n=O,o=k,i=function(){if(oe)return P;oe=1,Object.defineProperty(P,"__esModule",{value:!0}),P.encode=P.decode=void 0;const e=v,t=ue(),r=x,{typeforce:n}=r,o=d.alloc(1,0);function i(e){let t=0;for(;0===e[t];)++t;return t===e.length?o:128&(e=e.slice(t))[0]?d.concat([o,e],1+e.length):e}function s(e){0===e[0]&&(e=e.slice(1));const t=d.alloc(32,0),r=Math.max(0,32-e.length);return e.copy(t,r),t}return P.decode=function(r){const n=r.readUInt8(r.length-1);if(!(0,t.isDefinedHashType)(n))throw new Error("Invalid hashType "+n);const o=e.decode(r.slice(0,-1)),i=s(o.r),u=s(o.s);return{signature:d.concat([i,u],64),hashType:n}},P.encode=function(o,s){if(n({signature:r.BufferN(64),hashType:r.UInt8},{signature:o,hashType:s}),!(0,t.isDefinedHashType)(s))throw new Error("Invalid hashType "+s);const u=d.allocUnsafe(1);u.writeUInt8(s,0);const a=i(o.slice(0,32)),c=i(o.slice(32,64));return d.concat([e.encode(a,c),u])},P}(),s=x,{typeforce:u}=s,a=r.OPS.OP_RESERVED;function c(e){return s.Buffer(e)||function(e){return s.Number(e)&&(e===r.OPS.OP_0||e>=r.OPS.OP_1&&e<=r.OPS.OP_16||e===r.OPS.OP_1NEGATE)}(e)}function f(e){return s.Array(e)&&e.every(c)}function h(e){return 0===e.length?r.OPS.OP_0:1===e.length?e[0]>=1&&e[0]<=16?a+e[0]:129===e[0]?r.OPS.OP_1NEGATE:void 0:void 0}function p(e){return d.isBuffer(e)}function l(e){return d.isBuffer(e)}function y(e){if(p(e))return e;u(s.Array,e);const t=e.reduce((e,t)=>l(t)?1===t.length&&void 0!==h(t)?e+1:e+n.encodingLength(t.length)+t.length:e+1,0),r=d.allocUnsafe(t);let o=0;if(e.forEach(e=>{if(l(e)){const t=h(e);if(void 0!==t)return r.writeUInt8(t,o),void(o+=1);o+=n.encode(r,e.length,o),e.copy(r,o),o+=e.length}else r.writeUInt8(e,o),o+=1}),o!==r.length)throw new Error("Could not decode chunks");return r}function w(e){if(t=e,s.Array(t))return e;var t;u(s.Buffer,e);const o=[];let i=0;for(;i<e.length;){const t=e[i];if(t>r.OPS.OP_0&&t<=r.OPS.OP_PUSHDATA4){const t=n.decode(e,i);if(null===t)return null;if(i+=t.size,i+t.number>e.length)return null;const r=e.slice(i,i+t.number);i+=t.number;const s=h(r);void 0!==s?o.push(s):o.push(r)}else o.push(t),i+=1}return o}function g(e){const t=-129&e;return t>0&&t<4}e.isPushOnly=f,e.countNonPushOnlyOPs=function(e){return e.length-e.filter(c).length},e.compile=y,e.decompile=w,e.toASM=function(e){if(p(e)&&(e=w(e)),!e)throw new Error("Could not convert invalid chunks to ASM");return e.map(e=>{if(l(e)){const t=h(e);if(void 0===t)return e.toString("hex");e=t}return r.REVERSE_OPS[e]}).join(" ")},e.fromASM=function(e){return u(s.String,e),y(e.split(" ").map(e=>void 0!==r.OPS[e]?r.OPS[e]:(u(s.Hex,e),d.from(e,"hex"))))},e.toStack=function(e){return e=w(e),u(f,e),e.map(e=>l(e)?e:e===r.OPS.OP_0?d.allocUnsafe(0):o.encode(e-a))},e.isCanonicalPubKey=function(e){return s.isPoint(e)},e.isDefinedHashType=g,e.isCanonicalScriptSignature=function(e){return!!d.isBuffer(e)&&!!g(e[e.length-1])&&t.check(e.slice(0,-1))},e.number=o,e.signature=i}(S)),S}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.oneOf=e.Null=e.BufferN=e.Function=e.UInt32=e.UInt8=e.tuple=e.maybe=e.Hex=e.Buffer=e.String=e.Boolean=e.Array=e.Number=e.Hash256bit=e.Hash160bit=e.Buffer256bit=e.isTaptree=e.isTapleaf=e.TAPLEAF_VERSION_MASK=e.Satoshi=e.isPoint=e.stacksEqual=e.typeforce=void 0;const t=H;e.typeforce=se;const r=t.Buffer.alloc(32,0),n=t.Buffer.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex");function o(r){return!(!r||!("output"in r)||!t.Buffer.isBuffer(r.output)||void 0!==r.version&&(r.version&e.TAPLEAF_VERSION_MASK)!==r.version)}e.stacksEqual=function(e,t){return e.length===t.length&&e.every((e,r)=>e.equals(t[r]))},e.isPoint=function(e){if(!t.Buffer.isBuffer(e))return!1;if(e.length<33)return!1;const o=e[0],i=e.slice(1,33);if(0===i.compare(r))return!1;if(i.compare(n)>=0)return!1;if((2===o||3===o)&&33===e.length)return!0;const s=e.slice(33);return 0!==s.compare(r)&&!(s.compare(n)>=0)&&4===o&&65===e.length},e.Satoshi=function(t){return e.typeforce.UInt53(t)&&t<=21e14},e.TAPLEAF_VERSION_MASK=254,e.isTapleaf=o,e.isTaptree=function t(r){return(0,e.Array)(r)?2===r.length&&r.every(e=>t(e)):o(r)},e.Buffer256bit=e.typeforce.BufferN(32),e.Hash160bit=e.typeforce.BufferN(20),e.Hash256bit=e.typeforce.BufferN(32),e.Number=e.typeforce.Number,e.Array=e.typeforce.Array,e.Boolean=e.typeforce.Boolean,e.String=e.typeforce.String,e.Buffer=e.typeforce.Buffer,e.Hex=e.typeforce.Hex,e.maybe=e.typeforce.maybe,e.tuple=e.typeforce.tuple,e.UInt8=e.typeforce.UInt8,e.UInt32=e.typeforce.UInt32,e.Function=e.typeforce.Function,e.BufferN=e.typeforce.BufferN,e.Null=e.typeforce.Null,e.oneOf=e.typeforce.oneOf}(x);var ae={};Object.defineProperty(ae,"__esModule",{value:!0}),ae.value=ae.prop=void 0,ae.prop=function(e,t,r){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get(){const e=r.call(this);return this[t]=e,e},set(e){Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:e,writable:!0})}})},ae.value=function(e){let t;return()=>(void 0!==t||(t=e()),t)},Object.defineProperty(E,"__esModule",{value:!0}),E.p2data=void 0;const ce=b,fe=ue(),he=x,pe=ae,le=fe.OPS;E.p2data=function(e,t){if(!e.data&&!e.output)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,he.typeforce)({network:he.typeforce.maybe(he.typeforce.Object),output:he.typeforce.maybe(he.typeforce.Buffer),data:he.typeforce.maybe(he.typeforce.arrayOf(he.typeforce.Buffer))},e);const r={name:"embed",network:e.network||ce.bitcoin};if(pe.prop(r,"output",()=>{if(e.data)return fe.compile([le.OP_RETURN].concat(e.data))}),pe.prop(r,"data",()=>{if(e.output)return fe.decompile(e.output).slice(1)}),t.validate&&e.output){const t=fe.decompile(e.output);if(t[0]!==le.OP_RETURN)throw new TypeError("Output is invalid");if(!t.slice(1).every(he.typeforce.Buffer))throw new TypeError("Output is invalid");if(e.data&&!(0,he.stacksEqual)(e.data,r.data))throw new TypeError("Data mismatch")}return Object.assign(r,e)};var de={};Object.defineProperty(de,"__esModule",{value:!0}),de.p2ms=void 0;const ye=b,we=ue(),ge=x,be=ae,me=we.OPS,Ee=me.OP_RESERVED;de.p2ms=function(e,t){if(!(e.input||e.output||e.pubkeys&&void 0!==e.m||e.signatures))throw new TypeError("Not enough data");function r(e){return we.isCanonicalScriptSignature(e)||void 0!==(t.allowIncomplete&&e===me.OP_0)}t=Object.assign({validate:!0},t||{}),(0,ge.typeforce)({network:ge.typeforce.maybe(ge.typeforce.Object),m:ge.typeforce.maybe(ge.typeforce.Number),n:ge.typeforce.maybe(ge.typeforce.Number),output:ge.typeforce.maybe(ge.typeforce.Buffer),pubkeys:ge.typeforce.maybe(ge.typeforce.arrayOf(ge.isPoint)),signatures:ge.typeforce.maybe(ge.typeforce.arrayOf(r)),input:ge.typeforce.maybe(ge.typeforce.Buffer)},e);const n={network:e.network||ye.bitcoin};let o=[],i=!1;function s(e){i||(i=!0,o=we.decompile(e),n.m=o[0]-Ee,n.n=o[o.length-2]-Ee,n.pubkeys=o.slice(1,-2))}if(be.prop(n,"output",()=>{if(e.m&&n.n&&e.pubkeys)return we.compile([].concat(Ee+e.m,e.pubkeys,Ee+n.n,me.OP_CHECKMULTISIG))}),be.prop(n,"m",()=>{if(n.output)return s(n.output),n.m}),be.prop(n,"n",()=>{if(n.pubkeys)return n.pubkeys.length}),be.prop(n,"pubkeys",()=>{if(e.output)return s(e.output),n.pubkeys}),be.prop(n,"signatures",()=>{if(e.input)return we.decompile(e.input).slice(1)}),be.prop(n,"input",()=>{if(e.signatures)return we.compile([me.OP_0].concat(e.signatures))}),be.prop(n,"witness",()=>{if(n.input)return[]}),be.prop(n,"name",()=>{if(n.m&&n.n)return`p2ms(${n.m} of ${n.n})`}),t.validate){if(e.output){if(s(e.output),!ge.typeforce.Number(o[0]))throw new TypeError("Output is invalid");if(!ge.typeforce.Number(o[o.length-2]))throw new TypeError("Output is invalid");if(o[o.length-1]!==me.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(n.m<=0||n.n>16||n.m>n.n||n.n!==o.length-3)throw new TypeError("Output is invalid");if(!n.pubkeys.every(e=>(0,ge.isPoint)(e)))throw new TypeError("Output is invalid");if(void 0!==e.m&&e.m!==n.m)throw new TypeError("m mismatch");if(void 0!==e.n&&e.n!==n.n)throw new TypeError("n mismatch");if(e.pubkeys&&!(0,ge.stacksEqual)(e.pubkeys,n.pubkeys))throw new TypeError("Pubkeys mismatch")}if(e.pubkeys){if(void 0!==e.n&&e.n!==e.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(n.n=e.pubkeys.length,n.n<n.m)throw new TypeError("Pubkey count cannot be less than m")}if(e.signatures){if(e.signatures.length<n.m)throw new TypeError("Not enough signatures provided");if(e.signatures.length>n.m)throw new TypeError("Too many signatures provided")}if(e.input){if(e.input[0]!==me.OP_0)throw new TypeError("Input is invalid");if(0===n.signatures.length||!n.signatures.every(r))throw new TypeError("Input has invalid signature(s)");if(e.signatures&&!(0,ge.stacksEqual)(e.signatures,n.signatures))throw new TypeError("Signature mismatch");if(void 0!==e.m&&e.m!==e.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(n,e)};var Se={};Object.defineProperty(Se,"__esModule",{value:!0}),Se.p2pk=void 0;const ve=b,Te=ue(),_e=x,Ie=ae,Oe=Te.OPS;Se.p2pk=function(e,t){if(!(e.input||e.output||e.pubkey||e.input||e.signature))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,_e.typeforce)({network:_e.typeforce.maybe(_e.typeforce.Object),output:_e.typeforce.maybe(_e.typeforce.Buffer),pubkey:_e.typeforce.maybe(_e.isPoint),signature:_e.typeforce.maybe(Te.isCanonicalScriptSignature),input:_e.typeforce.maybe(_e.typeforce.Buffer)},e);const r=Ie.value(()=>Te.decompile(e.input)),n={name:"p2pk",network:e.network||ve.bitcoin};if(Ie.prop(n,"output",()=>{if(e.pubkey)return Te.compile([e.pubkey,Oe.OP_CHECKSIG])}),Ie.prop(n,"pubkey",()=>{if(e.output)return e.output.slice(1,-1)}),Ie.prop(n,"signature",()=>{if(e.input)return r()[0]}),Ie.prop(n,"input",()=>{if(e.signature)return Te.compile([e.signature])}),Ie.prop(n,"witness",()=>{if(n.input)return[]}),t.validate){if(e.output){if(e.output[e.output.length-1]!==Oe.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!(0,_e.isPoint)(n.pubkey))throw new TypeError("Output pubkey is invalid");if(e.pubkey&&!e.pubkey.equals(n.pubkey))throw new TypeError("Pubkey mismatch")}if(e.signature&&e.input&&!e.input.equals(n.input))throw new TypeError("Signature mismatch");if(e.input){if(1!==r().length)throw new TypeError("Input is invalid");if(!Te.isCanonicalScriptSignature(n.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(n,e)};var Ae={},Be={},ke={},Pe={},xe={},He={},Ue={};Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.crypto=void 0,Ue.crypto="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.wrapXOFConstructorWithOpts=e.wrapConstructorWithOpts=e.wrapConstructor=e.Hash=e.nextTick=e.swap32IfBE=e.byteSwapIfBE=e.swap8IfBE=e.isLE=void 0,e.isBytes=r,e.anumber=n,e.abytes=o,e.ahash=function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.createHasher");n(e.outputLen),n(e.blockLen)},e.aexists=function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},e.aoutput=function(e,t){o(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)},e.u8=function(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},e.u32=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))},e.clean=function(...e){for(let t=0;t<e.length;t++)e[t].fill(0)},e.createView=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},e.rotr=function(e,t){return e<<32-t|e>>>t},e.rotl=function(e,t){return e<<t|e>>>32-t>>>0},e.byteSwap=i,e.byteSwap32=s,e.bytesToHex=function(e){if(o(e),u)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=a[e[r]];return t},e.hexToBytes=function(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);if(u)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let o=0,i=0;o<r;o++,i+=2){const t=f(e.charCodeAt(i)),r=f(e.charCodeAt(i+1));if(void 0===t||void 0===r){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}n[o]=16*t+r}return n},e.asyncLoop=async function(t,r,n){let o=Date.now();for(let i=0;i<t;i++){n(i);const t=Date.now()-o;t>=0&&t<r||(await(0,e.nextTick)(),o+=t)}},e.utf8ToBytes=h,e.bytesToUtf8=function(e){return(new TextDecoder).decode(e)},e.toBytes=p,e.kdfInputToBytes=function(e){return"string"==typeof e&&(e=h(e)),o(e),e},e.concatBytes=function(...e){let t=0;for(let n=0;n<e.length;n++){const r=e[n];o(r),t+=r.length}const r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){const t=e[n];r.set(t,o),o+=t.length}return r},e.checkOpts=function(e,t){if(void 0!==t&&"[object Object]"!=={}.toString.call(t))throw new Error("options should be object or undefined");return Object.assign(e,t)},e.createHasher=l,e.createOptHasher=d,e.createXOFer=y,e.randomBytes=function(e=32){if(t.crypto&&"function"==typeof t.crypto.getRandomValues)return t.crypto.getRandomValues(new Uint8Array(e));if(t.crypto&&"function"==typeof t.crypto.randomBytes)return Uint8Array.from(t.crypto.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")};const t=Ue;function r(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function n(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function o(e,...t){if(!r(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function i(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function s(e){for(let t=0;t<e.length;t++)e[t]=i(e[t]);return e}e.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0],e.swap8IfBE=e.isLE?e=>e:e=>i(e),e.byteSwapIfBE=e.swap8IfBE,e.swap32IfBE=e.isLE?e=>e:s;const u=(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)(),a=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0")),c={_0:48,_9:57,A:65,F:70,a:97,f:102};function f(e){return e>=c._0&&e<=c._9?e-c._0:e>=c.A&&e<=c.F?e-(c.A-10):e>=c.a&&e<=c.f?e-(c.a-10):void 0}function h(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}function p(e){return"string"==typeof e&&(e=h(e)),o(e),e}function l(e){const t=t=>e().update(p(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function d(e){const t=(t,r)=>e(r).update(p(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}function y(e){const t=(t,r)=>e(r).update(p(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}e.nextTick=async()=>{},e.Hash=class{},e.wrapConstructor=l,e.wrapConstructorWithOpts=d,e.wrapXOFConstructorWithOpts=y}(He),Object.defineProperty(xe,"__esModule",{value:!0}),xe.SHA512_IV=xe.SHA384_IV=xe.SHA224_IV=xe.SHA256_IV=xe.HashMD=void 0,xe.setBigUint64=Re,xe.Chi=function(e,t,r){return e&t^~e&r},xe.Maj=function(e,t,r){return e&t^e&r^t&r};const Ne=He;function Re(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),u=Number(r&i),a=n?4:0,c=n?0:4;e.setUint32(t+a,s,n),e.setUint32(t+c,u,n)}xe.HashMD=class extends Ne.Hash{constructor(e,t,r,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.buffer=new Uint8Array(e),this.view=(0,Ne.createView)(this.buffer)}update(e){(0,Ne.aexists)(this),e=(0,Ne.toBytes)(e),(0,Ne.abytes)(e);const{view:t,buffer:r,blockLen:n}=this,o=e.length;for(let i=0;i<o;){const s=Math.min(n-this.pos,o-i);if(s===n){const t=(0,Ne.createView)(e);for(;n<=o-i;i+=n)this.process(t,i);continue}r.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,Ne.aexists)(this),(0,Ne.aoutput)(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:n,isLE:o}=this;let{pos:i}=this;t[i++]=128,(0,Ne.clean)(this.buffer.subarray(i)),this.padOffset>n-i&&(this.process(r,0),i=0);for(let f=i;f<n;f++)t[f]=0;Re(r,n-8,BigInt(8*this.length),o),this.process(r,0);const s=(0,Ne.createView)(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const a=u/4,c=this.get();if(a>c.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<a;f++)s.setUint32(4*f,c[f],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:o,destroyed:i,pos:s}=this;return e.destroyed=i,e.finished=o,e.length=n,e.pos=s,n%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}},xe.SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),xe.SHA224_IV=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),xe.SHA384_IV=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),xe.SHA512_IV=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.ripemd160=Pe.RIPEMD160=Pe.md5=Pe.MD5=Pe.sha1=Pe.SHA1=void 0;const Ce=xe,Le=He,Fe=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),Ve=new Uint32Array(80);class De extends Ce.HashMD{constructor(){super(64,20,8,!1),this.A=0|Fe[0],this.B=0|Fe[1],this.C=0|Fe[2],this.D=0|Fe[3],this.E=0|Fe[4]}get(){const{A:e,B:t,C:r,D:n,E:o}=this;return[e,t,r,n,o]}set(e,t,r,n,o){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|o}process(e,t){for(let u=0;u<16;u++,t+=4)Ve[u]=e.getUint32(t,!1);for(let u=16;u<80;u++)Ve[u]=(0,Le.rotl)(Ve[u-3]^Ve[u-8]^Ve[u-14]^Ve[u-16],1);let{A:r,B:n,C:o,D:i,E:s}=this;for(let u=0;u<80;u++){let e,t;u<20?(e=(0,Ce.Chi)(n,o,i),t=1518500249):u<40?(e=n^o^i,t=1859775393):u<60?(e=(0,Ce.Maj)(n,o,i),t=2400959708):(e=n^o^i,t=3395469782);const a=(0,Le.rotl)(r,5)+e+s+t+Ve[u]|0;s=i,i=o,o=(0,Le.rotl)(n,30),n=r,r=a}r=r+this.A|0,n=n+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,this.set(r,n,o,i,s)}roundClean(){(0,Le.clean)(Ve)}destroy(){this.set(0,0,0,0,0),(0,Le.clean)(this.buffer)}}Pe.SHA1=De,Pe.sha1=(0,Le.createHasher)(()=>new De);const Me=Math.pow(2,32),Ke=Array.from({length:64},(e,t)=>Math.floor(Me*Math.abs(Math.sin(t+1)))),je=Fe.slice(0,4),Ge=new Uint32Array(16);class We extends Ce.HashMD{constructor(){super(64,16,8,!0),this.A=0|je[0],this.B=0|je[1],this.C=0|je[2],this.D=0|je[3]}get(){const{A:e,B:t,C:r,D:n}=this;return[e,t,r,n]}set(e,t,r,n){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n}process(e,t){for(let s=0;s<16;s++,t+=4)Ge[s]=e.getUint32(t,!0);let{A:r,B:n,C:o,D:i}=this;for(let s=0;s<64;s++){let e,t,u;s<16?(e=(0,Ce.Chi)(n,o,i),t=s,u=[7,12,17,22]):s<32?(e=(0,Ce.Chi)(i,n,o),t=(5*s+1)%16,u=[5,9,14,20]):s<48?(e=n^o^i,t=(3*s+5)%16,u=[4,11,16,23]):(e=o^(n|~i),t=7*s%16,u=[6,10,15,21]),e=e+r+Ke[s]+Ge[t],r=i,i=o,o=n,n+=(0,Le.rotl)(e,u[s%4])}r=r+this.A|0,n=n+this.B|0,o=o+this.C|0,i=i+this.D|0,this.set(r,n,o,i)}roundClean(){(0,Le.clean)(Ge)}destroy(){this.set(0,0,0,0),(0,Le.clean)(this.buffer)}}Pe.MD5=We,Pe.md5=(0,Le.createHasher)(()=>new We);const qe=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Xe=(()=>Uint8Array.from(new Array(16).fill(0).map((e,t)=>t)))(),$e=(()=>Xe.map(e=>(9*e+5)%16))(),ze=(()=>{const e=[[Xe],[$e]];for(let t=0;t<4;t++)for(let r of e)r.push(r[t].map(e=>qe[e]));return e})(),Ye=(()=>ze[0])(),Ze=(()=>ze[1])(),Je=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(e=>Uint8Array.from(e)),Qe=Ye.map((e,t)=>e.map(e=>Je[t][e])),et=Ze.map((e,t)=>e.map(e=>Je[t][e])),tt=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),rt=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);function nt(e,t,r,n){return 0===e?t^r^n:1===e?t&r|~t&n:2===e?(t|~r)^n:3===e?t&n|r&~n:t^(r|~n)}const ot=new Uint32Array(16);class it extends Ce.HashMD{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:r,h3:n,h4:o}=this;return[e,t,r,n,o]}set(e,t,r,n,o){this.h0=0|e,this.h1=0|t,this.h2=0|r,this.h3=0|n,this.h4=0|o}process(e,t){for(let p=0;p<16;p++,t+=4)ot[p]=e.getUint32(t,!0);let r=0|this.h0,n=r,o=0|this.h1,i=o,s=0|this.h2,u=s,a=0|this.h3,c=a,f=0|this.h4,h=f;for(let p=0;p<5;p++){const e=4-p,t=tt[p],l=rt[p],d=Ye[p],y=Ze[p],w=Qe[p],g=et[p];for(let n=0;n<16;n++){const e=(0,Le.rotl)(r+nt(p,o,s,a)+ot[d[n]]+t,w[n])+f|0;r=f,f=a,a=0|(0,Le.rotl)(s,10),s=o,o=e}for(let r=0;r<16;r++){const t=(0,Le.rotl)(n+nt(e,i,u,c)+ot[y[r]]+l,g[r])+h|0;n=h,h=c,c=0|(0,Le.rotl)(u,10),u=i,i=t}}this.set(this.h1+s+c|0,this.h2+a+h|0,this.h3+f+n|0,this.h4+r+i|0,this.h0+o+u|0)}roundClean(){(0,Le.clean)(ot)}destroy(){this.destroyed=!0,(0,Le.clean)(this.buffer),this.set(0,0,0,0,0)}}Pe.RIPEMD160=it,Pe.ripemd160=(0,Le.createHasher)(()=>new it),Object.defineProperty(ke,"__esModule",{value:!0}),ke.ripemd160=ke.RIPEMD160=void 0;const st=Pe;ke.RIPEMD160=st.RIPEMD160,ke.ripemd160=st.ripemd160;var ut={};Object.defineProperty(ut,"__esModule",{value:!0}),ut.sha1=ut.SHA1=void 0;const at=Pe;ut.SHA1=at.SHA1,ut.sha1=at.sha1;var ct={},ft={},ht={};Object.defineProperty(ht,"__esModule",{value:!0}),ht.toBig=ht.shrSL=ht.shrSH=ht.rotrSL=ht.rotrSH=ht.rotrBL=ht.rotrBH=ht.rotr32L=ht.rotr32H=ht.rotlSL=ht.rotlSH=ht.rotlBL=ht.rotlBH=ht.add5L=ht.add5H=ht.add4L=ht.add4H=ht.add3L=ht.add3H=void 0,ht.add=kt,ht.fromBig=dt,ht.split=yt;const pt=BigInt(2**32-1),lt=BigInt(32);function dt(e,t=!1){return t?{h:Number(e&pt),l:Number(e>>lt&pt)}:{h:0|Number(e>>lt&pt),l:0|Number(e&pt)}}function yt(e,t=!1){const r=e.length;let n=new Uint32Array(r),o=new Uint32Array(r);for(let i=0;i<r;i++){const{h:r,l:s}=dt(e[i],t);[n[i],o[i]]=[r,s]}return[n,o]}const wt=(e,t)=>BigInt(e>>>0)<<lt|BigInt(t>>>0);ht.toBig=wt;const gt=(e,t,r)=>e>>>r;ht.shrSH=gt;const bt=(e,t,r)=>e<<32-r|t>>>r;ht.shrSL=bt;const mt=(e,t,r)=>e>>>r|t<<32-r;ht.rotrSH=mt;const Et=(e,t,r)=>e<<32-r|t>>>r;ht.rotrSL=Et;const St=(e,t,r)=>e<<64-r|t>>>r-32;ht.rotrBH=St;const vt=(e,t,r)=>e>>>r-32|t<<64-r;ht.rotrBL=vt;const Tt=(e,t)=>t;ht.rotr32H=Tt;const _t=(e,t)=>e;ht.rotr32L=_t;const It=(e,t,r)=>e<<r|t>>>32-r;ht.rotlSH=It;const Ot=(e,t,r)=>t<<r|e>>>32-r;ht.rotlSL=Ot;const At=(e,t,r)=>t<<r-32|e>>>64-r;ht.rotlBH=At;const Bt=(e,t,r)=>e<<r-32|t>>>64-r;function kt(e,t,r,n){const o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:0|o}}ht.rotlBL=Bt;const Pt=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0);ht.add3L=Pt;const xt=(e,t,r,n)=>t+r+n+(e/2**32|0)|0;ht.add3H=xt;const Ht=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0);ht.add4L=Ht;const Ut=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0;ht.add4H=Ut;const Nt=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0);ht.add5L=Nt;const Rt=(e,t,r,n,o,i)=>t+r+n+o+i+(e/2**32|0)|0;ht.add5H=Rt;const Ct={fromBig:dt,split:yt,toBig:wt,shrSH:gt,shrSL:bt,rotrSH:mt,rotrSL:Et,rotrBH:St,rotrBL:vt,rotr32H:Tt,rotr32L:_t,rotlSH:It,rotlSL:Ot,rotlBH:At,rotlBL:Bt,add:kt,add3L:Pt,add3H:xt,add4L:Ht,add4H:Ut,add5H:Rt,add5L:Nt};ht.default=Ct,Object.defineProperty(ft,"__esModule",{value:!0}),ft.sha512_224=ft.sha512_256=ft.sha384=ft.sha512=ft.sha224=ft.sha256=ft.SHA512_256=ft.SHA512_224=ft.SHA384=ft.SHA512=ft.SHA224=ft.SHA256=void 0;const Lt=xe,Ft=ht,Vt=He,Dt=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Mt=new Uint32Array(64);class Kt extends Lt.HashMD{constructor(e=32){super(64,e,8,!1),this.A=0|Lt.SHA256_IV[0],this.B=0|Lt.SHA256_IV[1],this.C=0|Lt.SHA256_IV[2],this.D=0|Lt.SHA256_IV[3],this.E=0|Lt.SHA256_IV[4],this.F=0|Lt.SHA256_IV[5],this.G=0|Lt.SHA256_IV[6],this.H=0|Lt.SHA256_IV[7]}get(){const{A:e,B:t,C:r,D:n,E:o,F:i,G:s,H:u}=this;return[e,t,r,n,o,i,s,u]}set(e,t,r,n,o,i,s,u){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|u}process(e,t){for(let f=0;f<16;f++,t+=4)Mt[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const e=Mt[f-15],t=Mt[f-2],r=(0,Vt.rotr)(e,7)^(0,Vt.rotr)(e,18)^e>>>3,n=(0,Vt.rotr)(t,17)^(0,Vt.rotr)(t,19)^t>>>10;Mt[f]=n+Mt[f-7]+r+Mt[f-16]|0}let{A:r,B:n,C:o,D:i,E:s,F:u,G:a,H:c}=this;for(let f=0;f<64;f++){const e=c+((0,Vt.rotr)(s,6)^(0,Vt.rotr)(s,11)^(0,Vt.rotr)(s,25))+(0,Lt.Chi)(s,u,a)+Dt[f]+Mt[f]|0,t=((0,Vt.rotr)(r,2)^(0,Vt.rotr)(r,13)^(0,Vt.rotr)(r,22))+(0,Lt.Maj)(r,n,o)|0;c=a,a=u,u=s,s=i+e|0,i=o,o=n,n=r,r=e+t|0}r=r+this.A|0,n=n+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,u=u+this.F|0,a=a+this.G|0,c=c+this.H|0,this.set(r,n,o,i,s,u,a,c)}roundClean(){(0,Vt.clean)(Mt)}destroy(){this.set(0,0,0,0,0,0,0,0),(0,Vt.clean)(this.buffer)}}ft.SHA256=Kt;class jt extends Kt{constructor(){super(28),this.A=0|Lt.SHA224_IV[0],this.B=0|Lt.SHA224_IV[1],this.C=0|Lt.SHA224_IV[2],this.D=0|Lt.SHA224_IV[3],this.E=0|Lt.SHA224_IV[4],this.F=0|Lt.SHA224_IV[5],this.G=0|Lt.SHA224_IV[6],this.H=0|Lt.SHA224_IV[7]}}ft.SHA224=jt;const Gt=(()=>Ft.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))))(),Wt=(()=>Gt[0])(),qt=(()=>Gt[1])(),Xt=new Uint32Array(80),$t=new Uint32Array(80);class zt extends Lt.HashMD{constructor(e=64){super(128,e,16,!1),this.Ah=0|Lt.SHA512_IV[0],this.Al=0|Lt.SHA512_IV[1],this.Bh=0|Lt.SHA512_IV[2],this.Bl=0|Lt.SHA512_IV[3],this.Ch=0|Lt.SHA512_IV[4],this.Cl=0|Lt.SHA512_IV[5],this.Dh=0|Lt.SHA512_IV[6],this.Dl=0|Lt.SHA512_IV[7],this.Eh=0|Lt.SHA512_IV[8],this.El=0|Lt.SHA512_IV[9],this.Fh=0|Lt.SHA512_IV[10],this.Fl=0|Lt.SHA512_IV[11],this.Gh=0|Lt.SHA512_IV[12],this.Gl=0|Lt.SHA512_IV[13],this.Hh=0|Lt.SHA512_IV[14],this.Hl=0|Lt.SHA512_IV[15]}get(){const{Ah:e,Al:t,Bh:r,Bl:n,Ch:o,Cl:i,Dh:s,Dl:u,Eh:a,El:c,Fh:f,Fl:h,Gh:p,Gl:l,Hh:d,Hl:y}=this;return[e,t,r,n,o,i,s,u,a,c,f,h,p,l,d,y]}set(e,t,r,n,o,i,s,u,a,c,f,h,p,l,d,y){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|o,this.Cl=0|i,this.Dh=0|s,this.Dl=0|u,this.Eh=0|a,this.El=0|c,this.Fh=0|f,this.Fl=0|h,this.Gh=0|p,this.Gl=0|l,this.Hh=0|d,this.Hl=0|y}process(e,t){for(let b=0;b<16;b++,t+=4)Xt[b]=e.getUint32(t),$t[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){const e=0|Xt[b-15],t=0|$t[b-15],r=Ft.rotrSH(e,t,1)^Ft.rotrSH(e,t,8)^Ft.shrSH(e,t,7),n=Ft.rotrSL(e,t,1)^Ft.rotrSL(e,t,8)^Ft.shrSL(e,t,7),o=0|Xt[b-2],i=0|$t[b-2],s=Ft.rotrSH(o,i,19)^Ft.rotrBH(o,i,61)^Ft.shrSH(o,i,6),u=Ft.rotrSL(o,i,19)^Ft.rotrBL(o,i,61)^Ft.shrSL(o,i,6),a=Ft.add4L(n,u,$t[b-7],$t[b-16]),c=Ft.add4H(a,r,s,Xt[b-7],Xt[b-16]);Xt[b]=0|c,$t[b]=0|a}let{Ah:r,Al:n,Bh:o,Bl:i,Ch:s,Cl:u,Dh:a,Dl:c,Eh:f,El:h,Fh:p,Fl:l,Gh:d,Gl:y,Hh:w,Hl:g}=this;for(let b=0;b<80;b++){const e=Ft.rotrSH(f,h,14)^Ft.rotrSH(f,h,18)^Ft.rotrBH(f,h,41),t=Ft.rotrSL(f,h,14)^Ft.rotrSL(f,h,18)^Ft.rotrBL(f,h,41),m=f&p^~f&d,E=h&l^~h&y,S=Ft.add5L(g,t,E,qt[b],$t[b]),v=Ft.add5H(S,w,e,m,Wt[b],Xt[b]),T=0|S,_=Ft.rotrSH(r,n,28)^Ft.rotrBH(r,n,34)^Ft.rotrBH(r,n,39),I=Ft.rotrSL(r,n,28)^Ft.rotrBL(r,n,34)^Ft.rotrBL(r,n,39),O=r&o^r&s^o&s,A=n&i^n&u^i&u;w=0|d,g=0|y,d=0|p,y=0|l,p=0|f,l=0|h,({h:f,l:h}=Ft.add(0|a,0|c,0|v,0|T)),a=0|s,c=0|u,s=0|o,u=0|i,o=0|r,i=0|n;const B=Ft.add3L(T,I,A);r=Ft.add3H(B,v,_,O),n=0|B}({h:r,l:n}=Ft.add(0|this.Ah,0|this.Al,0|r,0|n)),({h:o,l:i}=Ft.add(0|this.Bh,0|this.Bl,0|o,0|i)),({h:s,l:u}=Ft.add(0|this.Ch,0|this.Cl,0|s,0|u)),({h:a,l:c}=Ft.add(0|this.Dh,0|this.Dl,0|a,0|c)),({h:f,l:h}=Ft.add(0|this.Eh,0|this.El,0|f,0|h)),({h:p,l}=Ft.add(0|this.Fh,0|this.Fl,0|p,0|l)),({h:d,l:y}=Ft.add(0|this.Gh,0|this.Gl,0|d,0|y)),({h:w,l:g}=Ft.add(0|this.Hh,0|this.Hl,0|w,0|g)),this.set(r,n,o,i,s,u,a,c,f,h,p,l,d,y,w,g)}roundClean(){(0,Vt.clean)(Xt,$t)}destroy(){(0,Vt.clean)(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}ft.SHA512=zt;class Yt extends zt{constructor(){super(48),this.Ah=0|Lt.SHA384_IV[0],this.Al=0|Lt.SHA384_IV[1],this.Bh=0|Lt.SHA384_IV[2],this.Bl=0|Lt.SHA384_IV[3],this.Ch=0|Lt.SHA384_IV[4],this.Cl=0|Lt.SHA384_IV[5],this.Dh=0|Lt.SHA384_IV[6],this.Dl=0|Lt.SHA384_IV[7],this.Eh=0|Lt.SHA384_IV[8],this.El=0|Lt.SHA384_IV[9],this.Fh=0|Lt.SHA384_IV[10],this.Fl=0|Lt.SHA384_IV[11],this.Gh=0|Lt.SHA384_IV[12],this.Gl=0|Lt.SHA384_IV[13],this.Hh=0|Lt.SHA384_IV[14],this.Hl=0|Lt.SHA384_IV[15]}}ft.SHA384=Yt;const Zt=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),Jt=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class Qt extends zt{constructor(){super(28),this.Ah=0|Zt[0],this.Al=0|Zt[1],this.Bh=0|Zt[2],this.Bl=0|Zt[3],this.Ch=0|Zt[4],this.Cl=0|Zt[5],this.Dh=0|Zt[6],this.Dl=0|Zt[7],this.Eh=0|Zt[8],this.El=0|Zt[9],this.Fh=0|Zt[10],this.Fl=0|Zt[11],this.Gh=0|Zt[12],this.Gl=0|Zt[13],this.Hh=0|Zt[14],this.Hl=0|Zt[15]}}ft.SHA512_224=Qt;class er extends zt{constructor(){super(32),this.Ah=0|Jt[0],this.Al=0|Jt[1],this.Bh=0|Jt[2],this.Bl=0|Jt[3],this.Ch=0|Jt[4],this.Cl=0|Jt[5],this.Dh=0|Jt[6],this.Dl=0|Jt[7],this.Eh=0|Jt[8],this.El=0|Jt[9],this.Fh=0|Jt[10],this.Fl=0|Jt[11],this.Gh=0|Jt[12],this.Gl=0|Jt[13],this.Hh=0|Jt[14],this.Hl=0|Jt[15]}}ft.SHA512_256=er,ft.sha256=(0,Vt.createHasher)(()=>new Kt),ft.sha224=(0,Vt.createHasher)(()=>new jt),ft.sha512=(0,Vt.createHasher)(()=>new zt),ft.sha384=(0,Vt.createHasher)(()=>new Yt),ft.sha512_256=(0,Vt.createHasher)(()=>new er),ft.sha512_224=(0,Vt.createHasher)(()=>new Qt),Object.defineProperty(ct,"__esModule",{value:!0}),ct.sha224=ct.SHA224=ct.sha256=ct.SHA256=void 0;const tr=ft;ct.SHA256=tr.SHA256,ct.sha256=tr.sha256,ct.SHA224=tr.SHA224,ct.sha224=tr.sha224,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.taggedHash=e.TAGGED_HASH_PREFIXES=e.TAGS=e.hash256=e.hash160=e.sha256=e.sha1=e.ripemd160=void 0;const t=ke,r=ut,n=ct;function o(e){return d.from((0,n.sha256)(Uint8Array.from(e)))}e.ripemd160=function(e){return d.from((0,t.ripemd160)(Uint8Array.from(e)))},e.sha1=function(e){return d.from((0,r.sha1)(Uint8Array.from(e)))},e.sha256=o,e.hash160=function(e){return d.from((0,t.ripemd160)((0,n.sha256)(Uint8Array.from(e))))},e.hash256=function(e){return d.from((0,n.sha256)((0,n.sha256)(Uint8Array.from(e))))},e.TAGS=["BIP0340/challenge","BIP0340/aux","BIP0340/nonce","TapLeaf","TapBranch","TapSighash","TapTweak","KeyAgg list","KeyAgg coefficient"],e.TAGGED_HASH_PREFIXES={"BIP0340/challenge":d.from([123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124,123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124]),"BIP0340/aux":d.from([241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144,241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144]),"BIP0340/nonce":d.from([7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47,7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47]),TapLeaf:d.from([174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238,174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238]),TapBranch:d.from([25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21,25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21]),TapSighash:d.from([244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49,244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49]),TapTweak:d.from([232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233,232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233]),"KeyAgg list":d.from([72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240,72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240]),"KeyAgg coefficient":d.from([191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129,191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129])},e.taggedHash=function(t,r){return o(d.concat([e.TAGGED_HASH_PREFIXES[t],r]))}}(Be);var rr=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var n=0;n<e.length;n++){var o=e.charAt(n),i=o.charCodeAt(0);if(255!==t[i])throw new TypeError(o+" is ambiguous");t[i]=n}var s=e.length,u=e.charAt(0),a=Math.log(s)/Math.log(256),c=Math.log(256)/Math.log(s);function f(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;for(var r=0,n=0,o=0;e[r]===u;)n++,r++;for(var i=(e.length-r)*a+1>>>0,c=new Uint8Array(i);e[r];){var f=e.charCodeAt(r);if(f>255)return;var h=t[f];if(255===h)return;for(var p=0,l=i-1;(0!==h||p<o)&&-1!==l;l--,p++)h+=s*c[l]>>>0,c[l]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");o=p,r++}for(var d=i-o;d!==i&&0===c[d];)d++;for(var y=new Uint8Array(n+(i-d)),w=n;d!==i;)y[w++]=c[d++];return y}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,o=0,i=t.length;o!==i&&0===t[o];)o++,r++;for(var a=(i-o)*c+1>>>0,f=new Uint8Array(a);o!==i;){for(var h=t[o],p=0,l=a-1;(0!==h||p<n)&&-1!==l;l--,p++)h+=256*f[l]>>>0,f[l]=h%s>>>0,h=h/s>>>0;if(0!==h)throw new Error("Non-zero carry");n=p,o++}for(var d=a-n;d!==a&&0===f[d];)d++;for(var y=u.repeat(r);d<a;++d)y+=e.charAt(f[d]);return y},decodeUnsafe:f,decode:function(e){var t=f(e);if(t)return t;throw new Error("Non-base"+s+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),{sha256:nr}=ct,or=function(e){function t(t){var r=t.slice(0,-4),n=t.slice(-4),o=e(r);if(!(n[0]^o[0]|n[1]^o[1]|n[2]^o[2]|n[3]^o[3]))return r}return{encode:function(t){var r=Uint8Array.from(t),n=e(r),o=r.length+4,i=new Uint8Array(o);return i.set(r,0),i.set(n.subarray(0,4),r.length),rr.encode(i,o)},decode:function(e){var r=t(rr.decode(e));if(!r)throw new Error("Invalid checksum");return r},decodeUnsafe:function(e){var r=rr.decodeUnsafe(e);if(r)return t(r)}}}(function(e){return nr(nr(e))});Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.p2pkh=void 0;const ir=Be,sr=b,ur=ue(),ar=x,cr=ae,fr=or,hr=ur.OPS;Ae.p2pkh=function(e,t){if(!(e.address||e.hash||e.output||e.pubkey||e.input))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,ar.typeforce)({network:ar.typeforce.maybe(ar.typeforce.Object),address:ar.typeforce.maybe(ar.typeforce.String),hash:ar.typeforce.maybe(ar.typeforce.BufferN(20)),output:ar.typeforce.maybe(ar.typeforce.BufferN(25)),pubkey:ar.typeforce.maybe(ar.isPoint),signature:ar.typeforce.maybe(ur.isCanonicalScriptSignature),input:ar.typeforce.maybe(ar.typeforce.Buffer)},e);const r=cr.value(()=>{const t=d.from(fr.decode(e.address));return{version:t.readUInt8(0),hash:t.slice(1)}}),n=cr.value(()=>ur.decompile(e.input)),o=e.network||sr.bitcoin,i={name:"p2pkh",network:o};if(cr.prop(i,"address",()=>{if(!i.hash)return;const e=d.allocUnsafe(21);return e.writeUInt8(o.pubKeyHash,0),i.hash.copy(e,1),fr.encode(e)}),cr.prop(i,"hash",()=>e.output?e.output.slice(3,23):e.address?r().hash:e.pubkey||i.pubkey?ir.hash160(e.pubkey||i.pubkey):void 0),cr.prop(i,"output",()=>{if(i.hash)return ur.compile([hr.OP_DUP,hr.OP_HASH160,i.hash,hr.OP_EQUALVERIFY,hr.OP_CHECKSIG])}),cr.prop(i,"pubkey",()=>{if(e.input)return n()[1]}),cr.prop(i,"signature",()=>{if(e.input)return n()[0]}),cr.prop(i,"input",()=>{if(e.pubkey&&e.signature)return ur.compile([e.signature,e.pubkey])}),cr.prop(i,"witness",()=>{if(i.input)return[]}),t.validate){let t=d.from([]);if(e.address){if(r().version!==o.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(20!==r().hash.length)throw new TypeError("Invalid address");t=r().hash}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(25!==e.output.length||e.output[0]!==hr.OP_DUP||e.output[1]!==hr.OP_HASH160||20!==e.output[2]||e.output[23]!==hr.OP_EQUALVERIFY||e.output[24]!==hr.OP_CHECKSIG)throw new TypeError("Output is invalid");const r=e.output.slice(3,23);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}if(e.pubkey){const r=ir.hash160(e.pubkey);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}if(e.input){const r=n();if(2!==r.length)throw new TypeError("Input is invalid");if(!ur.isCanonicalScriptSignature(r[0]))throw new TypeError("Input has invalid signature");if(!(0,ar.isPoint)(r[1]))throw new TypeError("Input has invalid pubkey");if(e.signature&&!e.signature.equals(r[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(r[1]))throw new TypeError("Pubkey mismatch");const o=ir.hash160(r[1]);if(t.length>0&&!t.equals(o))throw new TypeError("Hash mismatch")}}return Object.assign(i,e)};var pr={};Object.defineProperty(pr,"__esModule",{value:!0}),pr.p2sh=void 0;const lr=Be,dr=b,yr=ue(),wr=x,gr=ae,br=or,mr=yr.OPS;pr.p2sh=function(e,t){if(!(e.address||e.hash||e.output||e.redeem||e.input))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,wr.typeforce)({network:wr.typeforce.maybe(wr.typeforce.Object),address:wr.typeforce.maybe(wr.typeforce.String),hash:wr.typeforce.maybe(wr.typeforce.BufferN(20)),output:wr.typeforce.maybe(wr.typeforce.BufferN(23)),redeem:wr.typeforce.maybe({network:wr.typeforce.maybe(wr.typeforce.Object),output:wr.typeforce.maybe(wr.typeforce.Buffer),input:wr.typeforce.maybe(wr.typeforce.Buffer),witness:wr.typeforce.maybe(wr.typeforce.arrayOf(wr.typeforce.Buffer))}),input:wr.typeforce.maybe(wr.typeforce.Buffer),witness:wr.typeforce.maybe(wr.typeforce.arrayOf(wr.typeforce.Buffer))},e);let r=e.network;r||(r=e.redeem&&e.redeem.network||dr.bitcoin);const n={network:r},o=gr.value(()=>{const t=d.from(br.decode(e.address));return{version:t.readUInt8(0),hash:t.slice(1)}}),i=gr.value(()=>yr.decompile(e.input)),s=gr.value(()=>{const t=i(),n=t[t.length-1];return{network:r,output:n===mr.OP_FALSE?d.from([]):n,input:yr.compile(t.slice(0,-1)),witness:e.witness||[]}});if(gr.prop(n,"address",()=>{if(!n.hash)return;const e=d.allocUnsafe(21);return e.writeUInt8(n.network.scriptHash,0),n.hash.copy(e,1),br.encode(e)}),gr.prop(n,"hash",()=>e.output?e.output.slice(2,22):e.address?o().hash:n.redeem&&n.redeem.output?lr.hash160(n.redeem.output):void 0),gr.prop(n,"output",()=>{if(n.hash)return yr.compile([mr.OP_HASH160,n.hash,mr.OP_EQUAL])}),gr.prop(n,"redeem",()=>{if(e.input)return s()}),gr.prop(n,"input",()=>{if(e.redeem&&e.redeem.input&&e.redeem.output)return yr.compile([].concat(yr.decompile(e.redeem.input),e.redeem.output))}),gr.prop(n,"witness",()=>n.redeem&&n.redeem.witness?n.redeem.witness:n.input?[]:void 0),gr.prop(n,"name",()=>{const e=["p2sh"];return void 0!==n.redeem&&void 0!==n.redeem.name&&e.push(n.redeem.name),e.join("-")}),t.validate){let t=d.from([]);if(e.address){if(o().version!==r.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(20!==o().hash.length)throw new TypeError("Invalid address");t=o().hash}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(23!==e.output.length||e.output[0]!==mr.OP_HASH160||20!==e.output[1]||e.output[22]!==mr.OP_EQUAL)throw new TypeError("Output is invalid");const r=e.output.slice(2,22);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}const n=e=>{if(e.output){const r=yr.decompile(e.output);if(!r||r.length<1)throw new TypeError("Redeem.output too short");if(e.output.byteLength>520)throw new TypeError("Redeem.output unspendable if larger than 520 bytes");if(yr.countNonPushOnlyOPs(r)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops");const n=lr.hash160(e.output);if(t.length>0&&!t.equals(n))throw new TypeError("Hash mismatch");t=n}if(e.input){const t=e.input.length>0,r=e.witness&&e.witness.length>0;if(!t&&!r)throw new TypeError("Empty input");if(t&&r)throw new TypeError("Input and witness provided");if(t){const t=yr.decompile(e.input);if(!yr.isPushOnly(t))throw new TypeError("Non push-only scriptSig")}}};if(e.input){const e=i();if(!e||e.length<1)throw new TypeError("Input too short");if(!d.isBuffer(s().output))throw new TypeError("Input is invalid");n(s())}if(e.redeem){if(e.redeem.network&&e.redeem.network!==r)throw new TypeError("Network mismatch");if(e.input){const t=s();if(e.redeem.output&&!e.redeem.output.equals(t.output))throw new TypeError("Redeem.output mismatch");if(e.redeem.input&&!e.redeem.input.equals(t.input))throw new TypeError("Redeem.input mismatch")}n(e.redeem)}if(e.witness&&e.redeem&&e.redeem.witness&&!(0,wr.stacksEqual)(e.redeem.witness,e.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(n,e)};var Er={},Sr={};Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.bech32m=Sr.bech32=void 0;const vr="qpzry9x8gf2tvdw0s3jn54khce6mua7l",Tr={};for(let hc=0;hc<32;hc++){const e=vr.charAt(hc);Tr[e]=hc}function _r(e){const t=e>>25;return(33554431&e)<<5^996825010&-(1&t)^642813549&-(t>>1&1)^513874426&-(t>>2&1)^1027748829&-(t>>3&1)^705979059&-(t>>4&1)}function Ir(e){let t=1;for(let r=0;r<e.length;++r){const n=e.charCodeAt(r);if(n<33||n>126)return"Invalid prefix ("+e+")";t=_r(t)^n>>5}t=_r(t);for(let r=0;r<e.length;++r){const n=e.charCodeAt(r);t=_r(t)^31&n}return t}function Or(e,t,r,n){let o=0,i=0;const s=(1<<r)-1,u=[];for(let a=0;a<e.length;++a)for(o=o<<t|e[a],i+=t;i>=r;)i-=r,u.push(o>>i&s);if(n)i>0&&u.push(o<<r-i&s);else{if(i>=t)return"Excess padding";if(o<<r-i&s)return"Non-zero padding"}return u}function Ar(e){return Or(e,8,5,!0)}function Br(e){const t=Or(e,5,8,!1);if(Array.isArray(t))return t}function kr(e){const t=Or(e,5,8,!1);if(Array.isArray(t))return t;throw new Error(t)}function Pr(e){let t;function r(e,r){if(r=r||90,e.length<8)return e+" too short";if(e.length>r)return"Exceeds length limit";const n=e.toLowerCase(),o=e.toUpperCase();if(e!==n&&e!==o)return"Mixed-case string "+e;const i=(e=n).lastIndexOf("1");if(-1===i)return"No separator character for "+e;if(0===i)return"Missing prefix for "+e;const s=e.slice(0,i),u=e.slice(i+1);if(u.length<6)return"Data too short";let a=Ir(s);if("string"==typeof a)return a;const c=[];for(let t=0;t<u.length;++t){const e=u.charAt(t),r=Tr[e];if(void 0===r)return"Unknown character "+e;a=_r(a)^r,t+6>=u.length||c.push(r)}return a!==t?"Invalid checksum for "+e:{prefix:s,words:c}}return t="bech32"===e?1:734539939,{decodeUnsafe:function(e,t){const n=r(e,t);if("object"==typeof n)return n},decode:function(e,t){const n=r(e,t);if("object"==typeof n)return n;throw new Error(n)},encode:function(e,r,n){if(n=n||90,e.length+7+r.length>n)throw new TypeError("Exceeds length limit");let o=Ir(e=e.toLowerCase());if("string"==typeof o)throw new Error(o);let i=e+"1";for(let t=0;t<r.length;++t){const e=r[t];if(e>>5)throw new Error("Non 5-bit word");o=_r(o)^e,i+=vr.charAt(e)}for(let t=0;t<6;++t)o=_r(o);o^=t;for(let t=0;t<6;++t)i+=vr.charAt(o>>5*(5-t)&31);return i},toWords:Ar,fromWordsUnsafe:Br,fromWords:kr}}Sr.bech32=Pr("bech32"),Sr.bech32m=Pr("bech32m"),Object.defineProperty(Er,"__esModule",{value:!0}),Er.p2wpkh=void 0;const xr=Be,Hr=b,Ur=ue(),Nr=x,Rr=ae,Cr=Sr,Lr=Ur.OPS,Fr=d.alloc(0);Er.p2wpkh=function(e,t){if(!(e.address||e.hash||e.output||e.pubkey||e.witness))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,Nr.typeforce)({address:Nr.typeforce.maybe(Nr.typeforce.String),hash:Nr.typeforce.maybe(Nr.typeforce.BufferN(20)),input:Nr.typeforce.maybe(Nr.typeforce.BufferN(0)),network:Nr.typeforce.maybe(Nr.typeforce.Object),output:Nr.typeforce.maybe(Nr.typeforce.BufferN(22)),pubkey:Nr.typeforce.maybe(Nr.isPoint),signature:Nr.typeforce.maybe(Ur.isCanonicalScriptSignature),witness:Nr.typeforce.maybe(Nr.typeforce.arrayOf(Nr.typeforce.Buffer))},e);const r=Rr.value(()=>{const t=Cr.bech32.decode(e.address),r=t.words.shift(),n=Cr.bech32.fromWords(t.words);return{version:r,prefix:t.prefix,data:d.from(n)}}),n=e.network||Hr.bitcoin,o={name:"p2wpkh",network:n};if(Rr.prop(o,"address",()=>{if(!o.hash)return;const e=Cr.bech32.toWords(o.hash);return e.unshift(0),Cr.bech32.encode(n.bech32,e)}),Rr.prop(o,"hash",()=>e.output?e.output.slice(2,22):e.address?r().data:e.pubkey||o.pubkey?xr.hash160(e.pubkey||o.pubkey):void 0),Rr.prop(o,"output",()=>{if(o.hash)return Ur.compile([Lr.OP_0,o.hash])}),Rr.prop(o,"pubkey",()=>e.pubkey?e.pubkey:e.witness?e.witness[1]:void 0),Rr.prop(o,"signature",()=>{if(e.witness)return e.witness[0]}),Rr.prop(o,"input",()=>{if(o.witness)return Fr}),Rr.prop(o,"witness",()=>{if(e.pubkey&&e.signature)return[e.signature,e.pubkey]}),t.validate){let t=d.from([]);if(e.address){if(n&&n.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(20!==r().data.length)throw new TypeError("Invalid address data");t=r().data}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(22!==e.output.length||e.output[0]!==Lr.OP_0||20!==e.output[1])throw new TypeError("Output is invalid");if(t.length>0&&!t.equals(e.output.slice(2)))throw new TypeError("Hash mismatch");t=e.output.slice(2)}if(e.pubkey){const r=xr.hash160(e.pubkey);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");if(t=r,!(0,Nr.isPoint)(e.pubkey)||33!==e.pubkey.length)throw new TypeError("Invalid pubkey for p2wpkh")}if(e.witness){if(2!==e.witness.length)throw new TypeError("Witness is invalid");if(!Ur.isCanonicalScriptSignature(e.witness[0]))throw new TypeError("Witness has invalid signature");if(!(0,Nr.isPoint)(e.witness[1])||33!==e.witness[1].length)throw new TypeError("Witness has invalid pubkey");if(e.signature&&!e.signature.equals(e.witness[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(e.witness[1]))throw new TypeError("Pubkey mismatch");const r=xr.hash160(e.witness[1]);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch")}}return Object.assign(o,e)};var Vr={};Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.p2wsh=void 0;const Dr=Be,Mr=b,Kr=ue(),jr=x,Gr=ae,Wr=Sr,qr=Kr.OPS,Xr=d.alloc(0);function $r(e){return!(!d.isBuffer(e)||65!==e.length||4!==e[0]||!(0,jr.isPoint)(e))}Vr.p2wsh=function(e,t){if(!(e.address||e.hash||e.output||e.redeem||e.witness))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,jr.typeforce)({network:jr.typeforce.maybe(jr.typeforce.Object),address:jr.typeforce.maybe(jr.typeforce.String),hash:jr.typeforce.maybe(jr.typeforce.BufferN(32)),output:jr.typeforce.maybe(jr.typeforce.BufferN(34)),redeem:jr.typeforce.maybe({input:jr.typeforce.maybe(jr.typeforce.Buffer),network:jr.typeforce.maybe(jr.typeforce.Object),output:jr.typeforce.maybe(jr.typeforce.Buffer),witness:jr.typeforce.maybe(jr.typeforce.arrayOf(jr.typeforce.Buffer))}),input:jr.typeforce.maybe(jr.typeforce.BufferN(0)),witness:jr.typeforce.maybe(jr.typeforce.arrayOf(jr.typeforce.Buffer))},e);const r=Gr.value(()=>{const t=Wr.bech32.decode(e.address),r=t.words.shift(),n=Wr.bech32.fromWords(t.words);return{version:r,prefix:t.prefix,data:d.from(n)}}),n=Gr.value(()=>Kr.decompile(e.redeem.input));let o=e.network;o||(o=e.redeem&&e.redeem.network||Mr.bitcoin);const i={network:o};if(Gr.prop(i,"address",()=>{if(!i.hash)return;const e=Wr.bech32.toWords(i.hash);return e.unshift(0),Wr.bech32.encode(o.bech32,e)}),Gr.prop(i,"hash",()=>e.output?e.output.slice(2):e.address?r().data:i.redeem&&i.redeem.output?Dr.sha256(i.redeem.output):void 0),Gr.prop(i,"output",()=>{if(i.hash)return Kr.compile([qr.OP_0,i.hash])}),Gr.prop(i,"redeem",()=>{if(e.witness)return{output:e.witness[e.witness.length-1],input:Xr,witness:e.witness.slice(0,-1)}}),Gr.prop(i,"input",()=>{if(i.witness)return Xr}),Gr.prop(i,"witness",()=>{if(e.redeem&&e.redeem.input&&e.redeem.input.length>0&&e.redeem.output&&e.redeem.output.length>0){const t=Kr.toStack(n());return i.redeem=Object.assign({witness:t},e.redeem),i.redeem.input=Xr,[].concat(t,e.redeem.output)}if(e.redeem&&e.redeem.output&&e.redeem.witness)return[].concat(e.redeem.witness,e.redeem.output)}),Gr.prop(i,"name",()=>{const e=["p2wsh"];return void 0!==i.redeem&&void 0!==i.redeem.name&&e.push(i.redeem.name),e.join("-")}),t.validate){let t=d.from([]);if(e.address){if(r().prefix!==o.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(32!==r().data.length)throw new TypeError("Invalid address data");t=r().data}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(34!==e.output.length||e.output[0]!==qr.OP_0||32!==e.output[1])throw new TypeError("Output is invalid");const r=e.output.slice(2);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}if(e.redeem){if(e.redeem.network&&e.redeem.network!==o)throw new TypeError("Network mismatch");if(e.redeem.input&&e.redeem.input.length>0&&e.redeem.witness&&e.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(e.redeem.output){const r=Kr.decompile(e.redeem.output);if(!r||r.length<1)throw new TypeError("Redeem.output is invalid");if(e.redeem.output.byteLength>3600)throw new TypeError("Redeem.output unspendable if larger than 3600 bytes");if(Kr.countNonPushOnlyOPs(r)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops");const n=Dr.sha256(e.redeem.output);if(t.length>0&&!t.equals(n))throw new TypeError("Hash mismatch");t=n}if(e.redeem.input&&!Kr.isPushOnly(n()))throw new TypeError("Non push-only scriptSig");if(e.witness&&e.redeem.witness&&!(0,jr.stacksEqual)(e.witness,e.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(e.redeem.input&&n().some($r)||e.redeem.output&&(Kr.decompile(e.redeem.output)||[]).some($r))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(e.witness&&e.witness.length>0){const t=e.witness[e.witness.length-1];if(e.redeem&&e.redeem.output&&!e.redeem.output.equals(t))throw new TypeError("Witness and redeem.output mismatch");if(e.witness.some($r)||(Kr.decompile(t)||[]).some($r))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(i,e)};var zr={},Yr={};Object.defineProperty(Yr,"__esModule",{value:!0}),Yr.getEccLib=Yr.initEccLib=void 0;const Zr={};Yr.initEccLib=function(e,t){var r;e?e!==Zr.eccLib&&(t?.DANGER_DO_NOT_VERIFY_ECCLIB||(Qr("function"==typeof(r=e).isXOnlyPoint),Qr(r.isXOnlyPoint(Jr("79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),Qr(r.isXOnlyPoint(Jr("fffffffffffffffffffffffffffffffffffffffffffffffffffffffeeffffc2e"))),Qr(r.isXOnlyPoint(Jr("f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9"))),Qr(r.isXOnlyPoint(Jr("0000000000000000000000000000000000000000000000000000000000000001"))),Qr(!r.isXOnlyPoint(Jr("0000000000000000000000000000000000000000000000000000000000000000"))),Qr(!r.isXOnlyPoint(Jr("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"))),Qr("function"==typeof r.xOnlyPointAddTweak),en.forEach(e=>{const t=r.xOnlyPointAddTweak(Jr(e.pubkey),Jr(e.tweak));null===e.result?Qr(null===t):(Qr(null!==t),Qr(t.parity===e.parity),Qr(d.from(t.xOnlyPubkey).equals(Jr(e.result))))})),Zr.eccLib=e):Zr.eccLib=e},Yr.getEccLib=function(){if(!Zr.eccLib)throw new Error("No ECC Library provided. You must call initEccLib() with a valid TinySecp256k1Interface instance");return Zr.eccLib};const Jr=e=>d.from(e,"hex");function Qr(e){if(!e)throw new Error("ecc library invalid")}const en=[{pubkey:"79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798",tweak:"fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140",parity:-1,result:null},{pubkey:"1617d38ed8d8657da4d4761e8057bc396ea9e4b9d29776d4be096016dbd2509b",tweak:"a8397a935f0dfceba6ba9618f6451ef4d80637abf4e6af2669fbc9de6a8fd2ac",parity:1,result:"e478f99dab91052ab39a33ea35fd5e6e4933f4d28023cd597c9a1f6760346adf"},{pubkey:"2c0b7cf95324a07d05398b240174dc0c2be444d96b159aa6c7f7b1e668680991",tweak:"823c3cd2142744b075a87eade7e1b8678ba308d566226a0056ca2b7a76f86b47",parity:0,result:"9534f8dc8c6deda2dc007655981c78b49c5d96c778fbf363462a11ec9dfd948c"}];var tn={},rn={},nn={exports:{}};!function(e,t){var r=H,n=r.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function i(e,t,r){return n(e,t,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=i),i.prototype=Object.create(n.prototype),o(n,i),i.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return n(e,t,r)},i.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var o=n(e);return void 0!==t?"string"==typeof r?o.fill(t,r):o.fill(t):o.fill(0),o},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}}(nn,nn.exports);var on=nn.exports.Buffer;function sn(e){if(e<0||e>9007199254740991||e%1!=0)throw new RangeError("value out of range")}function un(e){return sn(e),e<253?1:e<=65535?3:e<=4294967295?5:9}var an={encode:function e(t,r,n){if(sn(t),r||(r=on.allocUnsafe(un(t))),!on.isBuffer(r))throw new TypeError("buffer must be a Buffer instance");return n||(n=0),t<253?(r.writeUInt8(t,n),e.bytes=1):t<=65535?(r.writeUInt8(253,n),r.writeUInt16LE(t,n+1),e.bytes=3):t<=4294967295?(r.writeUInt8(254,n),r.writeUInt32LE(t,n+1),e.bytes=5):(r.writeUInt8(255,n),r.writeUInt32LE(t>>>0,n+1),r.writeUInt32LE(t/4294967296|0,n+5),e.bytes=9),r},decode:function e(t,r){if(!on.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");r||(r=0);var n=t.readUInt8(r);if(n<253)return e.bytes=1,n;if(253===n)return e.bytes=3,t.readUInt16LE(r+1);if(254===n)return e.bytes=5,t.readUInt32LE(r+1);e.bytes=9;var o=t.readUInt32LE(r+1),i=4294967296*t.readUInt32LE(r+5)+o;return sn(i),i},encodingLength:un};Object.defineProperty(rn,"__esModule",{value:!0}),rn.BufferReader=rn.BufferWriter=rn.cloneBuffer=rn.reverseBuffer=rn.writeUInt64LE=rn.readUInt64LE=rn.varuint=void 0;const cn=x,{typeforce:fn}=cn,hn=an;function pn(e,t){if("number"!=typeof e)throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}function ln(e,t){const r=e.readUInt32LE(t);let n=e.readUInt32LE(t+4);return n*=4294967296,pn(n+r,9007199254740991),n+r}function dn(e,t,r){return pn(t,9007199254740991),e.writeInt32LE(-1&t,r),e.writeUInt32LE(Math.floor(t/4294967296),r+4),r+8}rn.varuint=hn,rn.readUInt64LE=ln,rn.writeUInt64LE=dn,rn.reverseBuffer=function(e){if(e.length<1)return e;let t=e.length-1,r=0;for(let n=0;n<e.length/2;n++)r=e[n],e[n]=e[t],e[t]=r,t--;return e},rn.cloneBuffer=function(e){const t=d.allocUnsafe(e.length);return e.copy(t),t};class yn{static withCapacity(e){return new yn(d.alloc(e))}constructor(e,t=0){this.buffer=e,this.offset=t,fn(cn.tuple(cn.Buffer,cn.UInt32),[e,t])}writeUInt8(e){this.offset=this.buffer.writeUInt8(e,this.offset)}writeInt32(e){this.offset=this.buffer.writeInt32LE(e,this.offset)}writeUInt32(e){this.offset=this.buffer.writeUInt32LE(e,this.offset)}writeUInt64(e){this.offset=dn(this.buffer,e,this.offset)}writeVarInt(e){hn.encode(e,this.buffer,this.offset),this.offset+=hn.encode.bytes}writeSlice(e){if(this.buffer.length<this.offset+e.length)throw new Error("Cannot write slice out of bounds");this.offset+=e.copy(this.buffer,this.offset)}writeVarSlice(e){this.writeVarInt(e.length),this.writeSlice(e)}writeVector(e){this.writeVarInt(e.length),e.forEach(e=>this.writeVarSlice(e))}end(){if(this.buffer.length===this.offset)return this.buffer;throw new Error(`buffer size ${this.buffer.length}, offset ${this.offset}`)}}var wn,gn,bn;function mn(){return gn||(gn=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.p2tr=e.p2wsh=e.p2wpkh=e.p2sh=e.p2pkh=e.p2pk=e.p2ms=e.embed=void 0;const t=E;Object.defineProperty(e,"embed",{enumerable:!0,get:function(){return t.p2data}});const r=de;Object.defineProperty(e,"p2ms",{enumerable:!0,get:function(){return r.p2ms}});const n=Se;Object.defineProperty(e,"p2pk",{enumerable:!0,get:function(){return n.p2pk}});const o=Ae;Object.defineProperty(e,"p2pkh",{enumerable:!0,get:function(){return o.p2pkh}});const i=pr;Object.defineProperty(e,"p2sh",{enumerable:!0,get:function(){return i.p2sh}});const s=Er;Object.defineProperty(e,"p2wpkh",{enumerable:!0,get:function(){return s.p2wpkh}});const u=Vr;Object.defineProperty(e,"p2wsh",{enumerable:!0,get:function(){return u.p2wsh}});const a=function(){if(wn)return zr;wn=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.p2tr=void 0;const e=H,t=b,r=ue(),n=x,o=Yr,i=tn,s=ae,u=Sr,a=En(),c=r.OPS;return zr.p2tr=function(f,h){if(!(f.address||f.output||f.pubkey||f.internalPubkey||f.witness&&f.witness.length>1))throw new TypeError("Not enough data");h=Object.assign({validate:!0},h||{}),(0,n.typeforce)({address:n.typeforce.maybe(n.typeforce.String),input:n.typeforce.maybe(n.typeforce.BufferN(0)),network:n.typeforce.maybe(n.typeforce.Object),output:n.typeforce.maybe(n.typeforce.BufferN(34)),internalPubkey:n.typeforce.maybe(n.typeforce.BufferN(32)),hash:n.typeforce.maybe(n.typeforce.BufferN(32)),pubkey:n.typeforce.maybe(n.typeforce.BufferN(32)),signature:n.typeforce.maybe(n.typeforce.anyOf(n.typeforce.BufferN(64),n.typeforce.BufferN(65))),witness:n.typeforce.maybe(n.typeforce.arrayOf(n.typeforce.Buffer)),scriptTree:n.typeforce.maybe(n.isTaptree),redeem:n.typeforce.maybe({output:n.typeforce.maybe(n.typeforce.Buffer),redeemVersion:n.typeforce.maybe(n.typeforce.Number),witness:n.typeforce.maybe(n.typeforce.arrayOf(n.typeforce.Buffer))}),redeemVersion:n.typeforce.maybe(n.typeforce.Number)},f);const p=s.value(()=>(0,a.fromBech32)(f.address)),l=s.value(()=>{if(f.witness&&f.witness.length)return f.witness.length>=2&&80===f.witness[f.witness.length-1][0]?f.witness.slice(0,-1):f.witness.slice()}),d=s.value(()=>f.scriptTree?(0,i.toHashTree)(f.scriptTree):f.hash?{hash:f.hash}:void 0),y=f.network||t.bitcoin,w={name:"p2tr",network:y};if(s.prop(w,"address",()=>{if(!w.pubkey)return;const e=u.bech32m.toWords(w.pubkey);return e.unshift(1),u.bech32m.encode(y.bech32,e)}),s.prop(w,"hash",()=>{const e=d();if(e)return e.hash;const t=l();if(t&&t.length>1){const e=t[t.length-1],r=e[0]&n.TAPLEAF_VERSION_MASK,o=t[t.length-2],s=(0,i.tapleafHash)({output:o,version:r});return(0,i.rootHashFromPath)(e,s)}return null}),s.prop(w,"output",()=>{if(w.pubkey)return r.compile([c.OP_1,w.pubkey])}),s.prop(w,"redeemVersion",()=>f.redeemVersion?f.redeemVersion:f.redeem&&void 0!==f.redeem.redeemVersion&&null!==f.redeem.redeemVersion?f.redeem.redeemVersion:i.LEAF_VERSION_TAPSCRIPT),s.prop(w,"redeem",()=>{const e=l();if(e&&!(e.length<2))return{output:e[e.length-2],witness:e.slice(0,-2),redeemVersion:e[e.length-1][0]&n.TAPLEAF_VERSION_MASK}}),s.prop(w,"pubkey",()=>{if(f.pubkey)return f.pubkey;if(f.output)return f.output.slice(2);if(f.address)return p().data;if(w.internalPubkey){const e=(0,i.tweakKey)(w.internalPubkey,w.hash);if(e)return e.x}}),s.prop(w,"internalPubkey",()=>{if(f.internalPubkey)return f.internalPubkey;const e=l();return e&&e.length>1?e[e.length-1].slice(1,33):void 0}),s.prop(w,"signature",()=>{if(f.signature)return f.signature;const e=l();return e&&1===e.length?e[0]:void 0}),s.prop(w,"witness",()=>{if(f.witness)return f.witness;const t=d();if(t&&f.redeem&&f.redeem.output&&f.internalPubkey){const r=(0,i.tapleafHash)({output:f.redeem.output,version:w.redeemVersion}),n=(0,i.findScriptPath)(t,r);if(!n)return;const o=(0,i.tweakKey)(f.internalPubkey,t.hash);if(!o)return;const s=e.Buffer.concat([e.Buffer.from([w.redeemVersion|o.parity]),f.internalPubkey].concat(n));return[f.redeem.output,s]}return f.signature?[f.signature]:void 0}),h.validate){let t=e.Buffer.from([]);if(f.address){if(y&&y.bech32!==p().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(1!==p().version)throw new TypeError("Invalid address version");if(32!==p().data.length)throw new TypeError("Invalid address data");t=p().data}if(f.pubkey){if(t.length>0&&!t.equals(f.pubkey))throw new TypeError("Pubkey mismatch");t=f.pubkey}if(f.output){if(34!==f.output.length||f.output[0]!==c.OP_1||32!==f.output[1])throw new TypeError("Output is invalid");if(t.length>0&&!t.equals(f.output.slice(2)))throw new TypeError("Pubkey mismatch");t=f.output.slice(2)}if(f.internalPubkey){const e=(0,i.tweakKey)(f.internalPubkey,w.hash);if(t.length>0&&!t.equals(e.x))throw new TypeError("Pubkey mismatch");t=e.x}if(t&&t.length&&!(0,o.getEccLib)().isXOnlyPoint(t))throw new TypeError("Invalid pubkey for p2tr");const s=d();if(f.hash&&s&&!f.hash.equals(s.hash))throw new TypeError("Hash mismatch");if(f.redeem&&f.redeem.output&&s){const e=(0,i.tapleafHash)({output:f.redeem.output,version:w.redeemVersion});if(!(0,i.findScriptPath)(s,e))throw new TypeError("Redeem script not in tree")}const u=l();if(f.redeem&&w.redeem){if(f.redeem.redeemVersion&&f.redeem.redeemVersion!==w.redeem.redeemVersion)throw new TypeError("Redeem.redeemVersion and witness mismatch");if(f.redeem.output){if(0===r.decompile(f.redeem.output).length)throw new TypeError("Redeem.output is invalid");if(w.redeem.output&&!f.redeem.output.equals(w.redeem.output))throw new TypeError("Redeem.output and witness mismatch")}if(f.redeem.witness&&w.redeem.witness&&!(0,n.stacksEqual)(f.redeem.witness,w.redeem.witness))throw new TypeError("Redeem.witness and witness mismatch")}if(u&&u.length)if(1===u.length){if(f.signature&&!f.signature.equals(u[0]))throw new TypeError("Signature mismatch")}else{const e=u[u.length-1];if(e.length<33)throw new TypeError(`The control-block length is too small. Got ${e.length}, expected min 33.`);if((e.length-33)%32!=0)throw new TypeError(`The control-block length of ${e.length} is incorrect!`);const r=(e.length-33)/32;if(r>128)throw new TypeError(`The script path is too long. Got ${r}, expected max 128.`);const s=e.slice(1,33);if(f.internalPubkey&&!f.internalPubkey.equals(s))throw new TypeError("Internal pubkey mismatch");if(!(0,o.getEccLib)().isXOnlyPoint(s))throw new TypeError("Invalid internalPubkey for p2tr witness");const a=e[0]&n.TAPLEAF_VERSION_MASK,c=u[u.length-2],h=(0,i.tapleafHash)({output:c,version:a}),p=(0,i.rootHashFromPath)(e,h),l=(0,i.tweakKey)(s,p);if(!l)throw new TypeError("Invalid outputKey for p2tr witness");if(t.length&&!t.equals(l.x))throw new TypeError("Pubkey mismatch for p2tr witness");if(l.parity!==(1&e[0]))throw new Error("Incorrect parity")}}return Object.assign(w,f)},zr}();Object.defineProperty(e,"p2tr",{enumerable:!0,get:function(){return a.p2tr}})}(m)),m}function En(){if(bn)return g;bn=1,Object.defineProperty(g,"__esModule",{value:!0}),g.toOutputScript=g.fromOutputScript=g.toBech32=g.toBase58Check=g.fromBech32=g.fromBase58Check=void 0;const e=b,t=mn(),r=ue(),n=x,o=Sr,i=or;function s(e){const t=d.from(i.decode(e));if(t.length<21)throw new TypeError(e+" is too short");if(t.length>21)throw new TypeError(e+" is too long");return{version:t.readUInt8(0),hash:t.slice(1)}}function u(e){let t,r;try{t=o.bech32.decode(e)}catch(i){}if(t){if(r=t.words[0],0!==r)throw new TypeError(e+" uses wrong encoding")}else if(t=o.bech32m.decode(e),r=t.words[0],0===r)throw new TypeError(e+" uses wrong encoding");const n=o.bech32.fromWords(t.words.slice(1));return{version:r,prefix:t.prefix,data:d.from(n)}}function a(e,t,r){const n=o.bech32.toWords(e);return n.unshift(t),0===t?o.bech32.encode(r,n):o.bech32m.encode(r,n)}return g.fromBase58Check=s,g.fromBech32=u,g.toBase58Check=function(e,t){(0,n.typeforce)((0,n.tuple)(n.Hash160bit,n.UInt8),arguments);const r=d.allocUnsafe(21);return r.writeUInt8(t,0),e.copy(r,1),i.encode(r)},g.toBech32=a,g.fromOutputScript=function(n,o){o=o||e.bitcoin;try{return t.p2pkh({output:n,network:o}).address}catch(i){}try{return t.p2sh({output:n,network:o}).address}catch(i){}try{return t.p2wpkh({output:n,network:o}).address}catch(i){}try{return t.p2wsh({output:n,network:o}).address}catch(i){}try{return t.p2tr({output:n,network:o}).address}catch(i){}try{return function(e,t){const r=e.slice(2);if(r.length<2||r.length>40)throw new TypeError("Invalid program length for segwit address");const n=e[0]-80;if(n<2||n>16)throw new TypeError("Invalid version for segwit address");if(e[1]!==r.length)throw new TypeError("Invalid script for segwit address");return a(r,n,t.bech32)}(n,o)}catch(i){}throw new Error(r.toASM(n)+" has no matching Address")},g.toOutputScript=function(n,o){let i,a;o=o||e.bitcoin;try{i=s(n)}catch(c){}if(i){if(i.version===o.pubKeyHash)return t.p2pkh({hash:i.hash}).output;if(i.version===o.scriptHash)return t.p2sh({hash:i.hash}).output}else{try{a=u(n)}catch(c){}if(a){if(a.prefix!==o.bech32)throw new Error(n+" has an invalid prefix");if(0===a.version){if(20===a.data.length)return t.p2wpkh({hash:a.data}).output;if(32===a.data.length)return t.p2wsh({hash:a.data}).output}else if(1===a.version){if(32===a.data.length)return t.p2tr({pubkey:a.data}).output}else if(a.version>=2&&a.version<=16&&a.data.length>=2&&a.data.length<=40)return r.compile([a.version+80,a.data])}}throw new Error(n+" has no matching Script")},g}rn.BufferWriter=yn,rn.BufferReader=class{constructor(e,t=0){this.buffer=e,this.offset=t,fn(cn.tuple(cn.Buffer,cn.UInt32),[e,t])}readUInt8(){const e=this.buffer.readUInt8(this.offset);return this.offset++,e}readInt32(){const e=this.buffer.readInt32LE(this.offset);return this.offset+=4,e}readUInt32(){const e=this.buffer.readUInt32LE(this.offset);return this.offset+=4,e}readUInt64(){const e=ln(this.buffer,this.offset);return this.offset+=8,e}readVarInt(){const e=hn.decode(this.buffer,this.offset);return this.offset+=hn.decode.bytes,e}readSlice(e){if(this.buffer.length<this.offset+e)throw new Error("Cannot read slice out of bounds");const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const e=this.readVarInt(),t=[];for(let r=0;r<e;r++)t.push(this.readVarSlice());return t}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.tweakKey=e.tapTweakHash=e.tapleafHash=e.findScriptPath=e.toHashTree=e.rootHashFromPath=e.MAX_TAPTREE_DEPTH=e.LEAF_VERSION_TAPSCRIPT=void 0;const t=H,r=Yr,n=Be,o=rn,i=x;function s(r){const o=r.version||e.LEAF_VERSION_TAPSCRIPT;return n.taggedHash("TapLeaf",t.Buffer.concat([t.Buffer.from([o]),c(r.output)]))}function u(e,r){return n.taggedHash("TapTweak",t.Buffer.concat(r?[e,r]:[e]))}function a(e,r){return n.taggedHash("TapBranch",t.Buffer.concat([e,r]))}function c(e){const r=o.varuint.encodingLength(e.length),n=t.Buffer.allocUnsafe(r);return o.varuint.encode(e.length,n),t.Buffer.concat([n,e])}e.LEAF_VERSION_TAPSCRIPT=192,e.MAX_TAPTREE_DEPTH=128,e.rootHashFromPath=function(e,t){if(e.length<33)throw new TypeError(`The control-block length is too small. Got ${e.length}, expected min 33.`);const r=(e.length-33)/32;let n=t;for(let o=0;o<r;o++){const t=e.slice(33+32*o,65+32*o);n=n.compare(t)<0?a(n,t):a(t,n)}return n},e.toHashTree=function e(t){if((0,i.isTapleaf)(t))return{hash:s(t)};const r=[e(t[0]),e(t[1])];r.sort((e,t)=>e.hash.compare(t.hash));const[n,o]=r;return{hash:a(n.hash,o.hash),left:n,right:o}},e.findScriptPath=function e(t,r){if("left"in(n=t)&&"right"in n){const n=e(t.left,r);if(void 0!==n)return[...n,t.right.hash];const o=e(t.right,r);if(void 0!==o)return[...o,t.left.hash]}else if(t.hash.equals(r))return[];var n},e.tapleafHash=s,e.tapTweakHash=u,e.tweakKey=function(e,n){if(!t.Buffer.isBuffer(e))return null;if(32!==e.length)return null;if(n&&32!==n.length)return null;const o=u(e,n),i=(0,r.getEccLib)().xOnlyPointAddTweak(e,o);return i&&null!==i.xOnlyPubkey?{parity:i.parity,x:t.Buffer.from(i.xOnlyPubkey)}:null}}(tn);var Sn={},vn={};Object.defineProperty(vn,"__esModule",{value:!0}),vn.fastMerkleRoot=void 0,vn.fastMerkleRoot=function(e,t){if(!Array.isArray(e))throw TypeError("Expected values Array");if("function"!=typeof t)throw TypeError("Expected digest Function");let r=e.length;const n=e.concat();for(;r>1;){let e=0;for(let o=0;o<r;o+=2,++e){const i=n[o],s=o+1===r?i:n[o+1],u=d.concat([i,s]);n[e]=t(u)}r=e}return n[0]};var Tn={};Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.Transaction=void 0;const _n=rn,In=Be,On=ue(),An=ue(),Bn=x,{typeforce:kn}=Bn;function Pn(e){const t=e.length;return _n.varuint.encodingLength(t)+t}const xn=d.allocUnsafe(0),Hn=[],Un=d.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),Nn=d.from("0000000000000000000000000000000000000000000000000000000000000001","hex"),Rn=d.from("ffffffffffffffff","hex"),Cn={script:xn,valueBuffer:Rn};class Ln{constructor(){this.version=1,this.locktime=0,this.ins=[],this.outs=[]}static fromBuffer(e,t){const r=new _n.BufferReader(e),n=new Ln;n.version=r.readInt32();const o=r.readUInt8(),i=r.readUInt8();let s=!1;o===Ln.ADVANCED_TRANSACTION_MARKER&&i===Ln.ADVANCED_TRANSACTION_FLAG?s=!0:r.offset-=2;const u=r.readVarInt();for(let c=0;c<u;++c)n.ins.push({hash:r.readSlice(32),index:r.readUInt32(),script:r.readVarSlice(),sequence:r.readUInt32(),witness:Hn});const a=r.readVarInt();for(let c=0;c<a;++c)n.outs.push({value:r.readUInt64(),script:r.readVarSlice()});if(s){for(let e=0;e<u;++e)n.ins[e].witness=r.readVector();if(!n.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(n.locktime=r.readUInt32(),t)return n;if(r.offset!==e.length)throw new Error("Transaction has unexpected data");return n}static fromHex(e){return Ln.fromBuffer(d.from(e,"hex"),!1)}static isCoinbaseHash(e){kn(Bn.Hash256bit,e);for(let t=0;t<32;++t)if(0!==e[t])return!1;return!0}isCoinbase(){return 1===this.ins.length&&Ln.isCoinbaseHash(this.ins[0].hash)}addInput(e,t,r,n){return kn(Bn.tuple(Bn.Hash256bit,Bn.UInt32,Bn.maybe(Bn.UInt32),Bn.maybe(Bn.Buffer)),arguments),Bn.Null(r)&&(r=Ln.DEFAULT_SEQUENCE),this.ins.push({hash:e,index:t,script:n||xn,sequence:r,witness:Hn})-1}addOutput(e,t){return kn(Bn.tuple(Bn.Buffer,Bn.Satoshi),arguments),this.outs.push({script:e,value:t})-1}hasWitnesses(){return this.ins.some(e=>0!==e.witness.length)}stripWitnesses(){this.ins.forEach(e=>{e.witness=Hn})}weight(){return 3*this.byteLength(!1)+this.byteLength(!0)}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(e=!0){const t=e&&this.hasWitnesses();return(t?10:8)+_n.varuint.encodingLength(this.ins.length)+_n.varuint.encodingLength(this.outs.length)+this.ins.reduce((e,t)=>e+40+Pn(t.script),0)+this.outs.reduce((e,t)=>e+8+Pn(t.script),0)+(t?this.ins.reduce((e,t)=>e+function(e){const t=e.length;return _n.varuint.encodingLength(t)+e.reduce((e,t)=>e+Pn(t),0)}(t.witness),0):0)}clone(){const e=new Ln;return e.version=this.version,e.locktime=this.locktime,e.ins=this.ins.map(e=>({hash:e.hash,index:e.index,script:e.script,sequence:e.sequence,witness:e.witness})),e.outs=this.outs.map(e=>({script:e.script,value:e.value})),e}hashForSignature(e,t,r){if(kn(Bn.tuple(Bn.UInt32,Bn.Buffer,Bn.Number),arguments),e>=this.ins.length)return Nn;const n=On.compile(On.decompile(t).filter(e=>e!==An.OPS.OP_CODESEPARATOR)),o=this.clone();if((31&r)===Ln.SIGHASH_NONE)o.outs=[],o.ins.forEach((t,r)=>{r!==e&&(t.sequence=0)});else if((31&r)===Ln.SIGHASH_SINGLE){if(e>=this.outs.length)return Nn;o.outs.length=e+1;for(let t=0;t<e;t++)o.outs[t]=Cn;o.ins.forEach((t,r)=>{r!==e&&(t.sequence=0)})}r&Ln.SIGHASH_ANYONECANPAY?(o.ins=[o.ins[e]],o.ins[0].script=n):(o.ins.forEach(e=>{e.script=xn}),o.ins[e].script=n);const i=d.allocUnsafe(o.byteLength(!1)+4);return i.writeInt32LE(r,i.length-4),o.__toBuffer(i,0,!1),In.hash256(i)}hashForWitnessV1(e,t,r,n,o,i){if(kn(Bn.tuple(Bn.UInt32,kn.arrayOf(Bn.Buffer),kn.arrayOf(Bn.Satoshi),Bn.UInt32),arguments),r.length!==this.ins.length||t.length!==this.ins.length)throw new Error("Must supply prevout script and value for all inputs");const s=n===Ln.SIGHASH_DEFAULT?Ln.SIGHASH_ALL:n&Ln.SIGHASH_OUTPUT_MASK,u=(n&Ln.SIGHASH_INPUT_MASK)===Ln.SIGHASH_ANYONECANPAY,a=s===Ln.SIGHASH_NONE,c=s===Ln.SIGHASH_SINGLE;let f=xn,h=xn,p=xn,l=xn,y=xn;if(!u){let e=_n.BufferWriter.withCapacity(36*this.ins.length);this.ins.forEach(t=>{e.writeSlice(t.hash),e.writeUInt32(t.index)}),f=In.sha256(e.end()),e=_n.BufferWriter.withCapacity(8*this.ins.length),r.forEach(t=>e.writeUInt64(t)),h=In.sha256(e.end()),e=_n.BufferWriter.withCapacity(t.map(Pn).reduce((e,t)=>e+t)),t.forEach(t=>e.writeVarSlice(t)),p=In.sha256(e.end()),e=_n.BufferWriter.withCapacity(4*this.ins.length),this.ins.forEach(t=>e.writeUInt32(t.sequence)),l=In.sha256(e.end())}if(a||c){if(c&&e<this.outs.length){const t=this.outs[e],r=_n.BufferWriter.withCapacity(8+Pn(t.script));r.writeUInt64(t.value),r.writeVarSlice(t.script),y=In.sha256(r.end())}}else{const e=this.outs.map(e=>8+Pn(e.script)).reduce((e,t)=>e+t),t=_n.BufferWriter.withCapacity(e);this.outs.forEach(e=>{t.writeUInt64(e.value),t.writeVarSlice(e.script)}),y=In.sha256(t.end())}const w=(o?2:0)+(i?1:0),g=174-(u?49:0)-(a?32:0)+(i?32:0)+(o?37:0),b=_n.BufferWriter.withCapacity(g);if(b.writeUInt8(n),b.writeInt32(this.version),b.writeUInt32(this.locktime),b.writeSlice(f),b.writeSlice(h),b.writeSlice(p),b.writeSlice(l),a||c||b.writeSlice(y),b.writeUInt8(w),u){const n=this.ins[e];b.writeSlice(n.hash),b.writeUInt32(n.index),b.writeUInt64(r[e]),b.writeVarSlice(t[e]),b.writeUInt32(n.sequence)}else b.writeUInt32(e);if(i){const e=_n.BufferWriter.withCapacity(Pn(i));e.writeVarSlice(i),b.writeSlice(In.sha256(e.end()))}return c&&b.writeSlice(y),o&&(b.writeSlice(o),b.writeUInt8(0),b.writeUInt32(4294967295)),In.taggedHash("TapSighash",d.concat([d.from([0]),b.end()]))}hashForWitnessV0(e,t,r,n){kn(Bn.tuple(Bn.UInt32,Bn.Buffer,Bn.Satoshi,Bn.UInt32),arguments);let o,i=d.from([]),s=Un,u=Un,a=Un;if(n&Ln.SIGHASH_ANYONECANPAY||(i=d.allocUnsafe(36*this.ins.length),o=new _n.BufferWriter(i,0),this.ins.forEach(e=>{o.writeSlice(e.hash),o.writeUInt32(e.index)}),u=In.hash256(i)),n&Ln.SIGHASH_ANYONECANPAY||(31&n)===Ln.SIGHASH_SINGLE||(31&n)===Ln.SIGHASH_NONE||(i=d.allocUnsafe(4*this.ins.length),o=new _n.BufferWriter(i,0),this.ins.forEach(e=>{o.writeUInt32(e.sequence)}),a=In.hash256(i)),(31&n)!==Ln.SIGHASH_SINGLE&&(31&n)!==Ln.SIGHASH_NONE){const e=this.outs.reduce((e,t)=>e+8+Pn(t.script),0);i=d.allocUnsafe(e),o=new _n.BufferWriter(i,0),this.outs.forEach(e=>{o.writeUInt64(e.value),o.writeVarSlice(e.script)}),s=In.hash256(i)}else if((31&n)===Ln.SIGHASH_SINGLE&&e<this.outs.length){const t=this.outs[e];i=d.allocUnsafe(8+Pn(t.script)),o=new _n.BufferWriter(i,0),o.writeUInt64(t.value),o.writeVarSlice(t.script),s=In.hash256(i)}i=d.allocUnsafe(156+Pn(t)),o=new _n.BufferWriter(i,0);const c=this.ins[e];return o.writeInt32(this.version),o.writeSlice(u),o.writeSlice(a),o.writeSlice(c.hash),o.writeUInt32(c.index),o.writeVarSlice(t),o.writeUInt64(r),o.writeUInt32(c.sequence),o.writeSlice(s),o.writeUInt32(this.locktime),o.writeUInt32(n),In.hash256(i)}getHash(e){return e&&this.isCoinbase()?d.alloc(32,0):In.hash256(this.__toBuffer(void 0,void 0,e))}getId(){return(0,_n.reverseBuffer)(this.getHash(!1)).toString("hex")}toBuffer(e,t){return this.__toBuffer(e,t,!0)}toHex(){return this.toBuffer(void 0,void 0).toString("hex")}setInputScript(e,t){kn(Bn.tuple(Bn.Number,Bn.Buffer),arguments),this.ins[e].script=t}setWitness(e,t){kn(Bn.tuple(Bn.Number,[Bn.Buffer]),arguments),this.ins[e].witness=t}__toBuffer(e,t,r=!1){e||(e=d.allocUnsafe(this.byteLength(r)));const n=new _n.BufferWriter(e,t||0);n.writeInt32(this.version);const o=r&&this.hasWitnesses();return o&&(n.writeUInt8(Ln.ADVANCED_TRANSACTION_MARKER),n.writeUInt8(Ln.ADVANCED_TRANSACTION_FLAG)),n.writeVarInt(this.ins.length),this.ins.forEach(e=>{n.writeSlice(e.hash),n.writeUInt32(e.index),n.writeVarSlice(e.script),n.writeUInt32(e.sequence)}),n.writeVarInt(this.outs.length),this.outs.forEach(e=>{void 0!==e.value?n.writeUInt64(e.value):n.writeSlice(e.valueBuffer),n.writeVarSlice(e.script)}),o&&this.ins.forEach(e=>{n.writeVector(e.witness)}),n.writeUInt32(this.locktime),void 0!==t?e.slice(t,n.offset):e}}Tn.Transaction=Ln,Ln.DEFAULT_SEQUENCE=4294967295,Ln.SIGHASH_DEFAULT=0,Ln.SIGHASH_ALL=1,Ln.SIGHASH_NONE=2,Ln.SIGHASH_SINGLE=3,Ln.SIGHASH_ANYONECANPAY=128,Ln.SIGHASH_OUTPUT_MASK=3,Ln.SIGHASH_INPUT_MASK=128,Ln.ADVANCED_TRANSACTION_MARKER=0,Ln.ADVANCED_TRANSACTION_FLAG=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.Block=void 0;const Fn=rn,Vn=Be,Dn=vn,Mn=Tn,Kn=x,{typeforce:jn}=Kn,Gn=new TypeError("Cannot compute merkle root for zero transactions"),Wn=new TypeError("Cannot compute witness commit for non-segwit block");class qn{constructor(){this.version=1,this.prevHash=void 0,this.merkleRoot=void 0,this.timestamp=0,this.witnessCommit=void 0,this.bits=0,this.nonce=0,this.transactions=void 0}static fromBuffer(e){if(e.length<80)throw new Error("Buffer too small (< 80 bytes)");const t=new Fn.BufferReader(e),r=new qn;if(r.version=t.readInt32(),r.prevHash=t.readSlice(32),r.merkleRoot=t.readSlice(32),r.timestamp=t.readUInt32(),r.bits=t.readUInt32(),r.nonce=t.readUInt32(),80===e.length)return r;const n=()=>{const e=Mn.Transaction.fromBuffer(t.buffer.slice(t.offset),!0);return t.offset+=e.byteLength(),e},o=t.readVarInt();r.transactions=[];for(let s=0;s<o;++s){const e=n();r.transactions.push(e)}const i=r.getWitnessCommit();return i&&(r.witnessCommit=i),r}static fromHex(e){return qn.fromBuffer(d.from(e,"hex"))}static calculateTarget(e){const t=((4278190080&e)>>24)-3,r=8388607&e,n=d.alloc(32,0);return n.writeUIntBE(r,29-t,3),n}static calculateMerkleRoot(e,t){if(jn([{getHash:Kn.Function}],e),0===e.length)throw Gn;if(t&&!Xn(e))throw Wn;const r=e.map(e=>e.getHash(t)),n=(0,Dn.fastMerkleRoot)(r,Vn.hash256);return t?Vn.hash256(d.concat([n,e[0].ins[0].witness[0]])):n}getWitnessCommit(){if(!Xn(this.transactions))return null;const e=this.transactions[0].outs.filter(e=>e.script.slice(0,6).equals(d.from("6a24aa21a9ed","hex"))).map(e=>e.script.slice(6,38));if(0===e.length)return null;const t=e[e.length-1];return t instanceof d&&32===t.length?t:null}hasWitnessCommit(){return this.witnessCommit instanceof d&&32===this.witnessCommit.length||null!==this.getWitnessCommit()}hasWitness(){return(e=this.transactions)instanceof Array&&e.some(e=>"object"==typeof e&&e.ins instanceof Array&&e.ins.some(e=>"object"==typeof e&&e.witness instanceof Array&&e.witness.length>0));var e}weight(){return 3*this.byteLength(!1,!1)+this.byteLength(!1,!0)}byteLength(e,t=!0){return e||!this.transactions?80:80+Fn.varuint.encodingLength(this.transactions.length)+this.transactions.reduce((e,r)=>e+r.byteLength(t),0)}getHash(){return Vn.hash256(this.toBuffer(!0))}getId(){return(0,Fn.reverseBuffer)(this.getHash()).toString("hex")}getUTCDate(){const e=new Date(0);return e.setUTCSeconds(this.timestamp),e}toBuffer(e){const t=d.allocUnsafe(this.byteLength(e)),r=new Fn.BufferWriter(t);return r.writeInt32(this.version),r.writeSlice(this.prevHash),r.writeSlice(this.merkleRoot),r.writeUInt32(this.timestamp),r.writeUInt32(this.bits),r.writeUInt32(this.nonce),e||!this.transactions||(Fn.varuint.encode(this.transactions.length,t,r.offset),r.offset+=Fn.varuint.encode.bytes,this.transactions.forEach(e=>{const n=e.byteLength();e.toBuffer(t,r.offset),r.offset+=n})),t}toHex(e){return this.toBuffer(e).toString("hex")}checkTxRoots(){const e=this.hasWitnessCommit();return!(!e&&this.hasWitness())&&this.__checkMerkleRoot()&&(!e||this.__checkWitnessCommit())}checkProofOfWork(){const e=(0,Fn.reverseBuffer)(this.getHash()),t=qn.calculateTarget(this.bits);return e.compare(t)<=0}__checkMerkleRoot(){if(!this.transactions)throw Gn;const e=qn.calculateMerkleRoot(this.transactions);return 0===this.merkleRoot.compare(e)}__checkWitnessCommit(){if(!this.transactions)throw Gn;if(!this.hasWitnessCommit())throw Wn;const e=qn.calculateMerkleRoot(this.transactions,!0);return 0===this.witnessCommit.compare(e)}}function Xn(e){return e instanceof Array&&e[0]&&e[0].ins&&e[0].ins instanceof Array&&e[0].ins[0]&&e[0].ins[0].witness&&e[0].ins[0].witness instanceof Array&&e[0].ins[0].witness.length>0}Sn.Block=qn;var $n,zn,Yn,Zn,Jn={},Qn={},eo={},to={},ro={},no={},oo={};$n=oo,Object.defineProperty($n,"__esModule",{value:!0}),(zn=$n.GlobalTypes||($n.GlobalTypes={}))[zn.UNSIGNED_TX=0]="UNSIGNED_TX",zn[zn.GLOBAL_XPUB=1]="GLOBAL_XPUB",$n.GLOBAL_TYPE_NAMES=["unsignedTx","globalXpub"],(Yn=$n.InputTypes||($n.InputTypes={}))[Yn.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",Yn[Yn.WITNESS_UTXO=1]="WITNESS_UTXO",Yn[Yn.PARTIAL_SIG=2]="PARTIAL_SIG",Yn[Yn.SIGHASH_TYPE=3]="SIGHASH_TYPE",Yn[Yn.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",Yn[Yn.WITNESS_SCRIPT=5]="WITNESS_SCRIPT",Yn[Yn.BIP32_DERIVATION=6]="BIP32_DERIVATION",Yn[Yn.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",Yn[Yn.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",Yn[Yn.POR_COMMITMENT=9]="POR_COMMITMENT",Yn[Yn.TAP_KEY_SIG=19]="TAP_KEY_SIG",Yn[Yn.TAP_SCRIPT_SIG=20]="TAP_SCRIPT_SIG",Yn[Yn.TAP_LEAF_SCRIPT=21]="TAP_LEAF_SCRIPT",Yn[Yn.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION",Yn[Yn.TAP_INTERNAL_KEY=23]="TAP_INTERNAL_KEY",Yn[Yn.TAP_MERKLE_ROOT=24]="TAP_MERKLE_ROOT",$n.INPUT_TYPE_NAMES=["nonWitnessUtxo","witnessUtxo","partialSig","sighashType","redeemScript","witnessScript","bip32Derivation","finalScriptSig","finalScriptWitness","porCommitment","tapKeySig","tapScriptSig","tapLeafScript","tapBip32Derivation","tapInternalKey","tapMerkleRoot"],(Zn=$n.OutputTypes||($n.OutputTypes={}))[Zn.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",Zn[Zn.WITNESS_SCRIPT=1]="WITNESS_SCRIPT",Zn[Zn.BIP32_DERIVATION=2]="BIP32_DERIVATION",Zn[Zn.TAP_INTERNAL_KEY=5]="TAP_INTERNAL_KEY",Zn[Zn.TAP_TREE=6]="TAP_TREE",Zn[Zn.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION",$n.OUTPUT_TYPE_NAMES=["redeemScript","witnessScript","bip32Derivation","tapInternalKey","tapTree","tapBip32Derivation"];var io={};Object.defineProperty(io,"__esModule",{value:!0});const so=oo;io.decode=function(e){if(e.key[0]!==so.GlobalTypes.GLOBAL_XPUB)throw new Error("Decode Error: could not decode globalXpub with key 0x"+e.key.toString("hex"));if(79!==e.key.length||![2,3].includes(e.key[46]))throw new Error("Decode Error: globalXpub has invalid extended pubkey in key 0x"+e.key.toString("hex"));if(e.value.length/4%1!=0)throw new Error("Decode Error: Global GLOBAL_XPUB value length should be multiple of 4");const t=e.key.slice(1),r={masterFingerprint:e.value.slice(0,4),extendedPubkey:t,path:"m"};for(const o of(n=e.value.length/4-1,[...Array(n).keys()])){const t=e.value.readUInt32LE(4*o+4),n=!!(2147483648&t),i=2147483647&t;r.path+="/"+i.toString(10)+(n?"'":"")}var n;return r},io.encode=function(e){const t=d.from([so.GlobalTypes.GLOBAL_XPUB]),r=d.concat([t,e.extendedPubkey]),n=e.path.split("/"),o=d.allocUnsafe(4*n.length);e.masterFingerprint.copy(o,0);let i=4;return n.slice(1).forEach(e=>{const t="'"===e.slice(-1);let r=2147483647&parseInt(t?e.slice(0,-1):e,10);t&&(r+=2147483648),o.writeUInt32LE(r,i),i+=4}),{key:r,value:o}},io.expected="{ masterFingerprint: Buffer; extendedPubkey: Buffer; path: string; }",io.check=function(e){const t=e.extendedPubkey,r=e.masterFingerprint,n=e.path;return d.isBuffer(t)&&78===t.length&&[2,3].indexOf(t[45])>-1&&d.isBuffer(r)&&4===r.length&&"string"==typeof n&&!!n.match(/^m(\/\d+'?)*$/)},io.canAddToArray=function(e,t,r){const n=t.extendedPubkey.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter(e=>e.extendedPubkey.equals(t.extendedPubkey)).length)};var uo={};Object.defineProperty(uo,"__esModule",{value:!0});const ao=oo;uo.encode=function(e){return{key:d.from([ao.GlobalTypes.UNSIGNED_TX]),value:e.toBuffer()}};var co={};Object.defineProperty(co,"__esModule",{value:!0});const fo=oo;co.decode=function(e){if(e.key[0]!==fo.InputTypes.FINAL_SCRIPTSIG)throw new Error("Decode Error: could not decode finalScriptSig with key 0x"+e.key.toString("hex"));return e.value},co.encode=function(e){return{key:d.from([fo.InputTypes.FINAL_SCRIPTSIG]),value:e}},co.expected="Buffer",co.check=function(e){return d.isBuffer(e)},co.canAdd=function(e,t){return!!e&&!!t&&void 0===e.finalScriptSig};var ho={};Object.defineProperty(ho,"__esModule",{value:!0});const po=oo;ho.decode=function(e){if(e.key[0]!==po.InputTypes.FINAL_SCRIPTWITNESS)throw new Error("Decode Error: could not decode finalScriptWitness with key 0x"+e.key.toString("hex"));return e.value},ho.encode=function(e){return{key:d.from([po.InputTypes.FINAL_SCRIPTWITNESS]),value:e}},ho.expected="Buffer",ho.check=function(e){return d.isBuffer(e)},ho.canAdd=function(e,t){return!!e&&!!t&&void 0===e.finalScriptWitness};var lo={};Object.defineProperty(lo,"__esModule",{value:!0});const yo=oo;lo.decode=function(e){if(e.key[0]!==yo.InputTypes.NON_WITNESS_UTXO)throw new Error("Decode Error: could not decode nonWitnessUtxo with key 0x"+e.key.toString("hex"));return e.value},lo.encode=function(e){return{key:d.from([yo.InputTypes.NON_WITNESS_UTXO]),value:e}},lo.expected="Buffer",lo.check=function(e){return d.isBuffer(e)},lo.canAdd=function(e,t){return!!e&&!!t&&void 0===e.nonWitnessUtxo};var wo={};Object.defineProperty(wo,"__esModule",{value:!0});const go=oo;wo.decode=function(e){if(e.key[0]!==go.InputTypes.PARTIAL_SIG)throw new Error("Decode Error: could not decode partialSig with key 0x"+e.key.toString("hex"));if(34!==e.key.length&&66!==e.key.length||![2,3,4].includes(e.key[1]))throw new Error("Decode Error: partialSig has invalid pubkey in key 0x"+e.key.toString("hex"));return{pubkey:e.key.slice(1),signature:e.value}},wo.encode=function(e){const t=d.from([go.InputTypes.PARTIAL_SIG]);return{key:d.concat([t,e.pubkey]),value:e.signature}},wo.expected="{ pubkey: Buffer; signature: Buffer; }",wo.check=function(e){return d.isBuffer(e.pubkey)&&d.isBuffer(e.signature)&&[33,65].includes(e.pubkey.length)&&[2,3,4].includes(e.pubkey[0])&&function(e){if(!d.isBuffer(e)||e.length<9)return!1;if(48!==e[0])return!1;if(e.length!==e[1]+3)return!1;if(2!==e[2])return!1;const t=e[3];if(t>33||t<1)return!1;if(2!==e[3+t+1])return!1;const r=e[3+t+2];return!(r>33||r<1)&&e.length===3+t+2+r+2}(e.signature)},wo.canAddToArray=function(e,t,r){const n=t.pubkey.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter(e=>e.pubkey.equals(t.pubkey)).length)};var bo={};Object.defineProperty(bo,"__esModule",{value:!0});const mo=oo;bo.decode=function(e){if(e.key[0]!==mo.InputTypes.POR_COMMITMENT)throw new Error("Decode Error: could not decode porCommitment with key 0x"+e.key.toString("hex"));return e.value.toString("utf8")},bo.encode=function(e){return{key:d.from([mo.InputTypes.POR_COMMITMENT]),value:d.from(e,"utf8")}},bo.expected="string",bo.check=function(e){return"string"==typeof e},bo.canAdd=function(e,t){return!!e&&!!t&&void 0===e.porCommitment};var Eo={};Object.defineProperty(Eo,"__esModule",{value:!0});const So=oo;Eo.decode=function(e){if(e.key[0]!==So.InputTypes.SIGHASH_TYPE)throw new Error("Decode Error: could not decode sighashType with key 0x"+e.key.toString("hex"));return e.value.readUInt32LE(0)},Eo.encode=function(e){const t=d.from([So.InputTypes.SIGHASH_TYPE]),r=d.allocUnsafe(4);return r.writeUInt32LE(e,0),{key:t,value:r}},Eo.expected="number",Eo.check=function(e){return"number"==typeof e},Eo.canAdd=function(e,t){return!!e&&!!t&&void 0===e.sighashType};var vo={};Object.defineProperty(vo,"__esModule",{value:!0});const To=oo;function _o(e){return d.isBuffer(e)&&(64===e.length||65===e.length)}vo.decode=function(e){if(e.key[0]!==To.InputTypes.TAP_KEY_SIG||1!==e.key.length)throw new Error("Decode Error: could not decode tapKeySig with key 0x"+e.key.toString("hex"));if(!_o(e.value))throw new Error("Decode Error: tapKeySig not a valid 64-65-byte BIP340 signature");return e.value},vo.encode=function(e){return{key:d.from([To.InputTypes.TAP_KEY_SIG]),value:e}},vo.expected="Buffer",vo.check=_o,vo.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapKeySig};var Io={};Object.defineProperty(Io,"__esModule",{value:!0});const Oo=oo;Io.decode=function(e){if(e.key[0]!==Oo.InputTypes.TAP_LEAF_SCRIPT)throw new Error("Decode Error: could not decode tapLeafScript with key 0x"+e.key.toString("hex"));if((e.key.length-2)%32!=0)throw new Error("Decode Error: tapLeafScript has invalid control block in key 0x"+e.key.toString("hex"));const t=e.value[e.value.length-1];if((254&e.key[1])!==t)throw new Error("Decode Error: tapLeafScript bad leaf version in key 0x"+e.key.toString("hex"));const r=e.value.slice(0,-1);return{controlBlock:e.key.slice(1),script:r,leafVersion:t}},Io.encode=function(e){const t=d.from([Oo.InputTypes.TAP_LEAF_SCRIPT]),r=d.from([e.leafVersion]);return{key:d.concat([t,e.controlBlock]),value:d.concat([e.script,r])}},Io.expected="{ controlBlock: Buffer; leafVersion: number, script: Buffer; }",Io.check=function(e){return d.isBuffer(e.controlBlock)&&(e.controlBlock.length-1)%32==0&&(254&e.controlBlock[0])===e.leafVersion&&d.isBuffer(e.script)},Io.canAddToArray=function(e,t,r){const n=t.controlBlock.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter(e=>e.controlBlock.equals(t.controlBlock)).length)};var Ao={};Object.defineProperty(Ao,"__esModule",{value:!0});const Bo=oo;function ko(e){return d.isBuffer(e)&&32===e.length}Ao.decode=function(e){if(e.key[0]!==Bo.InputTypes.TAP_MERKLE_ROOT||1!==e.key.length)throw new Error("Decode Error: could not decode tapMerkleRoot with key 0x"+e.key.toString("hex"));if(!ko(e.value))throw new Error("Decode Error: tapMerkleRoot not a 32-byte hash");return e.value},Ao.encode=function(e){return{key:d.from([Bo.InputTypes.TAP_MERKLE_ROOT]),value:e}},Ao.expected="Buffer",Ao.check=ko,Ao.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapMerkleRoot};var Po={};Object.defineProperty(Po,"__esModule",{value:!0});const xo=oo;Po.decode=function(e){if(e.key[0]!==xo.InputTypes.TAP_SCRIPT_SIG)throw new Error("Decode Error: could not decode tapScriptSig with key 0x"+e.key.toString("hex"));if(65!==e.key.length)throw new Error("Decode Error: tapScriptSig has invalid key 0x"+e.key.toString("hex"));if(64!==e.value.length&&65!==e.value.length)throw new Error("Decode Error: tapScriptSig has invalid signature in key 0x"+e.key.toString("hex"));return{pubkey:e.key.slice(1,33),leafHash:e.key.slice(33),signature:e.value}},Po.encode=function(e){const t=d.from([xo.InputTypes.TAP_SCRIPT_SIG]);return{key:d.concat([t,e.pubkey,e.leafHash]),value:e.signature}},Po.expected="{ pubkey: Buffer; leafHash: Buffer; signature: Buffer; }",Po.check=function(e){return d.isBuffer(e.pubkey)&&d.isBuffer(e.leafHash)&&d.isBuffer(e.signature)&&32===e.pubkey.length&&32===e.leafHash.length&&(64===e.signature.length||65===e.signature.length)},Po.canAddToArray=function(e,t,r){const n=t.pubkey.toString("hex")+t.leafHash.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter(e=>e.pubkey.equals(t.pubkey)&&e.leafHash.equals(t.leafHash)).length)};var Ho={},Uo={},No={};function Ro(e){if(e<0||e>9007199254740991||e%1!=0)throw new RangeError("value out of range")}function Co(e){return Ro(e),e<253?1:e<=65535?3:e<=4294967295?5:9}Object.defineProperty(No,"__esModule",{value:!0}),No.encode=function e(t,r,n){if(Ro(t),r||(r=d.allocUnsafe(Co(t))),!d.isBuffer(r))throw new TypeError("buffer must be a Buffer instance");return n||(n=0),t<253?(r.writeUInt8(t,n),Object.assign(e,{bytes:1})):t<=65535?(r.writeUInt8(253,n),r.writeUInt16LE(t,n+1),Object.assign(e,{bytes:3})):t<=4294967295?(r.writeUInt8(254,n),r.writeUInt32LE(t,n+1),Object.assign(e,{bytes:5})):(r.writeUInt8(255,n),r.writeUInt32LE(t>>>0,n+1),r.writeUInt32LE(t/4294967296|0,n+5),Object.assign(e,{bytes:9})),r},No.decode=function e(t,r){if(!d.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");r||(r=0);const n=t.readUInt8(r);if(n<253)return Object.assign(e,{bytes:1}),n;if(253===n)return Object.assign(e,{bytes:3}),t.readUInt16LE(r+1);if(254===n)return Object.assign(e,{bytes:5}),t.readUInt32LE(r+1);{Object.assign(e,{bytes:9});const n=t.readUInt32LE(r+1),o=4294967296*t.readUInt32LE(r+5)+n;return Ro(o),o}},No.encodingLength=Co,Object.defineProperty(Uo,"__esModule",{value:!0});const Lo=No;function Fo(e){const t=e.key.length,r=e.value.length,n=Lo.encodingLength(t),o=Lo.encodingLength(r),i=d.allocUnsafe(n+t+o+r);return Lo.encode(t,i,0),e.key.copy(i,n),Lo.encode(r,i,n+t),e.value.copy(i,n+t+o),i}function Vo(e,t){if("number"!=typeof e)throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}Uo.range=e=>[...Array(e).keys()],Uo.reverseBuffer=function(e){if(e.length<1)return e;let t=e.length-1,r=0;for(let n=0;n<e.length/2;n++)r=e[n],e[n]=e[t],e[t]=r,t--;return e},Uo.keyValsToBuffer=function(e){const t=e.map(Fo);return t.push(d.from([0])),d.concat(t)},Uo.keyValToBuffer=Fo,Uo.readUInt64LE=function(e,t){const r=e.readUInt32LE(t);let n=e.readUInt32LE(t+4);return n*=4294967296,Vo(n+r,9007199254740991),n+r},Uo.writeUInt64LE=function(e,t,r){return Vo(t,9007199254740991),e.writeInt32LE(-1&t,r),e.writeUInt32LE(Math.floor(t/4294967296),r+4),r+8},Object.defineProperty(Ho,"__esModule",{value:!0});const Do=oo,Mo=Uo,Ko=No;Ho.decode=function(e){if(e.key[0]!==Do.InputTypes.WITNESS_UTXO)throw new Error("Decode Error: could not decode witnessUtxo with key 0x"+e.key.toString("hex"));const t=Mo.readUInt64LE(e.value,0);let r=8;const n=Ko.decode(e.value,r);r+=Ko.encodingLength(n);const o=e.value.slice(r);if(o.length!==n)throw new Error("Decode Error: WITNESS_UTXO script is not proper length");return{script:o,value:t}},Ho.encode=function(e){const{script:t,value:r}=e,n=Ko.encodingLength(t.length),o=d.allocUnsafe(8+n+t.length);return Mo.writeUInt64LE(o,r,0),Ko.encode(t.length,o,8),t.copy(o,8+n),{key:d.from([Do.InputTypes.WITNESS_UTXO]),value:o}},Ho.expected="{ script: Buffer; value: number; }",Ho.check=function(e){return d.isBuffer(e.script)&&"number"==typeof e.value},Ho.canAdd=function(e,t){return!!e&&!!t&&void 0===e.witnessUtxo};var jo={};Object.defineProperty(jo,"__esModule",{value:!0});const Go=oo,Wo=No;jo.decode=function(e){if(e.key[0]!==Go.OutputTypes.TAP_TREE||1!==e.key.length)throw new Error("Decode Error: could not decode tapTree with key 0x"+e.key.toString("hex"));let t=0;const r=[];for(;t<e.value.length;){const n=e.value[t++],o=e.value[t++],i=Wo.decode(e.value,t);t+=Wo.encodingLength(i),r.push({depth:n,leafVersion:o,script:e.value.slice(t,t+i)}),t+=i}return{leaves:r}},jo.encode=function(e){const t=d.from([Go.OutputTypes.TAP_TREE]),r=[].concat(...e.leaves.map(e=>[d.of(e.depth,e.leafVersion),Wo.encode(e.script.length),e.script]));return{key:t,value:d.concat(r)}},jo.expected="{ leaves: [{ depth: number; leafVersion: number, script: Buffer; }] }",jo.check=function(e){return Array.isArray(e.leaves)&&e.leaves.every(e=>e.depth>=0&&e.depth<=128&&(254&e.leafVersion)===e.leafVersion&&d.isBuffer(e.script))},jo.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapTree};var qo={};Object.defineProperty(qo,"__esModule",{value:!0});const Xo=e=>33===e.length&&[2,3].includes(e[0])||65===e.length&&4===e[0];qo.makeConverter=function(e,t=Xo){return{decode:function(r){if(r.key[0]!==e)throw new Error("Decode Error: could not decode bip32Derivation with key 0x"+r.key.toString("hex"));const n=r.key.slice(1);if(!t(n))throw new Error("Decode Error: bip32Derivation has invalid pubkey in key 0x"+r.key.toString("hex"));if(r.value.length/4%1!=0)throw new Error("Decode Error: Input BIP32_DERIVATION value length should be multiple of 4");const o={masterFingerprint:r.value.slice(0,4),pubkey:n,path:"m"};for(const e of(i=r.value.length/4-1,[...Array(i).keys()])){const t=r.value.readUInt32LE(4*e+4),n=!!(2147483648&t),i=2147483647&t;o.path+="/"+i.toString(10)+(n?"'":"")}var i;return o},encode:function(t){const r=d.from([e]),n=d.concat([r,t.pubkey]),o=t.path.split("/"),i=d.allocUnsafe(4*o.length);t.masterFingerprint.copy(i,0);let s=4;return o.slice(1).forEach(e=>{const t="'"===e.slice(-1);let r=2147483647&parseInt(t?e.slice(0,-1):e,10);t&&(r+=2147483648),i.writeUInt32LE(r,s),s+=4}),{key:n,value:i}},check:function(e){return d.isBuffer(e.pubkey)&&d.isBuffer(e.masterFingerprint)&&"string"==typeof e.path&&t(e.pubkey)&&4===e.masterFingerprint.length},expected:"{ masterFingerprint: Buffer; pubkey: Buffer; path: string; }",canAddToArray:function(e,t,r){const n=t.pubkey.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter(e=>e.pubkey.equals(t.pubkey)).length)}}};var $o={};Object.defineProperty($o,"__esModule",{value:!0}),$o.makeChecker=function(e){return function(t){let r;if(e.includes(t.key[0])&&(r=t.key.slice(1),33!==r.length&&65!==r.length||![2,3,4].includes(r[0])))throw new Error("Format Error: invalid pubkey in key 0x"+t.key.toString("hex"));return r}};var zo={};Object.defineProperty(zo,"__esModule",{value:!0}),zo.makeConverter=function(e){return{decode:function(t){if(t.key[0]!==e)throw new Error("Decode Error: could not decode redeemScript with key 0x"+t.key.toString("hex"));return t.value},encode:function(t){return{key:d.from([e]),value:t}},check:function(e){return d.isBuffer(e)},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.redeemScript}}};var Yo={};Object.defineProperty(Yo,"__esModule",{value:!0});const Zo=No,Jo=qo,Qo=e=>32===e.length;Yo.makeConverter=function(e){const t=Jo.makeConverter(e,Qo);return{decode:function(e){const r=Zo.decode(e.value),n=Zo.encodingLength(r),o=t.decode({key:e.key,value:e.value.slice(n+32*r)}),i=new Array(r);for(let t=0,s=n;t<r;t++,s+=32)i[t]=e.value.slice(s,s+32);return Object.assign({},o,{leafHashes:i})},encode:function(e){const r=t.encode(e),n=Zo.encodingLength(e.leafHashes.length),o=d.allocUnsafe(n);Zo.encode(e.leafHashes.length,o);const i=d.concat([o,...e.leafHashes,r.value]);return Object.assign({},r,{value:i})},check:function(e){return Array.isArray(e.leafHashes)&&e.leafHashes.every(e=>d.isBuffer(e)&&32===e.length)&&t.check(e)},expected:"{ masterFingerprint: Buffer; pubkey: Buffer; path: string; leafHashes: Buffer[]; }",canAddToArray:t.canAddToArray}};var ei={};Object.defineProperty(ei,"__esModule",{value:!0}),ei.makeConverter=function(e){return{decode:function(t){if(t.key[0]!==e||1!==t.key.length)throw new Error("Decode Error: could not decode tapInternalKey with key 0x"+t.key.toString("hex"));if(32!==t.value.length)throw new Error("Decode Error: tapInternalKey not a 32-byte x-only pubkey");return t.value},encode:function(t){return{key:d.from([e]),value:t}},check:function(e){return d.isBuffer(e)&&32===e.length},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.tapInternalKey}}};var ti={};Object.defineProperty(ti,"__esModule",{value:!0}),ti.makeConverter=function(e){return{decode:function(t){if(t.key[0]!==e)throw new Error("Decode Error: could not decode witnessScript with key 0x"+t.key.toString("hex"));return t.value},encode:function(t){return{key:d.from([e]),value:t}},check:function(e){return d.isBuffer(e)},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.witnessScript}}},Object.defineProperty(no,"__esModule",{value:!0});const ri=oo,ni=co,oi=ho,ii=lo,si=wo,ui=bo,ai=Eo,ci=vo,fi=Io,hi=Ao,pi=Po,li=Ho,di=jo,yi=qo,wi=$o,gi=zo,bi=Yo,mi=ei,Ei=ti,Si={unsignedTx:uo,globalXpub:io,checkPubkey:wi.makeChecker([])};no.globals=Si;const vi={nonWitnessUtxo:ii,partialSig:si,sighashType:ai,finalScriptSig:ni,finalScriptWitness:oi,porCommitment:ui,witnessUtxo:li,bip32Derivation:yi.makeConverter(ri.InputTypes.BIP32_DERIVATION),redeemScript:gi.makeConverter(ri.InputTypes.REDEEM_SCRIPT),witnessScript:Ei.makeConverter(ri.InputTypes.WITNESS_SCRIPT),checkPubkey:wi.makeChecker([ri.InputTypes.PARTIAL_SIG,ri.InputTypes.BIP32_DERIVATION]),tapKeySig:ci,tapScriptSig:pi,tapLeafScript:fi,tapBip32Derivation:bi.makeConverter(ri.InputTypes.TAP_BIP32_DERIVATION),tapInternalKey:mi.makeConverter(ri.InputTypes.TAP_INTERNAL_KEY),tapMerkleRoot:hi};no.inputs=vi;const Ti={bip32Derivation:yi.makeConverter(ri.OutputTypes.BIP32_DERIVATION),redeemScript:gi.makeConverter(ri.OutputTypes.REDEEM_SCRIPT),witnessScript:Ei.makeConverter(ri.OutputTypes.WITNESS_SCRIPT),checkPubkey:wi.makeChecker([ri.OutputTypes.BIP32_DERIVATION]),tapBip32Derivation:bi.makeConverter(ri.OutputTypes.TAP_BIP32_DERIVATION),tapTree:di,tapInternalKey:mi.makeConverter(ri.OutputTypes.TAP_INTERNAL_KEY)};no.outputs=Ti,Object.defineProperty(ro,"__esModule",{value:!0});const _i=no,Ii=Uo,Oi=No,Ai=oo;function Bi(e,t,r){if(!t.equals(d.from([r])))throw new Error(`Format Error: Invalid ${e} key: ${t.toString("hex")}`)}function ki(e,{globalMapKeyVals:t,inputKeyVals:r,outputKeyVals:n}){const o={unsignedTx:e};let i=0;for(const f of t)switch(f.key[0]){case Ai.GlobalTypes.UNSIGNED_TX:if(Bi("global",f.key,Ai.GlobalTypes.UNSIGNED_TX),i>0)throw new Error("Format Error: GlobalMap has multiple UNSIGNED_TX");i++;break;case Ai.GlobalTypes.GLOBAL_XPUB:void 0===o.globalXpub&&(o.globalXpub=[]),o.globalXpub.push(_i.globals.globalXpub.decode(f));break;default:o.unknownKeyVals||(o.unknownKeyVals=[]),o.unknownKeyVals.push(f)}const s=r.length,u=n.length,a=[],c=[];for(const f of Ii.range(s)){const e={};for(const t of r[f])switch(_i.inputs.checkPubkey(t),t.key[0]){case Ai.InputTypes.NON_WITNESS_UTXO:if(Bi("input",t.key,Ai.InputTypes.NON_WITNESS_UTXO),void 0!==e.nonWitnessUtxo)throw new Error("Format Error: Input has multiple NON_WITNESS_UTXO");e.nonWitnessUtxo=_i.inputs.nonWitnessUtxo.decode(t);break;case Ai.InputTypes.WITNESS_UTXO:if(Bi("input",t.key,Ai.InputTypes.WITNESS_UTXO),void 0!==e.witnessUtxo)throw new Error("Format Error: Input has multiple WITNESS_UTXO");e.witnessUtxo=_i.inputs.witnessUtxo.decode(t);break;case Ai.InputTypes.PARTIAL_SIG:void 0===e.partialSig&&(e.partialSig=[]),e.partialSig.push(_i.inputs.partialSig.decode(t));break;case Ai.InputTypes.SIGHASH_TYPE:if(Bi("input",t.key,Ai.InputTypes.SIGHASH_TYPE),void 0!==e.sighashType)throw new Error("Format Error: Input has multiple SIGHASH_TYPE");e.sighashType=_i.inputs.sighashType.decode(t);break;case Ai.InputTypes.REDEEM_SCRIPT:if(Bi("input",t.key,Ai.InputTypes.REDEEM_SCRIPT),void 0!==e.redeemScript)throw new Error("Format Error: Input has multiple REDEEM_SCRIPT");e.redeemScript=_i.inputs.redeemScript.decode(t);break;case Ai.InputTypes.WITNESS_SCRIPT:if(Bi("input",t.key,Ai.InputTypes.WITNESS_SCRIPT),void 0!==e.witnessScript)throw new Error("Format Error: Input has multiple WITNESS_SCRIPT");e.witnessScript=_i.inputs.witnessScript.decode(t);break;case Ai.InputTypes.BIP32_DERIVATION:void 0===e.bip32Derivation&&(e.bip32Derivation=[]),e.bip32Derivation.push(_i.inputs.bip32Derivation.decode(t));break;case Ai.InputTypes.FINAL_SCRIPTSIG:Bi("input",t.key,Ai.InputTypes.FINAL_SCRIPTSIG),e.finalScriptSig=_i.inputs.finalScriptSig.decode(t);break;case Ai.InputTypes.FINAL_SCRIPTWITNESS:Bi("input",t.key,Ai.InputTypes.FINAL_SCRIPTWITNESS),e.finalScriptWitness=_i.inputs.finalScriptWitness.decode(t);break;case Ai.InputTypes.POR_COMMITMENT:Bi("input",t.key,Ai.InputTypes.POR_COMMITMENT),e.porCommitment=_i.inputs.porCommitment.decode(t);break;case Ai.InputTypes.TAP_KEY_SIG:Bi("input",t.key,Ai.InputTypes.TAP_KEY_SIG),e.tapKeySig=_i.inputs.tapKeySig.decode(t);break;case Ai.InputTypes.TAP_SCRIPT_SIG:void 0===e.tapScriptSig&&(e.tapScriptSig=[]),e.tapScriptSig.push(_i.inputs.tapScriptSig.decode(t));break;case Ai.InputTypes.TAP_LEAF_SCRIPT:void 0===e.tapLeafScript&&(e.tapLeafScript=[]),e.tapLeafScript.push(_i.inputs.tapLeafScript.decode(t));break;case Ai.InputTypes.TAP_BIP32_DERIVATION:void 0===e.tapBip32Derivation&&(e.tapBip32Derivation=[]),e.tapBip32Derivation.push(_i.inputs.tapBip32Derivation.decode(t));break;case Ai.InputTypes.TAP_INTERNAL_KEY:Bi("input",t.key,Ai.InputTypes.TAP_INTERNAL_KEY),e.tapInternalKey=_i.inputs.tapInternalKey.decode(t);break;case Ai.InputTypes.TAP_MERKLE_ROOT:Bi("input",t.key,Ai.InputTypes.TAP_MERKLE_ROOT),e.tapMerkleRoot=_i.inputs.tapMerkleRoot.decode(t);break;default:e.unknownKeyVals||(e.unknownKeyVals=[]),e.unknownKeyVals.push(t)}a.push(e)}for(const f of Ii.range(u)){const e={};for(const t of n[f])switch(_i.outputs.checkPubkey(t),t.key[0]){case Ai.OutputTypes.REDEEM_SCRIPT:if(Bi("output",t.key,Ai.OutputTypes.REDEEM_SCRIPT),void 0!==e.redeemScript)throw new Error("Format Error: Output has multiple REDEEM_SCRIPT");e.redeemScript=_i.outputs.redeemScript.decode(t);break;case Ai.OutputTypes.WITNESS_SCRIPT:if(Bi("output",t.key,Ai.OutputTypes.WITNESS_SCRIPT),void 0!==e.witnessScript)throw new Error("Format Error: Output has multiple WITNESS_SCRIPT");e.witnessScript=_i.outputs.witnessScript.decode(t);break;case Ai.OutputTypes.BIP32_DERIVATION:void 0===e.bip32Derivation&&(e.bip32Derivation=[]),e.bip32Derivation.push(_i.outputs.bip32Derivation.decode(t));break;case Ai.OutputTypes.TAP_INTERNAL_KEY:Bi("output",t.key,Ai.OutputTypes.TAP_INTERNAL_KEY),e.tapInternalKey=_i.outputs.tapInternalKey.decode(t);break;case Ai.OutputTypes.TAP_TREE:Bi("output",t.key,Ai.OutputTypes.TAP_TREE),e.tapTree=_i.outputs.tapTree.decode(t);break;case Ai.OutputTypes.TAP_BIP32_DERIVATION:void 0===e.tapBip32Derivation&&(e.tapBip32Derivation=[]),e.tapBip32Derivation.push(_i.outputs.tapBip32Derivation.decode(t));break;default:e.unknownKeyVals||(e.unknownKeyVals=[]),e.unknownKeyVals.push(t)}c.push(e)}return{globalMap:o,inputs:a,outputs:c}}ro.psbtFromBuffer=function(e,t){let r=0;function n(){const t=Oi.decode(e,r);r+=Oi.encodingLength(t);const n=e.slice(r,r+t);return r+=t,n}function o(){return{key:n(),value:n()}}function i(){if(r>=e.length)throw new Error("Format Error: Unexpected End of PSBT");const t=0===e.readUInt8(r);return t&&r++,t}if(1886610036!==function(){const t=e.readUInt32BE(r);return r+=4,t}())throw new Error("Format Error: Invalid Magic Number");if(255!==function(){const t=e.readUInt8(r);return r+=1,t}())throw new Error("Format Error: Magic Number must be followed by 0xff separator");const s=[],u={};for(;!i();){const e=o(),t=e.key.toString("hex");if(u[t])throw new Error("Format Error: Keys must be unique for global keymap: key "+t);u[t]=1,s.push(e)}const a=s.filter(e=>e.key[0]===Ai.GlobalTypes.UNSIGNED_TX);if(1!==a.length)throw new Error("Format Error: Only one UNSIGNED_TX allowed");const c=t(a[0].value),{inputCount:f,outputCount:h}=c.getInputOutputCounts(),p=[],l=[];for(const d of Ii.range(f)){const e={},t=[];for(;!i();){const r=o(),n=r.key.toString("hex");if(e[n])throw new Error("Format Error: Keys must be unique for each input: input index "+d+" key "+n);e[n]=1,t.push(r)}p.push(t)}for(const d of Ii.range(h)){const e={},t=[];for(;!i();){const r=o(),n=r.key.toString("hex");if(e[n])throw new Error("Format Error: Keys must be unique for each output: output index "+d+" key "+n);e[n]=1,t.push(r)}l.push(t)}return ki(c,{globalMapKeyVals:s,inputKeyVals:p,outputKeyVals:l})},ro.checkKeyBuffer=Bi,ro.psbtFromKeyVals=ki;var Pi={};Object.defineProperty(Pi,"__esModule",{value:!0});const xi=no,Hi=Uo;Pi.psbtToBuffer=function({globalMap:e,inputs:t,outputs:r}){const{globalKeyVals:n,inputKeyVals:o,outputKeyVals:i}=Ri({globalMap:e,inputs:t,outputs:r}),s=Hi.keyValsToBuffer(n),u=e=>0===e.length?[d.from([0])]:e.map(Hi.keyValsToBuffer),a=u(o),c=u(i),f=d.allocUnsafe(5);return f.writeUIntBE(482972169471,0,5),d.concat([f,s].concat(a,c))};const Ui=(e,t)=>e.key.compare(t.key);function Ni(e,t){const r=new Set,n=Object.entries(e).reduce((e,[n,o])=>{if("unknownKeyVals"===n)return e;const i=t[n];if(void 0===i)return e;const s=(Array.isArray(o)?o:[o]).map(i.encode);return s.map(e=>e.key.toString("hex")).forEach(e=>{if(r.has(e))throw new Error("Serialize Error: Duplicate key: "+e);r.add(e)}),e.concat(s)},[]),o=e.unknownKeyVals?e.unknownKeyVals.filter(e=>!r.has(e.key.toString("hex"))):[];return n.concat(o).sort(Ui)}function Ri({globalMap:e,inputs:t,outputs:r}){return{globalKeyVals:Ni(e,xi.globals),inputKeyVals:t.map(e=>Ni(e,xi.inputs)),outputKeyVals:r.map(e=>Ni(e,xi.outputs))}}Pi.psbtToKeyVals=Ri,function(e){function t(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}Object.defineProperty(e,"__esModule",{value:!0}),t(ro),t(Pi)}(to),Object.defineProperty(eo,"__esModule",{value:!0});const Ci=to;function Li(e,t,r){return n=>{if(e.has(n))return;const o=r.filter(e=>e.key.toString("hex")===n)[0];t.push(o),e.add(n)}}function Fi(e){return e.globalMap.unsignedTx}function Vi(e){const t=new Set;return e.forEach(e=>{const r=e.key.toString("hex");if(t.has(r))throw new Error("Combine: KeyValue Map keys should be unique");t.add(r)}),t}eo.combine=function(e){const t=e[0],r=Ci.psbtToKeyVals(t),n=e.slice(1);if(0===n.length)throw new Error("Combine: Nothing to combine");const o=Fi(t);if(void 0===o)throw new Error("Combine: Self missing transaction");const i=Vi(r.globalKeyVals),s=r.inputKeyVals.map(Vi),u=r.outputKeyVals.map(Vi);for(const a of n){const e=Fi(a);if(void 0===e||!e.toBuffer().equals(o.toBuffer()))throw new Error("Combine: One of the Psbts does not have the same transaction.");const t=Ci.psbtToKeyVals(a);Vi(t.globalKeyVals).forEach(Li(i,r.globalKeyVals,t.globalKeyVals)),t.inputKeyVals.map(Vi).forEach((e,n)=>e.forEach(Li(s[n],r.inputKeyVals[n],t.inputKeyVals[n]))),t.outputKeyVals.map(Vi).forEach((e,n)=>e.forEach(Li(u[n],r.outputKeyVals[n],t.outputKeyVals[n])))}return Ci.psbtFromKeyVals(o,{globalMapKeyVals:r.globalKeyVals,inputKeyVals:r.inputKeyVals,outputKeyVals:r.outputKeyVals})};var Di={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=no;function r(e,t){const r=e[t];if(void 0===r)throw new Error(`No input #${t}`);return r}function n(e,t){const r=e[t];if(void 0===r)throw new Error(`No output #${t}`);return r}function o(e,t,r,n){throw new Error(`Data for ${e} key ${t} is incorrect: Expected ${r} and got ${JSON.stringify(n)}`)}function i(e){return(r,n)=>{for(const i of Object.keys(r)){const s=r[i],{canAdd:u,canAddToArray:a,check:c,expected:f}=t[e+"s"][i]||{};if(c)if(a){if(!Array.isArray(s)||n[i]&&!Array.isArray(n[i]))throw new Error(`Key type ${i} must be an array`);s.every(c)||o(e,i,f,s);const t=n[i]||[],r=new Set;if(!s.every(e=>a(t,e,r)))throw new Error("Can not add duplicate data to array");n[i]=t.concat(s)}else{if(c(s)||o(e,i,f,s),!u(n,s))throw new Error(`Can not add duplicate data to ${e}`);n[i]=s}}}}e.checkForInput=r,e.checkForOutput=n,e.checkHasKey=function(e,t,r){if(e.key[0]<r)throw new Error("Use the method for your specific key instead of addUnknownKeyVal*");if(t&&0!==t.filter(t=>t.key.equals(e.key)).length)throw new Error(`Duplicate Key: ${e.key.toString("hex")}`)},e.getEnumLength=function(e){let t=0;return Object.keys(e).forEach(e=>{Number(isNaN(Number(e)))&&t++}),t},e.inputCheckUncleanFinalized=function(e,t){let r=!1;if(t.nonWitnessUtxo||t.witnessUtxo){const e=!!t.redeemScript,n=!!t.witnessScript,o=!e||!!t.finalScriptSig,i=!n||!!t.finalScriptWitness,s=!!t.finalScriptSig||!!t.finalScriptWitness;r=o&&i&&s}if(!1===r)throw new Error(`Input #${e} has too much or too little data to clean`)},e.updateGlobal=i("global"),e.updateInput=i("input"),e.updateOutput=i("output"),e.addInputAttributes=function(t,n){const o=r(t,t.length-1);e.updateInput(n,o)},e.addOutputAttributes=function(t,r){const o=n(t,t.length-1);e.updateOutput(r,o)},e.defaultVersionSetter=function(e,t){if(!d.isBuffer(t)||t.length<4)throw new Error("Set Version: Invalid Transaction");return t.writeUInt32LE(e,0),t},e.defaultLocktimeSetter=function(e,t){if(!d.isBuffer(t)||t.length<4)throw new Error("Set Locktime: Invalid Transaction");return t.writeUInt32LE(e,t.length-4),t}}(Di),Object.defineProperty(Qn,"__esModule",{value:!0});const Mi=eo,Ki=to,ji=oo,Gi=Di;Qn.Psbt=class{constructor(e){this.inputs=[],this.outputs=[],this.globalMap={unsignedTx:e}}static fromBase64(e,t){const r=d.from(e,"base64");return this.fromBuffer(r,t)}static fromHex(e,t){const r=d.from(e,"hex");return this.fromBuffer(r,t)}static fromBuffer(e,t){const r=Ki.psbtFromBuffer(e,t),n=new this(r.globalMap.unsignedTx);return Object.assign(n,r),n}toBase64(){return this.toBuffer().toString("base64")}toHex(){return this.toBuffer().toString("hex")}toBuffer(){return Ki.psbtToBuffer(this)}updateGlobal(e){return Gi.updateGlobal(e,this.globalMap),this}updateInput(e,t){const r=Gi.checkForInput(this.inputs,e);return Gi.updateInput(t,r),this}updateOutput(e,t){const r=Gi.checkForOutput(this.outputs,e);return Gi.updateOutput(t,r),this}addUnknownKeyValToGlobal(e){return Gi.checkHasKey(e,this.globalMap.unknownKeyVals,Gi.getEnumLength(ji.GlobalTypes)),this.globalMap.unknownKeyVals||(this.globalMap.unknownKeyVals=[]),this.globalMap.unknownKeyVals.push(e),this}addUnknownKeyValToInput(e,t){const r=Gi.checkForInput(this.inputs,e);return Gi.checkHasKey(t,r.unknownKeyVals,Gi.getEnumLength(ji.InputTypes)),r.unknownKeyVals||(r.unknownKeyVals=[]),r.unknownKeyVals.push(t),this}addUnknownKeyValToOutput(e,t){const r=Gi.checkForOutput(this.outputs,e);return Gi.checkHasKey(t,r.unknownKeyVals,Gi.getEnumLength(ji.OutputTypes)),r.unknownKeyVals||(r.unknownKeyVals=[]),r.unknownKeyVals.push(t),this}addInput(e){this.globalMap.unsignedTx.addInput(e),this.inputs.push({unknownKeyVals:[]});const t=e.unknownKeyVals||[],r=this.inputs.length-1;if(!Array.isArray(t))throw new Error("unknownKeyVals must be an Array");return t.forEach(e=>this.addUnknownKeyValToInput(r,e)),Gi.addInputAttributes(this.inputs,e),this}addOutput(e){this.globalMap.unsignedTx.addOutput(e),this.outputs.push({unknownKeyVals:[]});const t=e.unknownKeyVals||[],r=this.outputs.length-1;if(!Array.isArray(t))throw new Error("unknownKeyVals must be an Array");return t.forEach(e=>this.addUnknownKeyValToOutput(r,e)),Gi.addOutputAttributes(this.outputs,e),this}clearFinalizedInput(e){const t=Gi.checkForInput(this.inputs,e);Gi.inputCheckUncleanFinalized(e,t);for(const r of Object.keys(t))["witnessUtxo","nonWitnessUtxo","finalScriptSig","finalScriptWitness","unknownKeyVals"].includes(r)||delete t[r];return this}combine(...e){const t=Mi.combine([this].concat(e));return Object.assign(this,t),this}getTransaction(){return this.globalMap.unsignedTx.toBuffer()}};var Wi={},qi={};Object.defineProperty(qi,"__esModule",{value:!0}),qi.signatureBlocksAction=qi.checkInputForSig=qi.pubkeyInScript=qi.pubkeyPositionInScript=qi.witnessStackToScriptWitness=qi.isP2TR=qi.isP2SHScript=qi.isP2WSHScript=qi.isP2WPKH=qi.isP2PKH=qi.isP2PK=qi.isP2MS=void 0;const Xi=No,$i=ue(),zi=Tn,Yi=Be,Zi=mn();function Ji(e){return t=>{try{return e({output:t}),!0}catch(r){return!1}}}function Qi(e,t){const r=(0,Yi.hash160)(e),n=e.slice(1,33),o=$i.decompile(t);if(null===o)throw new Error("Unknown script error");return o.findIndex(t=>"number"!=typeof t&&(t.equals(e)||t.equals(r)||t.equals(n)))}function es(e,t,r){const{hashType:n}=t(e),o=[];switch(n&zi.Transaction.SIGHASH_ANYONECANPAY&&o.push("addInput"),31&n){case zi.Transaction.SIGHASH_ALL:break;case zi.Transaction.SIGHASH_SINGLE:case zi.Transaction.SIGHASH_NONE:o.push("addOutput"),o.push("setInputSequence")}return-1===o.indexOf(r)}qi.isP2MS=Ji(Zi.p2ms),qi.isP2PK=Ji(Zi.p2pk),qi.isP2PKH=Ji(Zi.p2pkh),qi.isP2WPKH=Ji(Zi.p2wpkh),qi.isP2WSHScript=Ji(Zi.p2wsh),qi.isP2SHScript=Ji(Zi.p2sh),qi.isP2TR=Ji(Zi.p2tr),qi.witnessStackToScriptWitness=function(e){let t=d.allocUnsafe(0);function r(e){const r=t.length,n=Xi.encodingLength(e);t=d.concat([t,d.allocUnsafe(n)]),Xi.encode(e,t,r)}var n;return r((n=e).length),n.forEach(function(e){r(e.length),function(e){t=d.concat([t,d.from(e)])}(e)}),t},qi.pubkeyPositionInScript=Qi,qi.pubkeyInScript=function(e,t){return-1!==Qi(e,t)},qi.checkInputForSig=function(e,t){return function(e){let t=[];if(0===(e.partialSig||[]).length){if(!e.finalScriptSig&&!e.finalScriptWitness)return[];t=function(e){const t=e.finalScriptSig&&$i.decompile(e.finalScriptSig)||[],r=e.finalScriptWitness&&$i.decompile(e.finalScriptWitness)||[];return t.concat(r).filter(e=>d.isBuffer(e)&&$i.isCanonicalScriptSignature(e)).map(e=>({signature:e}))}(e)}else t=e.partialSig;return t.map(e=>e.signature)}(e).some(e=>es(e,$i.signature.decode,t))},qi.signatureBlocksAction=es,Object.defineProperty(Wi,"__esModule",{value:!0}),Wi.checkTaprootInputForSigs=Wi.tapTreeFromList=Wi.tapTreeToList=Wi.tweakInternalPubKey=Wi.checkTaprootOutputFields=Wi.checkTaprootInputFields=Wi.isTaprootOutput=Wi.isTaprootInput=Wi.serializeTaprootSignature=Wi.tapScriptFinalizer=Wi.toXOnly=void 0;const ts=x,rs=Tn,ns=qi,os=tn,is=mn(),ss=qi;function us(e){return e&&!!(e.tapInternalKey||e.tapMerkleRoot||e.tapLeafScript&&e.tapLeafScript.length||e.tapBip32Derivation&&e.tapBip32Derivation.length||e.witnessUtxo&&(0,ns.isP2TR)(e.witnessUtxo.script))}function as(e,t){return e&&!!(e.tapInternalKey||e.tapTree||e.tapBip32Derivation&&e.tapBip32Derivation.length||t&&(0,ns.isP2TR)(t))}function cs(e=[]){return 1===e.length&&0===e[0].depth?{output:e[0].script,version:e[0].leafVersion}:function(e){let t;for(const r of e)if(t=ps(r,t),!t)throw new Error("No room left to insert tapleaf in tree");return t}(e)}function fs(e){return{signature:e.slice(0,64),hashType:e.slice(64)[0]||rs.Transaction.SIGHASH_DEFAULT}}function hs(e,t=[],r=0){if(r>os.MAX_TAPTREE_DEPTH)throw new Error("Max taptree depth exceeded.");return e?(0,ts.isTapleaf)(e)?(t.push({depth:r,leafVersion:e.version||os.LEAF_VERSION_TAPSCRIPT,script:e.output}),t):(e[0]&&hs(e[0],t,r+1),e[1]&&hs(e[1],t,r+1),t):[]}function ps(e,t,r=0){if(r>os.MAX_TAPTREE_DEPTH)throw new Error("Max taptree depth exceeded.");if(e.depth===r)return t?void 0:{output:e.script,version:e.leafVersion};if((0,ts.isTapleaf)(t))return;const n=ps(e,t&&t[0],r+1);if(n)return[n,t&&t[1]];const o=ps(e,t&&t[1],r+1);return o?[t&&t[0],o]:void 0}function ls(e,t){if(!t)return!0;const r=(0,os.tapleafHash)({output:e.script,version:e.leafVersion});return(0,os.rootHashFromPath)(e.controlBlock,r).equals(t)}function ds(e){return e&&!!(e.redeemScript||e.witnessScript||e.bip32Derivation&&e.bip32Derivation.length)}Wi.toXOnly=e=>32===e.length?e:e.slice(1,33),Wi.tapScriptFinalizer=function(e,t,r){const n=function(e,t,r){if(!e.tapScriptSig||!e.tapScriptSig.length)throw new Error(`Can not finalize taproot input #${t}. No tapleaf script signature provided.`);const n=(e.tapLeafScript||[]).sort((e,t)=>e.controlBlock.length-t.controlBlock.length).find(t=>function(e,t,r){const n=(0,os.tapleafHash)({output:e.script,version:e.leafVersion});return(!r||r.equals(n))&&void 0!==t.find(e=>e.leafHash.equals(n))}(t,e.tapScriptSig,r));if(!n)throw new Error(`Can not finalize taproot input #${t}. Signature for tapleaf script not found.`);return n}(t,e,r);try{const e=function(e,t){const r=(0,os.tapleafHash)({output:t.script,version:t.leafVersion});return(e.tapScriptSig||[]).filter(e=>e.leafHash.equals(r)).map(e=>function(e,t){return Object.assign({positionInScript:(0,ns.pubkeyPositionInScript)(t.pubkey,e)},t)}(t.script,e)).sort((e,t)=>t.positionInScript-e.positionInScript).map(e=>e.signature)}(t,n),r=e.concat(n.script).concat(n.controlBlock);return{finalScriptWitness:(0,ns.witnessStackToScriptWitness)(r)}}catch(o){throw new Error(`Can not finalize taproot input #${e}: ${o}`)}},Wi.serializeTaprootSignature=function(e,t){const r=t?d.from([t]):d.from([]);return d.concat([e,r])},Wi.isTaprootInput=us,Wi.isTaprootOutput=as,Wi.checkTaprootInputFields=function(e,t,r){!function(e,t,r){const n=us(e)&&ds(t),o=ds(e)&&us(t),i=e===t&&us(t)&&ds(t);if(n||o||i)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}(e,t,r),function(e,t,r){if(t.tapMerkleRoot){const n=(t.tapLeafScript||[]).every(e=>ls(e,t.tapMerkleRoot)),o=(e.tapLeafScript||[]).every(e=>ls(e,t.tapMerkleRoot));if(!n||!o)throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}else if(e.tapMerkleRoot&&!(t.tapLeafScript||[]).every(t=>ls(t,e.tapMerkleRoot)))throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}(e,t,r)},Wi.checkTaprootOutputFields=function(e,t,r){!function(e,t,r){const n=as(e)&&ds(t),o=ds(e)&&as(t),i=e===t&&as(t)&&ds(t);if(n||o||i)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}(e,t,r),function(e,t){if(!t.tapTree&&!t.tapInternalKey)return;const r=t.tapInternalKey||e.tapInternalKey,n=t.tapTree||e.tapTree;if(r){const{script:t}=e,o=function(e,t){const r=t&&cs(t.leaves),{output:n}=(0,is.p2tr)({internalPubkey:e,scriptTree:r});return n}(r,n);if(t&&!t.equals(o))throw new Error("Error adding output. Script or address missmatch.")}}(e,t)},Wi.tweakInternalPubKey=function(e,t){const r=t.tapInternalKey,n=r&&(0,os.tweakKey)(r,t.tapMerkleRoot);if(!n)throw new Error(`Cannot tweak tap internal key for input #${e}. Public key: ${r&&r.toString("hex")}`);return n.x},Wi.tapTreeToList=function(e){if(!(0,ts.isTaptree)(e))throw new Error("Cannot convert taptree to tapleaf list. Expecting a tapree structure.");return hs(e)},Wi.tapTreeFromList=cs,Wi.checkTaprootInputForSigs=function(e,t){return function(e){const t=[];if(e.tapKeySig&&t.push(e.tapKeySig),e.tapScriptSig&&t.push(...e.tapScriptSig.map(e=>e.signature)),!t.length){const r=function(e){if(!e)return;const t=e.slice(2);return 64===t.length||65===t.length?t:void 0}(e.finalScriptWitness);r&&t.push(r)}return t}(e).some(e=>(0,ss.signatureBlocksAction)(e,fs,t))},Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.Psbt=void 0;const ys=Qn,ws=No,gs=Di,bs=En(),ms=rn,Es=b,Ss=mn(),vs=tn,Ts=ue(),_s=Tn,Is=Wi,Os=qi,As={network:Es.bitcoin,maximumFeeRate:5e3};class Bs{static fromBase64(e,t={}){const r=d.from(e,"base64");return this.fromBuffer(r,t)}static fromHex(e,t={}){const r=d.from(e,"hex");return this.fromBuffer(r,t)}static fromBuffer(e,t={}){const r=ys.Psbt.fromBuffer(e,ks),n=new Bs(t,r);var o,i;return o=n.__CACHE.__TX,i=n.__CACHE,o.ins.forEach(e=>{Fs(i,e)}),n}constructor(e={},t=new ys.Psbt(new Ps)){this.data=t,this.opts=Object.assign({},As,e),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},0===this.data.inputs.length&&this.setVersion(2);const r=(e,t,r,n)=>Object.defineProperty(e,t,{enumerable:r,writable:n});r(this,"__CACHE",!1,!0),r(this,"opts",!1,!0)}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(e){this.setVersion(e)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(e){this.setLocktime(e)}get txInputs(){return this.__CACHE.__TX.ins.map(e=>({hash:(0,ms.cloneBuffer)(e.hash),index:e.index,sequence:e.sequence}))}get txOutputs(){return this.__CACHE.__TX.outs.map(e=>{let t;try{t=(0,bs.fromOutputScript)(e.script,this.opts.network)}catch(r){}return{script:(0,ms.cloneBuffer)(e.script),value:e.value,address:t}})}combine(...e){return this.data.combine(...e.map(e=>e.data)),this}clone(){const e=Bs.fromBuffer(this.data.toBuffer());return e.opts=JSON.parse(JSON.stringify(this.opts)),e}setMaximumFeeRate(e){Rs(e),this.opts.maximumFeeRate=e}setVersion(e){Rs(e),Cs(this.data.inputs,"setVersion");const t=this.__CACHE;return t.__TX.version=e,t.__EXTRACTED_TX=void 0,this}setLocktime(e){Rs(e),Cs(this.data.inputs,"setLocktime");const t=this.__CACHE;return t.__TX.locktime=e,t.__EXTRACTED_TX=void 0,this}setInputSequence(e,t){Rs(t),Cs(this.data.inputs,"setInputSequence");const r=this.__CACHE;if(r.__TX.ins.length<=e)throw new Error("Input index too high");return r.__TX.ins[e].sequence=t,r.__EXTRACTED_TX=void 0,this}addInputs(e){return e.forEach(e=>this.addInput(e)),this}addInput(e){if(arguments.length>1||!e||void 0===e.hash||void 0===e.index)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");(0,Is.checkTaprootInputFields)(e,e,"addInput"),Cs(this.data.inputs,"addInput"),e.witnessScript&&iu(e.witnessScript);const t=this.__CACHE;this.data.addInput(e),Fs(t,t.__TX.ins[t.__TX.ins.length-1]);const r=this.data.inputs.length-1,n=this.data.inputs[r];return n.nonWitnessUtxo&&Js(this.__CACHE,n,r),t.__FEE=void 0,t.__FEE_RATE=void 0,t.__EXTRACTED_TX=void 0,this}addOutputs(e){return e.forEach(e=>this.addOutput(e)),this}addOutput(e){if(arguments.length>1||!e||void 0===e.value||void 0===e.address&&void 0===e.script)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");Cs(this.data.inputs,"addOutput");const{address:t}=e;if("string"==typeof t){const{network:r}=this.opts,n=(0,bs.toOutputScript)(t,r);e=Object.assign({},e,{script:n})}(0,Is.checkTaprootOutputFields)(e,e,"addOutput");const r=this.__CACHE;return this.data.addOutput(e),r.__FEE=void 0,r.__FEE_RATE=void 0,r.__EXTRACTED_TX=void 0,this}extractTransaction(e){if(!this.data.inputs.every(Us))throw new Error("Not finalized");const t=this.__CACHE;if(e||function(e,t,r){const n=t.__FEE_RATE||e.getFeeRate(),o=t.__EXTRACTED_TX.virtualSize(),i=n*o;if(n>=r.maximumFeeRate)throw new Error(`Warning: You are paying around ${(i/1e8).toFixed(8)} in fees, which is ${n} satoshi per byte for a transaction with a VSize of ${o} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}(this,t,this.opts),t.__EXTRACTED_TX)return t.__EXTRACTED_TX;const r=t.__TX.clone();return Qs(this.data.inputs,r,t,!0),r}getFeeRate(){return Ks("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return Ks("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return(0,gs.checkForInput)(this.data.inputs,0),uu(this.data.inputs.length).forEach(e=>this.finalizeInput(e)),this}finalizeInput(e,t){const r=(0,gs.checkForInput)(this.data.inputs,e);return(0,Is.isTaprootInput)(r)?this._finalizeTaprootInput(e,r,void 0,t):this._finalizeInput(e,r,t)}finalizeTaprootInput(e,t,r=Is.tapScriptFinalizer){const n=(0,gs.checkForInput)(this.data.inputs,e);if((0,Is.isTaprootInput)(n))return this._finalizeTaprootInput(e,n,t,r);throw new Error(`Cannot finalize input #${e}. Not Taproot.`)}_finalizeInput(e,t,r=js){const{script:n,isP2SH:o,isP2WSH:i,isSegwit:s}=function(e,t,r){const n=r.__TX,o={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(o.isP2SH=!!t.redeemScript,o.isP2WSH=!!t.witnessScript,t.witnessScript)o.script=t.witnessScript;else if(t.redeemScript)o.script=t.redeemScript;else if(t.nonWitnessUtxo){const i=eu(r,t,e),s=n.ins[e].index;o.script=i.outs[s].script}else t.witnessUtxo&&(o.script=t.witnessUtxo.script);return(t.witnessScript||(0,Os.isP2WPKH)(o.script))&&(o.isSegwit=!0),o}(e,t,this.__CACHE);if(!n)throw new Error(`No script found for input #${e}`);!function(e){if(!e.sighashType||!e.partialSig)return;const{partialSig:t,sighashType:r}=e;t.forEach(e=>{const{hashType:t}=Ts.signature.decode(e.signature);if(r!==t)throw new Error("Signature sighash does not match input sighash type")})}(t);const{finalScriptSig:u,finalScriptWitness:a}=r(e,t,n,s,o,i);if(u&&this.data.updateInput(e,{finalScriptSig:u}),a&&this.data.updateInput(e,{finalScriptWitness:a}),!u&&!a)throw new Error(`Unknown error finalizing input #${e}`);return this.data.clearFinalizedInput(e),this}_finalizeTaprootInput(e,t,r,n=Is.tapScriptFinalizer){if(!t.witnessUtxo)throw new Error(`Cannot finalize input #${e}. Missing withness utxo.`);if(t.tapKeySig){const r=Ss.p2tr({output:t.witnessUtxo.script,signature:t.tapKeySig}),n=(0,Os.witnessStackToScriptWitness)(r.witness);this.data.updateInput(e,{finalScriptWitness:n})}else{const{finalScriptWitness:o}=n(e,t,r);this.data.updateInput(e,{finalScriptWitness:o})}return this.data.clearFinalizedInput(e),this}getInputType(e){const t=(0,gs.checkForInput)(this.data.inputs,e),r=ou(tu(e,t,this.__CACHE),e,"input",t.redeemScript||function(e){if(!e)return;const t=Ts.decompile(e);if(!t)return;const r=t[t.length-1];var n;if(d.isBuffer(r)&&!nu(r)&&(n=r,!Ts.isCanonicalScriptSignature(n))&&Ts.decompile(r))return r}(t.finalScriptSig),t.witnessScript||function(e){if(!e)return;const t=Zs(e),r=t[t.length-1];return!nu(r)&&Ts.decompile(r)?r:void 0}(t.finalScriptWitness));return("raw"===r.type?"":r.type+"-")+su(r.meaningfulScript)}inputHasPubkey(e,t){return function(e,t,r,n){const o=tu(r,t,n),{meaningfulScript:i}=ou(o,r,"input",t.redeemScript,t.witnessScript);return(0,Os.pubkeyInScript)(e,i)}(t,(0,gs.checkForInput)(this.data.inputs,e),e,this.__CACHE)}inputHasHDKey(e,t){const r=(0,gs.checkForInput)(this.data.inputs,e),n=Ns(t);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}outputHasPubkey(e,t){return function(e,t,r,n){const o=n.__TX.outs[r].script,{meaningfulScript:i}=ou(o,r,"output",t.redeemScript,t.witnessScript);return(0,Os.pubkeyInScript)(e,i)}(t,(0,gs.checkForOutput)(this.data.outputs,e),e,this.__CACHE)}outputHasHDKey(e,t){const r=(0,gs.checkForOutput)(this.data.outputs,e),n=Ns(t);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}validateSignaturesOfAllInputs(e){return(0,gs.checkForInput)(this.data.inputs,0),uu(this.data.inputs.length).map(t=>this.validateSignaturesOfInput(t,e)).reduce((e,t)=>!0===t&&e,!0)}validateSignaturesOfInput(e,t,r){const n=this.data.inputs[e];return(0,Is.isTaprootInput)(n)?this.validateSignaturesOfTaprootInput(e,t,r):this._validateSignaturesOfInput(e,t,r)}_validateSignaturesOfInput(e,t,r){const n=this.data.inputs[e],o=(n||{}).partialSig;if(!n||!o||o.length<1)throw new Error("No signatures to validate");if("function"!=typeof t)throw new Error("Need validator function to validate signatures");const i=r?o.filter(e=>e.pubkey.equals(r)):o;if(i.length<1)throw new Error("No signatures for this pubkey");const s=[];let u,a,c;for(const f of i){const r=Ts.signature.decode(f.signature),{hash:o,script:i}=c!==r.hashType?Ws(e,Object.assign({},n,{sighashType:r.hashType}),this.__CACHE,!0):{hash:u,script:a};c=r.hashType,u=o,a=i,Ls(f.pubkey,i,"verify"),s.push(t(f.pubkey,o,r.signature))}return s.every(e=>!0===e)}validateSignaturesOfTaprootInput(e,t,r){const n=this.data.inputs[e],o=(n||{}).tapKeySig,i=(n||{}).tapScriptSig;if(!n&&!o&&(!i||i.length))throw new Error("No signatures to validate");if("function"!=typeof t)throw new Error("Need validator function to validate signatures");const s=(r=r&&(0,Is.toXOnly)(r))?$s(e,n,this.data.inputs,r,this.__CACHE):function(e,t,r,n){const o=[];if(t.tapInternalKey){const r=qs(e,t,n);r&&o.push(r)}if(t.tapScriptSig){const e=t.tapScriptSig.map(e=>e.pubkey);o.push(...e)}return o.map(o=>$s(e,t,r,o,n)).flat()}(e,n,this.data.inputs,this.__CACHE);if(!s.length)throw new Error("No signatures for this pubkey");const u=s.find(e=>!e.leafHash);let a=0;if(o&&u){if(!t(u.pubkey,u.hash,Xs(o)))return!1;a++}if(i)for(const c of i){const e=s.find(e=>c.pubkey.equals(e.pubkey));if(e){if(!t(c.pubkey,e.hash,Xs(c.signature)))return!1;a++}}return a>0}signAllInputsHD(e,t=[_s.Transaction.SIGHASH_ALL]){if(!e||!e.publicKey||!e.fingerprint)throw new Error("Need HDSigner to sign input");const r=[];for(const o of uu(this.data.inputs.length))try{this.signInputHD(o,e,t),r.push(!0)}catch(n){r.push(!1)}if(r.every(e=>!1===e))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(e,t=[_s.Transaction.SIGHASH_ALL]){return new Promise((r,n)=>{if(!e||!e.publicKey||!e.fingerprint)return n(new Error("Need HDSigner to sign input"));const o=[],i=[];for(const s of uu(this.data.inputs.length))i.push(this.signInputHDAsync(s,e,t).then(()=>{o.push(!0)},()=>{o.push(!1)}));return Promise.all(i).then(()=>{if(o.every(e=>!1===e))return n(new Error("No inputs were signed"));r()})})}signInputHD(e,t,r=[_s.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey||!t.fingerprint)throw new Error("Need HDSigner to sign input");return Ys(e,this.data.inputs,t).forEach(t=>this.signInput(e,t,r)),this}signInputHDAsync(e,t,r=[_s.Transaction.SIGHASH_ALL]){return new Promise((n,o)=>{if(!t||!t.publicKey||!t.fingerprint)return o(new Error("Need HDSigner to sign input"));const i=Ys(e,this.data.inputs,t).map(t=>this.signInputAsync(e,t,r));return Promise.all(i).then(()=>{n()}).catch(o)})}signAllInputs(e,t){if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const r=[];for(const o of uu(this.data.inputs.length))try{this.signInput(o,e,t),r.push(!0)}catch(n){r.push(!1)}if(r.every(e=>!1===e))throw new Error("No inputs were signed");return this}signAllInputsAsync(e,t){return new Promise((r,n)=>{if(!e||!e.publicKey)return n(new Error("Need Signer to sign input"));const o=[],i=[];for(const[s]of this.data.inputs.entries())i.push(this.signInputAsync(s,e,t).then(()=>{o.push(!0)},()=>{o.push(!1)}));return Promise.all(i).then(()=>{if(o.every(e=>!1===e))return n(new Error("No inputs were signed"));r()})})}signInput(e,t,r){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const n=(0,gs.checkForInput)(this.data.inputs,e);return(0,Is.isTaprootInput)(n)?this._signTaprootInput(e,n,t,void 0,r):this._signInput(e,t,r)}signTaprootInput(e,t,r,n){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const o=(0,gs.checkForInput)(this.data.inputs,e);if((0,Is.isTaprootInput)(o))return this._signTaprootInput(e,o,t,r,n);throw new Error(`Input #${e} is not of type Taproot.`)}_signInput(e,t,r=[_s.Transaction.SIGHASH_ALL]){const{hash:n,sighashType:o}=Gs(this.data.inputs,e,t.publicKey,this.__CACHE,r),i=[{pubkey:t.publicKey,signature:Ts.signature.encode(t.sign(n),o)}];return this.data.updateInput(e,{partialSig:i}),this}_signTaprootInput(e,t,r,n,o=[_s.Transaction.SIGHASH_DEFAULT]){const i=this.checkTaprootHashesForSig(e,t,r,n,o),s=i.filter(e=>!e.leafHash).map(e=>(0,Is.serializeTaprootSignature)(r.signSchnorr(e.hash),t.sighashType))[0],u=i.filter(e=>!!e.leafHash).map(e=>({pubkey:(0,Is.toXOnly)(r.publicKey),signature:(0,Is.serializeTaprootSignature)(r.signSchnorr(e.hash),t.sighashType),leafHash:e.leafHash}));return s&&this.data.updateInput(e,{tapKeySig:s}),u.length&&this.data.updateInput(e,{tapScriptSig:u}),this}signInputAsync(e,t,r){return Promise.resolve().then(()=>{if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const n=(0,gs.checkForInput)(this.data.inputs,e);return(0,Is.isTaprootInput)(n)?this._signTaprootInputAsync(e,n,t,void 0,r):this._signInputAsync(e,t,r)})}signTaprootInputAsync(e,t,r,n){return Promise.resolve().then(()=>{if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const o=(0,gs.checkForInput)(this.data.inputs,e);if((0,Is.isTaprootInput)(o))return this._signTaprootInputAsync(e,o,t,r,n);throw new Error(`Input #${e} is not of type Taproot.`)})}_signInputAsync(e,t,r=[_s.Transaction.SIGHASH_ALL]){const{hash:n,sighashType:o}=Gs(this.data.inputs,e,t.publicKey,this.__CACHE,r);return Promise.resolve(t.sign(n)).then(r=>{const n=[{pubkey:t.publicKey,signature:Ts.signature.encode(r,o)}];this.data.updateInput(e,{partialSig:n})})}async _signTaprootInputAsync(e,t,r,n,o=[_s.Transaction.SIGHASH_DEFAULT]){const i=this.checkTaprootHashesForSig(e,t,r,n,o),s=[],u=i.filter(e=>!e.leafHash)[0];if(u){const e=Promise.resolve(r.signSchnorr(u.hash)).then(e=>({tapKeySig:(0,Is.serializeTaprootSignature)(e,t.sighashType)}));s.push(e)}const a=i.filter(e=>!!e.leafHash);if(a.length){const e=a.map(e=>Promise.resolve(r.signSchnorr(e.hash)).then(n=>({tapScriptSig:[{pubkey:(0,Is.toXOnly)(r.publicKey),signature:(0,Is.serializeTaprootSignature)(n,t.sighashType),leafHash:e.leafHash}]})));s.push(...e)}return Promise.all(s).then(t=>{t.forEach(t=>this.data.updateInput(e,t))})}checkTaprootHashesForSig(e,t,r,n,o){if("function"!=typeof r.signSchnorr)throw new Error(`Need Schnorr Signer to sign taproot input #${e}.`);const i=$s(e,t,this.data.inputs,r.publicKey,this.__CACHE,n,o);if(!i||!i.length)throw new Error(`Can not sign for input #${e} with the key ${r.publicKey.toString("hex")}`);return i}toBuffer(){return xs(this.__CACHE),this.data.toBuffer()}toHex(){return xs(this.__CACHE),this.data.toHex()}toBase64(){return xs(this.__CACHE),this.data.toBase64()}updateGlobal(e){return this.data.updateGlobal(e),this}updateInput(e,t){return t.witnessScript&&iu(t.witnessScript),(0,Is.checkTaprootInputFields)(this.data.inputs[e],t,"updateInput"),this.data.updateInput(e,t),t.nonWitnessUtxo&&Js(this.__CACHE,this.data.inputs[e],e),this}updateOutput(e,t){const r=this.data.outputs[e];return(0,Is.checkTaprootOutputFields)(r,t,"updateOutput"),this.data.updateOutput(e,t),this}addUnknownKeyValToGlobal(e){return this.data.addUnknownKeyValToGlobal(e),this}addUnknownKeyValToInput(e,t){return this.data.addUnknownKeyValToInput(e,t),this}addUnknownKeyValToOutput(e,t){return this.data.addUnknownKeyValToOutput(e,t),this}clearFinalizedInput(e){return this.data.clearFinalizedInput(e),this}}Jn.Psbt=Bs;const ks=e=>new Ps(e);class Ps{constructor(e=d.from([2,0,0,0,0,0,0,0,0,0])){this.tx=_s.Transaction.fromBuffer(e),function(e){if(!e.ins.every(e=>e.script&&0===e.script.length&&e.witness&&0===e.witness.length))throw new Error("Format Error: Transaction ScriptSigs are not empty")}(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(e){if(void 0===e.hash||void 0===e.index||!d.isBuffer(e.hash)&&"string"!=typeof e.hash||"number"!=typeof e.index)throw new Error("Error adding input.");const t="string"==typeof e.hash?(0,ms.reverseBuffer)(d.from(e.hash,"hex")):e.hash;this.tx.addInput(t,e.index,e.sequence)}addOutput(e){if(void 0===e.script||void 0===e.value||!d.isBuffer(e.script)||"number"!=typeof e.value)throw new Error("Error adding output.");this.tx.addOutput(e.script,e.value)}toBuffer(){return this.tx.toBuffer()}}function xs(e){if(!1!==e.__UNSAFE_SIGN_NONSEGWIT)throw new Error("Not BIP174 compliant, can not export")}function Hs(e,t,r){if(!t)return!1;let n;if(n=r?r.map(e=>{const r=function(e){if(65===e.length){const t=1&e[64],r=e.slice(0,33);return r[0]=2|t,r}return e.slice()}(e);return t.find(e=>e.pubkey.equals(r))}).filter(e=>!!e):t,n.length>e)throw new Error("Too many signatures");return n.length===e}function Us(e){return!!e.finalScriptSig||!!e.finalScriptWitness}function Ns(e){return t=>!!t.masterFingerprint.equals(e.fingerprint)&&!!e.derivePath(t.path).publicKey.equals(t.pubkey)}function Rs(e){if("number"!=typeof e||e!==Math.floor(e)||e>4294967295||e<0)throw new Error("Invalid 32 bit integer")}function Cs(e,t){e.forEach(e=>{if((0,Is.isTaprootInput)(e)?(0,Is.checkTaprootInputForSigs)(e,t):(0,Os.checkInputForSig)(e,t))throw new Error("Can not modify transaction, signatures exist.")})}function Ls(e,t,r){if(!(0,Os.pubkeyInScript)(e,t))throw new Error(`Can not ${r} for this input with the key ${e.toString("hex")}`)}function Fs(e,t){const r=(0,ms.reverseBuffer)(d.from(t.hash)).toString("hex")+":"+t.index;if(e.__TX_IN_CACHE[r])throw new Error("Duplicate input detected.");e.__TX_IN_CACHE[r]=1}function Vs(e,t){return(r,n,o,i)=>{const s=e({redeem:{output:o}}).output;if(!n.equals(s))throw new Error(`${t} for ${i} #${r} doesn't match the scriptPubKey in the prevout`)}}const Ds=Vs(Ss.p2sh,"Redeem script"),Ms=Vs(Ss.p2wsh,"Witness script");function Ks(e,t,r,n){if(!r.every(Us))throw new Error(`PSBT must be finalized to calculate ${t}`);if("__FEE_RATE"===e&&n.__FEE_RATE)return n.__FEE_RATE;if("__FEE"===e&&n.__FEE)return n.__FEE;let o,i=!0;return n.__EXTRACTED_TX?(o=n.__EXTRACTED_TX,i=!1):o=n.__TX.clone(),Qs(r,o,n,i),"__FEE_RATE"===e?n.__FEE_RATE:"__FEE"===e?n.__FEE:void 0}function js(e,t,r,n,o,i){const s=su(r);if(!function(e,t,r){switch(r){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return Hs(1,e.partialSig);case"multisig":const r=Ss.p2ms({output:t});return Hs(r.m,e.partialSig,r.pubkeys);default:return!1}}(t,r,s))throw new Error(`Can not finalize input #${e}`);return function(e,t,r,n,o,i){let s,u;const a=function(e,t,r){let n;switch(t){case"multisig":const t=function(e,t){return Ss.p2ms({output:e}).pubkeys.map(e=>(t.filter(t=>t.pubkey.equals(e))[0]||{}).signature).filter(e=>!!e)}(e,r);n=Ss.p2ms({output:e,signatures:t});break;case"pubkey":n=Ss.p2pk({output:e,signature:r[0].signature});break;case"pubkeyhash":n=Ss.p2pkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature});break;case"witnesspubkeyhash":n=Ss.p2wpkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature})}return n}(e,t,r),c=i?Ss.p2wsh({redeem:a}):null,f=o?Ss.p2sh({redeem:c||a}):null;return n?(u=c?(0,Os.witnessStackToScriptWitness)(c.witness):(0,Os.witnessStackToScriptWitness)(a.witness),f&&(s=f.input)):s=f?f.input:a.input,{finalScriptSig:s,finalScriptWitness:u}}(r,s,t.partialSig,n,o,i)}function Gs(e,t,r,n,o){const i=(0,gs.checkForInput)(e,t),{hash:s,sighashType:u,script:a}=Ws(t,i,n,!1,o);return Ls(r,a,"sign"),{hash:s,sighashType:u}}function Ws(e,t,r,n,o){const i=r.__TX,s=t.sighashType||_s.Transaction.SIGHASH_ALL;let u,a;if(zs(s,o),t.nonWitnessUtxo){const n=eu(r,t,e),o=i.ins[e].hash,s=n.getHash();if(!o.equals(s))throw new Error(`Non-witness UTXO hash for input #${e} doesn't match the hash specified in the prevout`);const u=i.ins[e].index;a=n.outs[u]}else{if(!t.witnessUtxo)throw new Error("Need a Utxo input item for signing");a=t.witnessUtxo}const{meaningfulScript:c,type:f}=ou(a.script,e,"input",t.redeemScript,t.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(f)>=0)u=i.hashForWitnessV0(e,c,a.value,s);else if((0,Os.isP2WPKH)(c)){const t=Ss.p2pkh({hash:c.slice(2)}).output;u=i.hashForWitnessV0(e,t,a.value,s)}else{if(void 0===t.nonWitnessUtxo&&!1===r.__UNSAFE_SIGN_NONSEGWIT)throw new Error(`Input #${e} has witnessUtxo but non-segwit script: ${c.toString("hex")}`);!n&&r.__UNSAFE_SIGN_NONSEGWIT,u=i.hashForSignature(e,c,s)}return{script:c,sighashType:s,hash:u}}function qs(e,t,r){const{script:n}=ru(e,t,r);return(0,Os.isP2TR)(n)?n.subarray(2,34):null}function Xs(e){return 64===e.length?e:e.subarray(0,64)}function $s(e,t,r,n,o,i,s){const u=o.__TX,a=t.sighashType||_s.Transaction.SIGHASH_DEFAULT;zs(a,s);const c=r.map((e,t)=>ru(t,e,o)),f=c.map(e=>e.script),h=c.map(e=>e.value),p=[];if(t.tapInternalKey&&!i){const r=qs(e,t,o)||d.from([]);if((0,Is.toXOnly)(n).equals(r)){const t=u.hashForWitnessV1(e,f,h,a);p.push({pubkey:n,hash:t})}}const l=(t.tapLeafScript||[]).filter(e=>(0,Os.pubkeyInScript)(n,e.script)).map(e=>{const t=(0,vs.tapleafHash)({output:e.script,version:e.leafVersion});return Object.assign({hash:t},e)}).filter(e=>!i||i.equals(e.hash)).map(t=>{const r=u.hashForWitnessV1(e,f,h,a,t.hash);return{pubkey:n,hash:r,leafHash:t.hash}});return p.concat(l)}function zs(e,t){if(t&&t.indexOf(e)<0){const t=function(e){let t=e&_s.Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(31&e){case _s.Transaction.SIGHASH_ALL:t+="SIGHASH_ALL";break;case _s.Transaction.SIGHASH_SINGLE:t+="SIGHASH_SINGLE";break;case _s.Transaction.SIGHASH_NONE:t+="SIGHASH_NONE"}return t}(e);throw new Error(`Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: ${t}`)}}function Ys(e,t,r){const n=(0,gs.checkForInput)(t,e);if(!n.bip32Derivation||0===n.bip32Derivation.length)throw new Error("Need bip32Derivation to sign with HD");const o=n.bip32Derivation.map(e=>e.masterFingerprint.equals(r.fingerprint)?e:void 0).filter(e=>!!e);if(0===o.length)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return o.map(e=>{const t=r.derivePath(e.path);if(!e.pubkey.equals(t.publicKey))throw new Error("pubkey did not match bip32Derivation");return t})}function Zs(e){let t=0;function r(){const r=ws.decode(e,t);return t+=ws.decode.bytes,r}function n(){return n=r(),t+=n,e.slice(t-n,t);var n}return function(){const e=r(),t=[];for(let r=0;r<e;r++)t.push(n());return t}()}function Js(e,t,r){e.__NON_WITNESS_UTXO_BUF_CACHE[r]=t.nonWitnessUtxo;const n=_s.Transaction.fromBuffer(t.nonWitnessUtxo);e.__NON_WITNESS_UTXO_TX_CACHE[r]=n;const o=e,i=r;delete t.nonWitnessUtxo,Object.defineProperty(t,"nonWitnessUtxo",{enumerable:!0,get(){const e=o.__NON_WITNESS_UTXO_BUF_CACHE[i],t=o.__NON_WITNESS_UTXO_TX_CACHE[i];if(void 0!==e)return e;{const e=t.toBuffer();return o.__NON_WITNESS_UTXO_BUF_CACHE[i]=e,e}},set(e){o.__NON_WITNESS_UTXO_BUF_CACHE[i]=e}})}function Qs(e,t,r,n){let o=0;e.forEach((e,i)=>{if(n&&e.finalScriptSig&&(t.ins[i].script=e.finalScriptSig),n&&e.finalScriptWitness&&(t.ins[i].witness=Zs(e.finalScriptWitness)),e.witnessUtxo)o+=e.witnessUtxo.value;else if(e.nonWitnessUtxo){const n=eu(r,e,i),s=t.ins[i].index,u=n.outs[s];o+=u.value}});const i=t.outs.reduce((e,t)=>e+t.value,0),s=o-i;if(s<0)throw new Error("Outputs are spending more than Inputs");const u=t.virtualSize();r.__FEE=s,r.__EXTRACTED_TX=t,r.__FEE_RATE=Math.floor(s/u)}function eu(e,t,r){const n=e.__NON_WITNESS_UTXO_TX_CACHE;return n[r]||Js(e,t,r),n[r]}function tu(e,t,r){const{script:n}=ru(e,t,r);return n}function ru(e,t,r){if(void 0!==t.witnessUtxo)return{script:t.witnessUtxo.script,value:t.witnessUtxo.value};if(void 0!==t.nonWitnessUtxo){const n=eu(r,t,e).outs[r.__TX.ins[e].index];return{script:n.script,value:n.value}}throw new Error("Can't find pubkey in input without Utxo data")}function nu(e){return 33===e.length&&Ts.isCanonicalPubKey(e)}function ou(e,t,r,n,o){const i=(0,Os.isP2SHScript)(e),s=i&&n&&(0,Os.isP2WSHScript)(n),u=(0,Os.isP2WSHScript)(e);if(i&&void 0===n)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((u||s)&&void 0===o)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let a;return s?(a=o,Ds(t,e,n,r),Ms(t,n,o,r),iu(a)):u?(a=o,Ms(t,e,o,r),iu(a)):i?(a=n,Ds(t,e,n,r)):a=e,{meaningfulScript:a,type:s?"p2sh-p2wsh":i?"p2sh":u?"p2wsh":"raw"}}function iu(e){if((0,Os.isP2WPKH)(e)||(0,Os.isP2SHScript)(e))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function su(e){return(0,Os.isP2WPKH)(e)?"witnesspubkeyhash":(0,Os.isP2PKH)(e)?"pubkeyhash":(0,Os.isP2MS)(e)?"multisig":(0,Os.isP2PK)(e)?"pubkey":"nonstandard"}function uu(e){return[...Array(e).keys()]}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.initEccLib=e.Transaction=e.opcodes=e.Psbt=e.Block=e.script=e.payments=e.networks=e.crypto=e.address=void 0;const t=En();e.address=t;const r=Be;e.crypto=r;const n=b;e.networks=n;const o=mn();e.payments=o;const i=ue();e.script=i;var s=Sn;Object.defineProperty(e,"Block",{enumerable:!0,get:function(){return s.Block}});var u=Jn;Object.defineProperty(e,"Psbt",{enumerable:!0,get:function(){return u.Psbt}});var a=T;Object.defineProperty(e,"opcodes",{enumerable:!0,get:function(){return a.OPS}});var c=Tn;Object.defineProperty(e,"Transaction",{enumerable:!0,get:function(){return c.Transaction}});var f=Yr;Object.defineProperty(e,"initEccLib",{enumerable:!0,get:function(){return f.initEccLib}})}(r);var au={},cu={},fu={},hu={},pu={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hmac=e.HMAC=void 0;const t=He;class r extends t.Hash{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,(0,t.ahash)(e);const n=(0,t.toBytes)(r);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(n.length>o?e.create().update(n).digest():n);for(let t=0;t<i.length;t++)i[t]^=54;this.iHash.update(i),this.oHash=e.create();for(let t=0;t<i.length;t++)i[t]^=106;this.oHash.update(i),(0,t.clean)(i)}update(e){return(0,t.aexists)(this),this.iHash.update(e),this}digestInto(e){(0,t.aexists)(this),(0,t.abytes)(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:n,destroyed:o,blockLen:i,outputLen:s}=this;return e.finished=n,e.destroyed=o,e.blockLen=i,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}e.HMAC=r,e.hmac=(e,t,n)=>new r(e,t).update(n).digest(),e.hmac.create=(e,t)=>new r(e,t)}(pu);var lu={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.notImplemented=e.bitMask=e.utf8ToBytes=e.randomBytes=e.isBytes=e.hexToBytes=e.concatBytes=e.bytesToUtf8=e.bytesToHex=e.anumber=e.abytes=void 0,e.abool=function(e,t){if("boolean"!=typeof t)throw new Error(e+" boolean expected, got "+t)},e._abool2=function(e,t=""){if("boolean"!=typeof e)throw new Error((t&&`"${t}"`)+"expected boolean, got type="+typeof e);return e},e._abytes2=function(e,r,n=""){const o=(0,t.isBytes)(e),i=e?.length,s=void 0!==r;if(!o||s&&i!==r)throw new Error((n&&`"${n}" `)+"expected Uint8Array"+(s?` of length ${r}`:"")+", got "+(o?`length=${i}`:"type="+typeof e));return e},e.numberToHexUnpadded=i,e.hexToNumber=s,e.bytesToNumberBE=function(e){return s((0,t.bytesToHex)(e))},e.bytesToNumberLE=function(e){return(0,t.abytes)(e),s((0,t.bytesToHex)(Uint8Array.from(e).reverse()))},e.numberToBytesBE=u,e.numberToBytesLE=function(e,t){return u(e,t).reverse()},e.numberToVarBytesBE=function(e){return(0,t.hexToBytes)(i(e))},e.ensureBytes=function(e,r,n){let o;if("string"==typeof r)try{o=(0,t.hexToBytes)(r)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else{if(!(0,t.isBytes)(r))throw new Error(e+" must be hex string or Uint8Array");o=Uint8Array.from(r)}const i=o.length;if("number"==typeof n&&i!==n)throw new Error(e+" of length "+n+" expected, got "+i);return o},e.equalBytes=function(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r},e.copyBytes=function(e){return Uint8Array.from(e)},e.asciiToBytes=function(e){return Uint8Array.from(e,(t,r)=>{const n=t.charCodeAt(0);if(1!==t.length||n>127)throw new Error(`string contains non-ASCII character "${e[r]}" with code ${n} at position ${r}`);return n})},e.inRange=c,e.aInRange=function(e,t,r,n){if(!c(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)},e.bitLen=function(e){let t;for(t=0;e>n;e>>=o,t+=1);return t},e.bitGet=function(e,t){return e>>BigInt(t)&o},e.bitSet=function(e,t,r){return e|(r?o:n)<<BigInt(t)},e.createHmacDrbg=function(e,r,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof r||r<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");const o=e=>new Uint8Array(e),i=e=>Uint8Array.of(e);let s=o(e),u=o(e),a=0;const c=()=>{s.fill(1),u.fill(0),a=0},f=(...e)=>n(u,s,...e),h=(e=o(0))=>{u=f(i(0),e),s=f(),0!==e.length&&(u=f(i(1),e),s=f())},p=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<r;){s=f();const t=s.slice();n.push(t),e+=s.length}return(0,t.concatBytes)(...n)};return(e,t)=>{let r;for(c(),h(e);!(r=t(p()));)h();return c(),r}},e.validateObject=function(e,t,r={}){const n=(t,r,n)=>{const o=f[r];if("function"!=typeof o)throw new Error("invalid validator function");const i=e[t];if(!(n&&void 0===i||o(i,e)))throw new Error("param "+String(t)+" is invalid. Expected "+r+", got "+i)};for(const[o,i]of Object.entries(t))n(o,i,!1);for(const[o,i]of Object.entries(r))n(o,i,!0);return e},e.isHash=function(e){return"function"==typeof e&&Number.isSafeInteger(e.outputLen)},e._validateObject=function(e,t,r={}){if(!e||"object"!=typeof e)throw new Error("expected valid options object");function n(t,r,n){const o=e[t];if(n&&void 0===o)return;const i=typeof o;if(i!==r||null===o)throw new Error(`param "${t}" is invalid: expected ${r}, got ${i}`)}Object.entries(t).forEach(([e,t])=>n(e,t,!1)),Object.entries(r).forEach(([e,t])=>n(e,t,!0))},e.memoized=function(e){const t=new WeakMap;return(r,...n)=>{const o=t.get(r);if(void 0!==o)return o;const i=e(r,...n);return t.set(r,i),i}};const t=He;var r=He;Object.defineProperty(e,"abytes",{enumerable:!0,get:function(){return r.abytes}}),Object.defineProperty(e,"anumber",{enumerable:!0,get:function(){return r.anumber}}),Object.defineProperty(e,"bytesToHex",{enumerable:!0,get:function(){return r.bytesToHex}}),Object.defineProperty(e,"bytesToUtf8",{enumerable:!0,get:function(){return r.bytesToUtf8}}),Object.defineProperty(e,"concatBytes",{enumerable:!0,get:function(){return r.concatBytes}}),Object.defineProperty(e,"hexToBytes",{enumerable:!0,get:function(){return r.hexToBytes}}),Object.defineProperty(e,"isBytes",{enumerable:!0,get:function(){return r.isBytes}}),Object.defineProperty(e,"randomBytes",{enumerable:!0,get:function(){return r.randomBytes}}),Object.defineProperty(e,"utf8ToBytes",{enumerable:!0,get:function(){return r.utf8ToBytes}});const n=BigInt(0),o=BigInt(1);function i(e){const t=e.toString(16);return 1&t.length?"0"+t:t}function s(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?n:BigInt("0x"+e)}function u(e,r){return(0,t.hexToBytes)(e.toString(16).padStart(2*r,"0"))}const a=e=>"bigint"==typeof e&&n<=e;function c(e,t,r){return a(e)&&a(t)&&a(r)&&t<=e&&e<r}e.bitMask=e=>(o<<BigInt(e))-o;const f={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||(0,t.isBytes)(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};e.notImplemented=()=>{throw new Error("not implemented")}}(lu);var du={},yu={};Object.defineProperty(yu,"__esModule",{value:!0}),yu.isNegativeLE=void 0,yu.mod=Au,yu.pow=function(e,t,r){return Ru(Vu(r),e,t)},yu.pow2=function(e,t,r){let n=e;for(;t-- >gu;)n*=n,n%=r;return n},yu.invert=Bu,yu.tonelliShanks=Hu,yu.FpSqrt=Uu,yu.validateField=function(e){const t=Nu.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"});return(0,wu._validateObject)(e,t),e},yu.FpPow=Ru,yu.FpInvertBatch=Cu,yu.FpDiv=function(e,t,r){return e.mul(t,"bigint"==typeof r?Bu(r,e.ORDER):e.inv(r))},yu.FpLegendre=Lu,yu.FpIsSquare=function(e,t){return 1===Lu(e,t)},yu.nLength=Fu,yu.Field=Vu,yu.FpSqrtOdd=function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const r=e.sqrt(t);return e.isOdd(r)?r:e.neg(r)},yu.FpSqrtEven=function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const r=e.sqrt(t);return e.isOdd(r)?e.neg(r):r},yu.hashToPrivateScalar=function(e,t,r=!1){const n=(e=(0,wu.ensureBytes)("privateHash",e)).length,o=Fu(t).nByteLength+8;if(o<24||n<o||n>1024)throw new Error("hashToPrivateScalar: expected "+o+"-1024 bytes of input, got "+n);return Au(r?(0,wu.bytesToNumberLE)(e):(0,wu.bytesToNumberBE)(e),t-bu)+bu},yu.getFieldBytesLength=Du,yu.getMinHashLength=Mu,yu.mapHashToField=function(e,t,r=!1){const n=e.length,o=Du(t),i=Mu(t);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const s=Au(r?(0,wu.bytesToNumberLE)(e):(0,wu.bytesToNumberBE)(e),t-bu)+bu;return r?(0,wu.numberToBytesLE)(s,o):(0,wu.numberToBytesBE)(s,o)};const wu=lu,gu=BigInt(0),bu=BigInt(1),mu=BigInt(2),Eu=BigInt(3),Su=BigInt(4),vu=BigInt(5),Tu=BigInt(7),_u=BigInt(8),Iu=BigInt(9),Ou=BigInt(16);function Au(e,t){const r=e%t;return r>=gu?r:t+r}function Bu(e,t){if(e===gu)throw new Error("invert: expected non-zero number");if(t<=gu)throw new Error("invert: expected positive modulus, got "+t);let r=Au(e,t),n=t,o=gu,i=bu;for(;r!==gu;){const e=n%r,t=o-i*(n/r);n=r,r=e,o=i,i=t}if(n!==bu)throw new Error("invert: does not exist");return Au(o,t)}function ku(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function Pu(e,t){const r=(e.ORDER+bu)/Su,n=e.pow(t,r);return ku(e,n,t),n}function xu(e,t){const r=(e.ORDER-vu)/_u,n=e.mul(t,mu),o=e.pow(n,r),i=e.mul(t,o),s=e.mul(e.mul(i,mu),o),u=e.mul(i,e.sub(s,e.ONE));return ku(e,u,t),u}function Hu(e){if(e<Eu)throw new Error("sqrt is not defined for small field");let t=e-bu,r=0;for(;t%mu===gu;)t/=mu,r++;let n=mu;const o=Vu(e);for(;1===Lu(o,n);)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(1===r)return Pu;let i=o.pow(n,t);const s=(t+bu)/mu;return function(e,n){if(e.is0(n))return n;if(1!==Lu(e,n))throw new Error("Cannot find square root");let o=r,u=e.mul(e.ONE,i),a=e.pow(n,t),c=e.pow(n,s);for(;!e.eql(a,e.ONE);){if(e.is0(a))return e.ZERO;let t=1,r=e.sqr(a);for(;!e.eql(r,e.ONE);)if(t++,r=e.sqr(r),t===o)throw new Error("Cannot find square root");const n=bu<<BigInt(o-t-1),i=e.pow(u,n);o=t,u=e.sqr(i),a=e.mul(a,u),c=e.mul(c,i)}return c}}function Uu(e){return e%Su===Eu?Pu:e%_u===vu?xu:e%Ou===Iu?function(e){const t=Vu(e),r=Hu(e),n=r(t,t.neg(t.ONE)),o=r(t,n),i=r(t,t.neg(n)),s=(e+Tu)/Ou;return(e,t)=>{let r=e.pow(t,s),u=e.mul(r,n);const a=e.mul(r,o),c=e.mul(r,i),f=e.eql(e.sqr(u),t),h=e.eql(e.sqr(a),t);r=e.cmov(r,u,f),u=e.cmov(c,a,h);const p=e.eql(e.sqr(u),t),l=e.cmov(r,u,p);return ku(e,l,t),l}}(e):Hu(e)}yu.isNegativeLE=(e,t)=>(Au(e,t)&bu)===bu;const Nu=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ru(e,t,r){if(r<gu)throw new Error("invalid exponent, negatives unsupported");if(r===gu)return e.ONE;if(r===bu)return t;let n=e.ONE,o=t;for(;r>gu;)r&bu&&(n=e.mul(n,o)),o=e.sqr(o),r>>=bu;return n}function Cu(e,t,r=!1){const n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((t,r,o)=>e.is0(r)?t:(n[o]=t,e.mul(t,r)),e.ONE),i=e.inv(o);return t.reduceRight((t,r,o)=>e.is0(r)?t:(n[o]=e.mul(t,n[o]),e.mul(t,r)),i),n}function Lu(e,t){const r=(e.ORDER-bu)/mu,n=e.pow(t,r),o=e.eql(n,e.ONE),i=e.eql(n,e.ZERO),s=e.eql(n,e.neg(e.ONE));if(!o&&!i&&!s)throw new Error("invalid Legendre symbol result");return o?1:i?0:-1}function Fu(e,t){void 0!==t&&(0,wu.anumber)(t);const r=void 0!==t?t:e.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}function Vu(e,t,r=!1,n={}){if(e<=gu)throw new Error("invalid field: expected ORDER > 0, got "+e);let o,i,s,u=!1;if("object"==typeof t&&null!=t){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const e=t;e.BITS&&(o=e.BITS),e.sqrt&&(i=e.sqrt),"boolean"==typeof e.isLE&&(r=e.isLE),"boolean"==typeof e.modFromBytes&&(u=e.modFromBytes),s=e.allowedLengths}else"number"==typeof t&&(o=t),n.sqrt&&(i=n.sqrt);const{nBitLength:a,nByteLength:c}=Fu(e,o);if(c>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let f;const h=Object.freeze({ORDER:e,isLE:r,BITS:a,BYTES:c,MASK:(0,wu.bitMask)(a),ZERO:gu,ONE:bu,allowedLengths:s,create:t=>Au(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("invalid field element: expected bigint, got "+typeof t);return gu<=t&&t<e},is0:e=>e===gu,isValidNot0:e=>!h.is0(e)&&h.isValid(e),isOdd:e=>(e&bu)===bu,neg:t=>Au(-t,e),eql:(e,t)=>e===t,sqr:t=>Au(t*t,e),add:(t,r)=>Au(t+r,e),sub:(t,r)=>Au(t-r,e),mul:(t,r)=>Au(t*r,e),pow:(e,t)=>Ru(h,e,t),div:(t,r)=>Au(t*Bu(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>Bu(t,e),sqrt:i||(t=>(f||(f=Uu(e)),f(h,t))),toBytes:e=>r?(0,wu.numberToBytesLE)(e,c):(0,wu.numberToBytesBE)(e,c),fromBytes:(t,n=!0)=>{if(s){if(!s.includes(t.length)||t.length>c)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+t.length);const e=new Uint8Array(c);e.set(t,r?0:e.length-t.length),t=e}if(t.length!==c)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+t.length);let o=r?(0,wu.bytesToNumberLE)(t):(0,wu.bytesToNumberBE)(t);if(u&&(o=Au(o,e)),!n&&!h.isValid(o))throw new Error("invalid field element: outside of range 0..ORDER");return o},invertBatch:e=>Cu(h,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(h)}function Du(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Mu(e){const t=Du(e);return t+Math.ceil(t/2)}Object.defineProperty(du,"__esModule",{value:!0}),du.wNAF=void 0,du.negateCt=qu,du.normalizeZ=function(e,t){const r=(0,ju.FpInvertBatch)(e.Fp,t.map(e=>e.Z));return t.map((t,n)=>e.fromAffine(t.toAffine(r[n])))},du.mulEndoUnsafe=function(e,t,r,n){let o=t,i=e.ZERO,s=e.ZERO;for(;r>Gu||n>Gu;)r&Wu&&(i=i.add(o)),n&Wu&&(s=s.add(o)),o=o.double(),r>>=Wu,n>>=Wu;return{p1:i,p2:s}},du.pippenger=function(e,t,r,n){Yu(r,e),Zu(n,t);const o=r.length,i=n.length;if(o!==i)throw new Error("arrays of points and scalars must have equal length");const s=e.ZERO,u=(0,Ku.bitLen)(BigInt(o));let a=1;u>12?a=u-3:u>4?a=u-2:u>0&&(a=2);const c=(0,Ku.bitMask)(a),f=new Array(Number(c)+1).fill(s);let h=s;for(let p=Math.floor((t.BITS-1)/a)*a;p>=0;p-=a){f.fill(s);for(let t=0;t<i;t++){const e=n[t],o=Number(e>>BigInt(p)&c);f[o]=f[o].add(r[t])}let e=s;for(let t=f.length-1,r=s;t>0;t--)r=r.add(f[t]),e=e.add(r);if(h=h.add(e),0!==p)for(let t=0;t<a;t++)h=h.double()}return h},du.precomputeMSMUnsafe=function(e,t,r,n){Xu(n,t.BITS),Yu(r,e);const o=e.ZERO,i=2**n-1,s=Math.ceil(t.BITS/n),u=(0,Ku.bitMask)(n),a=r.map(e=>{const t=[];for(let r=0,n=e;r<i;r++)t.push(n),n=n.add(e);return t});return e=>{if(Zu(e,t),e.length>r.length)throw new Error("array of scalars must be smaller than array of points");let i=o;for(let t=0;t<s;t++){if(i!==o)for(let e=0;e<n;e++)i=i.double();const r=BigInt(s*n-(t+1)*n);for(let t=0;t<e.length;t++){const n=e[t],o=Number(n>>r&u);o&&(i=i.add(a[t][o-1]))}}return i}},du.validateBasic=function(e){return(0,ju.validateField)(e.Fp),(0,Ku.validateObject)(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,ju.nLength)(e.n,e.nBitLength),...e,p:e.Fp.ORDER})},du._createCurveFields=function(e,t,r={},n){if(void 0===n&&(n="edwards"===e),!t||"object"!=typeof t)throw new Error(`expected valid ${e} CURVE object`);for(const u of["p","n","h"]){const e=t[u];if(!("bigint"==typeof e&&e>Gu))throw new Error(`CURVE.${u} must be positive bigint`)}const o=ra(t.p,r.Fp,n),i=ra(t.n,r.Fn,n),s=["Gx","Gy","a","weierstrass"===e?"b":"d"];for(const u of s)if(!o.isValid(t[u]))throw new Error(`CURVE.${u} must be valid field element of CURVE.Fp`);return{CURVE:t=Object.freeze(Object.assign({},t)),Fp:o,Fn:i}};const Ku=lu,ju=yu,Gu=BigInt(0),Wu=BigInt(1);function qu(e,t){const r=t.negate();return e?r:t}function Xu(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function $u(e,t){Xu(e,t);const r=2**e;return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1),mask:(0,Ku.bitMask)(e),maxNumber:r,shiftBy:BigInt(e)}}function zu(e,t,r){const{windowSize:n,mask:o,maxNumber:i,shiftBy:s}=r;let u=Number(e&o),a=e>>s;u>n&&(u-=i,a+=Wu);const c=t*n;return{nextN:a,offset:c+Math.abs(u)-1,isZero:0===u,isNeg:u<0,isNegF:t%2!=0,offsetF:c}}function Yu(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw new Error("invalid point at index "+r)})}function Zu(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+r)})}const Ju=new WeakMap,Qu=new WeakMap;function ea(e){return Qu.get(e)||1}function ta(e){if(e!==Gu)throw new Error("invalid wNAF")}function ra(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return(0,ju.validateField)(t),t}return(0,ju.Field)(e,{isLE:r})}du.wNAF=class{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,r=this.ZERO){let n=e;for(;t>Gu;)t&Wu&&(r=r.add(n)),n=n.double(),t>>=Wu;return r}precomputeWindow(e,t){const{windows:r,windowSize:n}=$u(t,this.bits),o=[];let i=e,s=i;for(let u=0;u<r;u++){s=i,o.push(s);for(let e=1;e<n;e++)s=s.add(i),o.push(s);i=s.double()}return o}wNAF(e,t,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let n=this.ZERO,o=this.BASE;const i=$u(e,this.bits);for(let s=0;s<i.windows;s++){const{nextN:e,offset:u,isZero:a,isNeg:c,isNegF:f,offsetF:h}=zu(r,s,i);r=e,a?o=o.add(qu(f,t[h])):n=n.add(qu(c,t[u]))}return ta(r),{p:n,f:o}}wNAFUnsafe(e,t,r,n=this.ZERO){const o=$u(e,this.bits);for(let i=0;i<o.windows&&r!==Gu;i++){const{nextN:e,offset:s,isZero:u,isNeg:a}=zu(r,i,o);if(r=e,!u){const e=t[s];n=n.add(a?e.negate():e)}}return ta(r),n}getPrecomputes(e,t,r){let n=Ju.get(t);return n||(n=this.precomputeWindow(t,e),1!==e&&("function"==typeof r&&(n=r(n)),Ju.set(t,n))),n}cached(e,t,r){const n=ea(e);return this.wNAF(n,this.getPrecomputes(n,e,r),t)}unsafe(e,t,r,n){const o=ea(e);return 1===o?this._unsafeLadder(e,t,n):this.wNAFUnsafe(o,this.getPrecomputes(o,e,r),t,n)}createCache(e,t){Xu(t,this.bits),Qu.set(e,t),Ju.delete(e)}hasCache(e){return 1!==ea(e)}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DER=e.DERErr=void 0,e._splitEndoScalar=u,e._normFnElement=w,e.weierstrassN=g,e.SWUFpSqrtRatio=m,e.mapToCurveSimpleSWU=function(e,t){(0,i.validateField)(e);const{A:r,B:n,Z:o}=t;if(!e.isValid(r)||!e.isValid(n)||!e.isValid(o))throw new Error("mapToCurveSimpleSWU: invalid opts");const s=m(e,o);if(!e.isOdd)throw new Error("Field does not have .isOdd()");return t=>{let u,a,c,f,h,p,l,d;u=e.sqr(t),u=e.mul(u,o),a=e.sqr(u),a=e.add(a,u),c=e.add(a,e.ONE),c=e.mul(c,n),f=e.cmov(o,e.neg(a),!e.eql(a,e.ZERO)),f=e.mul(f,r),a=e.sqr(c),p=e.sqr(f),h=e.mul(p,r),a=e.add(a,h),a=e.mul(a,c),p=e.mul(p,f),h=e.mul(p,n),a=e.add(a,h),l=e.mul(u,c);const{isValid:y,value:w}=s(a,p);d=e.mul(u,t),d=e.mul(d,w),l=e.cmov(l,c,y),d=e.cmov(d,w,y);const g=e.isOdd(t)===e.isOdd(d);d=e.cmov(e.neg(d),d,g);const b=(0,i.FpInvertBatch)(e,[f],!0)[0];return l=e.mul(l,b),{x:l,y:d}}},e.ecdh=S,e.ecdsa=v,e.weierstrassPoints=function(e){const{CURVE:t,curveOpts:r}=T(e);return function(e,t){const{Fp:r,Fn:o}=t;const i=_(r,e.a,e.b);return Object.assign({},{CURVE:e,Point:t,ProjectivePoint:t,normPrivateKeyToScalar:e=>w(o,e),weierstrassEquation:i,isWithinCurveOrder:function(e){return(0,n.inRange)(e,p,o.ORDER)}})}(e,g(t,r))},e._legacyHelperEquat=_,e.weierstrass=function(e){const{CURVE:t,curveOpts:r,hash:n,ecdsaOpts:o}=function(e){const{CURVE:t,curveOpts:r}=T(e),n={hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:t,curveOpts:r,hash:e.hash,ecdsaOpts:n}}(e);return function(e,t){const r=t.Point;return Object.assign({},t,{ProjectivePoint:r,CURVE:Object.assign({},e,(0,i.nLength)(r.Fn.ORDER,r.Fn.BITS))})}(e,v(g(t,r),n,o))};const t=pu,r=He,n=lu,o=du,i=yu,s=(e,t)=>(e+(e>=0?t:-t)/l)/t;function u(e,t,r){const[[o,i],[u,a]]=t,c=s(a*e,r),f=s(-i*e,r);let l=e-c*o-f*u,d=-c*i-f*a;const y=l<h,w=d<h;y&&(l=-l),w&&(d=-d);const g=(0,n.bitMask)(Math.ceil((0,n.bitLen)(r)/2))+p;if(l<h||l>=g||d<h||d>=g)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:y,k1:l,k2neg:w,k2:d}}function a(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function c(e,t){const r={};for(let n of Object.keys(t))r[n]=void 0===e[n]?t[n]:e[n];return(0,n._abool2)(r.lowS,"lowS"),(0,n._abool2)(r.prehash,"prehash"),void 0!==r.format&&a(r.format),r}class f extends Error{constructor(e=""){super(e)}}e.DERErr=f,e.DER={Err:f,_tlv:{encode:(t,r)=>{const{Err:o}=e.DER;if(t<0||t>256)throw new o("tlv.encode: wrong tag");if(1&r.length)throw new o("tlv.encode: unpadded data");const i=r.length/2,s=(0,n.numberToHexUnpadded)(i);if(s.length/2&128)throw new o("tlv.encode: long form length too big");const u=i>127?(0,n.numberToHexUnpadded)(s.length/2|128):"";return(0,n.numberToHexUnpadded)(t)+u+s+r},decode(t,r){const{Err:n}=e.DER;let o=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(r.length<2||r[o++]!==t)throw new n("tlv.decode: wrong tlv");const i=r[o++];let s=0;if(128&i){const e=127&i;if(!e)throw new n("tlv.decode(long): indefinite length not supported");if(e>4)throw new n("tlv.decode(long): byte length is too big");const t=r.subarray(o,o+e);if(t.length!==e)throw new n("tlv.decode: length bytes not complete");if(0===t[0])throw new n("tlv.decode(long): zero leftmost byte");for(const r of t)s=s<<8|r;if(o+=e,s<128)throw new n("tlv.decode(long): not minimal encoding")}else s=i;const u=r.subarray(o,o+s);if(u.length!==s)throw new n("tlv.decode: wrong value length");return{v:u,l:r.subarray(o+s)}}},_int:{encode(t){const{Err:r}=e.DER;if(t<h)throw new r("integer: negative integers are not allowed");let o=(0,n.numberToHexUnpadded)(t);if(8&Number.parseInt(o[0],16)&&(o="00"+o),1&o.length)throw new r("unexpected DER parsing assertion: unpadded hex");return o},decode(t){const{Err:r}=e.DER;if(128&t[0])throw new r("invalid signature integer: negative");if(0===t[0]&&!(128&t[1]))throw new r("invalid signature integer: unnecessary leading zero");return(0,n.bytesToNumberBE)(t)}},toSig(t){const{Err:r,_int:o,_tlv:i}=e.DER,s=(0,n.ensureBytes)("signature",t),{v:u,l:a}=i.decode(48,s);if(a.length)throw new r("invalid signature: left bytes after parsing");const{v:c,l:f}=i.decode(2,u),{v:h,l:p}=i.decode(2,f);if(p.length)throw new r("invalid signature: left bytes after parsing");return{r:o.decode(c),s:o.decode(h)}},hexFromSig(t){const{_tlv:r,_int:n}=e.DER,o=r.encode(2,n.encode(t.r))+r.encode(2,n.encode(t.s));return r.encode(48,o)}};const h=BigInt(0),p=BigInt(1),l=BigInt(2),d=BigInt(3),y=BigInt(4);function w(e,t){const{BYTES:r}=e;let o;if("bigint"==typeof t)o=t;else{let s=(0,n.ensureBytes)("private key",t);try{o=e.fromBytes(s)}catch(i){throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof t}`)}}if(!e.isValidNot0(o))throw new Error("invalid private key: out of range [1..N-1]");return o}function g(e,t={}){const r=(0,o._createCurveFields)("weierstrass",e,t),{Fp:i,Fn:s}=r;let a=r.CURVE;const{h:c,n:f}=a;(0,n._validateObject)(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:l}=t;if(l&&(!i.is0(a.a)||"bigint"!=typeof l.beta||!Array.isArray(l.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const g=E(i,s);function m(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}const S=t.toBytes||function(e,t,r){const{x:o,y:s}=t.toAffine(),u=i.toBytes(o);if((0,n._abool2)(r,"isCompressed"),r){m();const e=!i.isOdd(s);return(0,n.concatBytes)(b(e),u)}return(0,n.concatBytes)(Uint8Array.of(4),u,i.toBytes(s))},v=t.fromBytes||function(e){(0,n._abytes2)(e,void 0,"Point");const{publicKey:t,publicKeyUncompressed:r}=g,o=e.length,s=e[0],u=e.subarray(1);if(o!==t||2!==s&&3!==s){if(o===r&&4===s){const e=i.BYTES,t=i.fromBytes(u.subarray(0,e)),r=i.fromBytes(u.subarray(e,2*e));if(!_(t,r))throw new Error("bad point: is not on curve");return{x:t,y:r}}throw new Error(`bad point: got length ${o}, expected compressed=${t} or uncompressed=${r}`)}{const e=i.fromBytes(u);if(!i.isValid(e))throw new Error("bad point: is not on curve, wrong x");const t=T(e);let r;try{r=i.sqrt(t)}catch(a){const e=a instanceof Error?": "+a.message:"";throw new Error("bad point: is not on curve, sqrt error"+e)}return m(),!(1&~s)!==i.isOdd(r)&&(r=i.neg(r)),{x:e,y:r}}};function T(e){const t=i.sqr(e),r=i.mul(t,e);return i.add(i.add(r,i.mul(e,a.a)),a.b)}function _(e,t){const r=i.sqr(t),n=T(e);return i.eql(r,n)}if(!_(a.Gx,a.Gy))throw new Error("bad curve params: generator point");const I=i.mul(i.pow(a.a,d),y),O=i.mul(i.sqr(a.b),BigInt(27));if(i.is0(i.add(I,O)))throw new Error("bad curve params: a or b");function A(e,t,r=!1){if(!i.isValid(t)||r&&i.is0(t))throw new Error(`bad point coordinate ${e}`);return t}function B(e){if(!(e instanceof U))throw new Error("ProjectivePoint expected")}function k(e){if(!l||!l.basises)throw new Error("no endo");return u(e,l.basises,s.ORDER)}const P=(0,n.memoized)((e,t)=>{const{X:r,Y:n,Z:o}=e;if(i.eql(o,i.ONE))return{x:r,y:n};const s=e.is0();null==t&&(t=s?i.ONE:i.inv(o));const u=i.mul(r,t),a=i.mul(n,t),c=i.mul(o,t);if(s)return{x:i.ZERO,y:i.ZERO};if(!i.eql(c,i.ONE))throw new Error("invZ was invalid");return{x:u,y:a}}),x=(0,n.memoized)(e=>{if(e.is0()){if(t.allowInfinityPoint&&!i.is0(e.Y))return;throw new Error("bad point: ZERO")}const{x:r,y:n}=e.toAffine();if(!i.isValid(r)||!i.isValid(n))throw new Error("bad point: x or y not field elements");if(!_(r,n))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function H(e,t,r,n,s){return r=new U(i.mul(r.X,e),r.Y,r.Z),t=(0,o.negateCt)(n,t),r=(0,o.negateCt)(s,r),t.add(r)}class U{constructor(e,t,r){this.X=A("x",e),this.Y=A("y",t,!0),this.Z=A("z",r),Object.freeze(this)}static CURVE(){return a}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!i.isValid(t)||!i.isValid(r))throw new Error("invalid affine point");if(e instanceof U)throw new Error("projective point not allowed");return i.is0(t)&&i.is0(r)?U.ZERO:new U(t,r,i.ONE)}static fromBytes(e){const t=U.fromAffine(v((0,n._abytes2)(e,void 0,"point")));return t.assertValidity(),t}static fromHex(e){return U.fromBytes((0,n.ensureBytes)("pointHex",e))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(e=8,t=!0){return R.createCache(this,e),t||this.multiply(d),this}assertValidity(){x(this)}hasEvenY(){const{y:e}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd(e)}equals(e){B(e);const{X:t,Y:r,Z:n}=this,{X:o,Y:s,Z:u}=e,a=i.eql(i.mul(t,u),i.mul(o,n)),c=i.eql(i.mul(r,u),i.mul(s,n));return a&&c}negate(){return new U(this.X,i.neg(this.Y),this.Z)}double(){const{a:e,b:t}=a,r=i.mul(t,d),{X:n,Y:o,Z:s}=this;let u=i.ZERO,c=i.ZERO,f=i.ZERO,h=i.mul(n,n),p=i.mul(o,o),l=i.mul(s,s),y=i.mul(n,o);return y=i.add(y,y),f=i.mul(n,s),f=i.add(f,f),u=i.mul(e,f),c=i.mul(r,l),c=i.add(u,c),u=i.sub(p,c),c=i.add(p,c),c=i.mul(u,c),u=i.mul(y,u),f=i.mul(r,f),l=i.mul(e,l),y=i.sub(h,l),y=i.mul(e,y),y=i.add(y,f),f=i.add(h,h),h=i.add(f,h),h=i.add(h,l),h=i.mul(h,y),c=i.add(c,h),l=i.mul(o,s),l=i.add(l,l),h=i.mul(l,y),u=i.sub(u,h),f=i.mul(l,p),f=i.add(f,f),f=i.add(f,f),new U(u,c,f)}add(e){B(e);const{X:t,Y:r,Z:n}=this,{X:o,Y:s,Z:u}=e;let c=i.ZERO,f=i.ZERO,h=i.ZERO;const p=a.a,l=i.mul(a.b,d);let y=i.mul(t,o),w=i.mul(r,s),g=i.mul(n,u),b=i.add(t,r),m=i.add(o,s);b=i.mul(b,m),m=i.add(y,w),b=i.sub(b,m),m=i.add(t,n);let E=i.add(o,u);return m=i.mul(m,E),E=i.add(y,g),m=i.sub(m,E),E=i.add(r,n),c=i.add(s,u),E=i.mul(E,c),c=i.add(w,g),E=i.sub(E,c),h=i.mul(p,m),c=i.mul(l,g),h=i.add(c,h),c=i.sub(w,h),h=i.add(w,h),f=i.mul(c,h),w=i.add(y,y),w=i.add(w,y),g=i.mul(p,g),m=i.mul(l,m),w=i.add(w,g),g=i.sub(y,g),g=i.mul(p,g),m=i.add(m,g),y=i.mul(w,m),f=i.add(f,y),y=i.mul(E,m),c=i.mul(b,c),c=i.sub(c,y),y=i.mul(b,w),h=i.mul(E,h),h=i.add(h,y),new U(c,f,h)}subtract(e){return this.add(e.negate())}is0(){return this.equals(U.ZERO)}multiply(e){const{endo:r}=t;if(!s.isValidNot0(e))throw new Error("invalid scalar: out of range");let n,i;const u=e=>R.cached(this,e,e=>(0,o.normalizeZ)(U,e));if(r){const{k1neg:t,k1:o,k2neg:s,k2:a}=k(e),{p:c,f}=u(o),{p:h,f:p}=u(a);i=f.add(p),n=H(r.beta,c,h,t,s)}else{const{p:t,f:r}=u(e);n=t,i=r}return(0,o.normalizeZ)(U,[n,i])[0]}multiplyUnsafe(e){const{endo:r}=t,n=this;if(!s.isValid(e))throw new Error("invalid scalar: out of range");if(e===h||n.is0())return U.ZERO;if(e===p)return n;if(R.hasCache(this))return this.multiply(e);if(r){const{k1neg:t,k1:i,k2neg:s,k2:u}=k(e),{p1:a,p2:c}=(0,o.mulEndoUnsafe)(U,n,i,u);return H(r.beta,a,c,t,s)}return R.unsafe(n,e)}multiplyAndAddUnsafe(e,t,r){const n=this.multiplyUnsafe(t).add(e.multiplyUnsafe(r));return n.is0()?void 0:n}toAffine(e){return P(this,e)}isTorsionFree(){const{isTorsionFree:e}=t;return c===p||(e?e(U,this):R.unsafe(this,f).is0())}clearCofactor(){const{clearCofactor:e}=t;return c===p?this:e?e(U,this):this.multiplyUnsafe(c)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}toBytes(e=!0){return(0,n._abool2)(e,"isCompressed"),this.assertValidity(),S(U,this,e)}toHex(e=!0){return(0,n.bytesToHex)(this.toBytes(e))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(e=!0){return this.toBytes(e)}_setWindowSize(e){this.precompute(e)}static normalizeZ(e){return(0,o.normalizeZ)(U,e)}static msm(e,t){return(0,o.pippenger)(U,s,e,t)}static fromPrivateKey(e){return U.BASE.multiply(w(s,e))}}U.BASE=new U(a.Gx,a.Gy,i.ONE),U.ZERO=new U(i.ZERO,i.ONE,i.ZERO),U.Fp=i,U.Fn=s;const N=s.BITS,R=new o.wNAF(U,t.endo?Math.ceil(N/2):N);return U.BASE.precompute(8),U}function b(e){return Uint8Array.of(e?2:3)}function m(e,t){const r=e.ORDER;let n=h;for(let d=r-p;d%l===h;d/=l)n+=p;const o=n,i=l<<o-p-p,s=i*l,u=(r-p)/s,a=(u-p)/l,c=s-p,f=i,w=e.pow(t,u),g=e.pow(t,(u+p)/l);let b=(t,r)=>{let n=w,i=e.pow(r,c),s=e.sqr(i);s=e.mul(s,r);let u=e.mul(t,s);u=e.pow(u,a),u=e.mul(u,i),i=e.mul(u,r),s=e.mul(u,t);let h=e.mul(s,i);u=e.pow(h,f);let d=e.eql(u,e.ONE);i=e.mul(s,g),u=e.mul(h,n),s=e.cmov(i,s,d),h=e.cmov(u,h,d);for(let a=o;a>p;a--){let t=a-l;t=l<<t-p;let r=e.pow(h,t);const o=e.eql(r,e.ONE);i=e.mul(s,n),n=e.mul(n,n),r=e.mul(h,n),s=e.cmov(i,s,o),h=e.cmov(r,h,o)}return{isValid:d,value:s}};if(e.ORDER%y===d){const r=(e.ORDER-d)/y,n=e.sqrt(e.neg(t));b=(t,o)=>{let i=e.sqr(o);const s=e.mul(t,o);i=e.mul(i,s);let u=e.pow(i,r);u=e.mul(u,s);const a=e.mul(u,n),c=e.mul(e.sqr(u),o),f=e.eql(c,t);return{isValid:f,value:e.cmov(a,u,f)}}}return b}function E(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function S(e,t={}){const{Fn:r}=e,o=t.randomBytes||n.randomBytes,s=Object.assign(E(e.Fp,r),{seed:(0,i.getMinHashLength)(r.ORDER)});function u(e){try{return!!w(r,e)}catch(t){return!1}}function a(e=o(s.seed)){return(0,i.mapHashToField)((0,n._abytes2)(e,s.seed,"seed"),r.ORDER)}function c(t,n=!0){return e.BASE.multiply(w(r,t)).toBytes(n)}function f(t){if("bigint"==typeof t)return!1;if(t instanceof e)return!0;const{secretKey:o,publicKey:i,publicKeyUncompressed:u}=s;if(r.allowedLengths||o===i)return;const a=(0,n.ensureBytes)("key",t).length;return a===i||a===u}const h={isValidSecretKey:u,isValidPublicKey:function(t,r){const{publicKey:n,publicKeyUncompressed:o}=s;try{const i=t.length;return!(!0===r&&i!==n||!1===r&&i!==o||!e.fromBytes(t))}catch(i){return!1}},randomSecretKey:a,isValidPrivateKey:u,randomPrivateKey:a,normPrivateKeyToScalar:e=>w(r,e),precompute:(t=8,r=e.BASE)=>r.precompute(t,!1)};return Object.freeze({getPublicKey:c,getSharedSecret:function(t,n,o=!0){if(!0===f(t))throw new Error("first arg must be private key");if(!1===f(n))throw new Error("second arg must be public key");const i=w(r,t);return e.fromHex(n).multiply(i).toBytes(o)},keygen:function(e){const t=a(e);return{secretKey:t,publicKey:c(t)}},Point:e,utils:h,lengths:s})}function v(o,i,s={}){(0,r.ahash)(i),(0,n._validateObject)(s,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const u=s.randomBytes||n.randomBytes,f=s.hmac||((e,...r)=>(0,t.hmac)(i,e,(0,n.concatBytes)(...r))),{Fp:d,Fn:y}=o,{ORDER:g,BITS:m}=y,{keygen:E,getPublicKey:v,getSharedSecret:T,utils:_,lengths:I}=S(o,s),O={prehash:!1,lowS:"boolean"==typeof s.lowS&&s.lowS,format:void 0,extraEntropy:!1},A="compact";function B(e){return e>g>>p}function k(e,t){if(!y.isValidNot0(t))throw new Error(`invalid signature ${e}: out of range 1..Point.Fn.ORDER`);return t}class P{constructor(e,t,r){this.r=k("r",e),this.s=k("s",t),null!=r&&(this.recovery=r),Object.freeze(this)}static fromBytes(t,r=A){let o;if(function(e,t){a(t);const r=I.signature,o="compact"===t?r:"recovered"===t?r+1:void 0;(0,n._abytes2)(e,o,`${t} signature`)}(t,r),"der"===r){const{r,s:o}=e.DER.toSig((0,n._abytes2)(t));return new P(r,o)}"recovered"===r&&(o=t[0],r="compact",t=t.subarray(1));const i=y.BYTES,s=t.subarray(0,i),u=t.subarray(i,2*i);return new P(y.fromBytes(s),y.fromBytes(u),o)}static fromHex(e,t){return this.fromBytes((0,n.hexToBytes)(e),t)}addRecoveryBit(e){return new P(this.r,this.s,e)}recoverPublicKey(e){const t=d.ORDER,{r,s:i,recovery:s}=this;if(null==s||![0,1,2,3].includes(s))throw new Error("recovery id invalid");if(g*l<t&&s>1)throw new Error("recovery id is ambiguous for h>1 curve");const u=2===s||3===s?r+g:r;if(!d.isValid(u))throw new Error("recovery id 2 or 3 invalid");const a=d.toBytes(u),c=o.fromBytes((0,n.concatBytes)(b(!(1&s)),a)),f=y.inv(u),h=H((0,n.ensureBytes)("msgHash",e)),p=y.create(-h*f),w=y.create(i*f),m=o.BASE.multiplyUnsafe(p).add(c.multiplyUnsafe(w));if(m.is0())throw new Error("point at infinify");return m.assertValidity(),m}hasHighS(){return B(this.s)}toBytes(t=A){if(a(t),"der"===t)return(0,n.hexToBytes)(e.DER.hexFromSig(this));const r=y.toBytes(this.r),o=y.toBytes(this.s);if("recovered"===t){if(null==this.recovery)throw new Error("recovery bit must be present");return(0,n.concatBytes)(Uint8Array.of(this.recovery),r,o)}return(0,n.concatBytes)(r,o)}toHex(e){return(0,n.bytesToHex)(this.toBytes(e))}assertValidity(){}static fromCompact(e){return P.fromBytes((0,n.ensureBytes)("sig",e),"compact")}static fromDER(e){return P.fromBytes((0,n.ensureBytes)("sig",e),"der")}normalizeS(){return this.hasHighS()?new P(this.r,y.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return(0,n.bytesToHex)(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return(0,n.bytesToHex)(this.toBytes("compact"))}}const x=s.bits2int||function(e){if(e.length>8192)throw new Error("input is too large");const t=(0,n.bytesToNumberBE)(e),r=8*e.length-m;return r>0?t>>BigInt(r):t},H=s.bits2int_modN||function(e){return y.create(x(e))},U=(0,n.bitMask)(m);function N(e){return(0,n.aInRange)("num < 2^"+m,e,h,U),y.toBytes(e)}function R(e,t){return(0,n._abytes2)(e,void 0,"message"),t?(0,n._abytes2)(i(e),void 0,"prehashed message"):e}return Object.freeze({keygen:E,getPublicKey:v,getSharedSecret:T,utils:_,lengths:I,Point:o,sign:function(e,t,r={}){e=(0,n.ensureBytes)("message",e);const{seed:s,k2sig:a}=function(e,t,r){if(["recovered","canonical"].some(e=>e in r))throw new Error("sign() legacy options not supported");const{lowS:i,prehash:s,extraEntropy:a}=c(r,O);e=R(e,s);const f=H(e),l=w(y,t),d=[N(l),N(f)];if(null!=a&&!1!==a){const e=!0===a?u(I.secretKey):a;d.push((0,n.ensureBytes)("extraEntropy",e))}const g=(0,n.concatBytes)(...d),b=f;return{seed:g,k2sig:function(e){const t=x(e);if(!y.isValidNot0(t))return;const r=y.inv(t),n=o.BASE.multiply(t).toAffine(),s=y.create(n.x);if(s===h)return;const u=y.create(r*y.create(b+s*l));if(u===h)return;let a=(n.x===s?0:2)|Number(n.y&p),c=u;return i&&B(u)&&(c=y.neg(u),a^=1),new P(s,c,a)}}}(e,t,r);return(0,n.createHmacDrbg)(i.outputLen,y.BYTES,f)(s,a)},verify:function(t,r,i,s={}){const{lowS:u,prehash:a,format:f}=c(s,O);if(i=(0,n.ensureBytes)("publicKey",i),r=R((0,n.ensureBytes)("message",r),a),"strict"in s)throw new Error("options.strict was renamed to lowS");const h=void 0===f?function(t){let r;const o="string"==typeof t||(0,n.isBytes)(t),i=!o&&null!==t&&"object"==typeof t&&"bigint"==typeof t.r&&"bigint"==typeof t.s;if(!o&&!i)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(i)r=new P(t.r,t.s);else if(o){try{r=P.fromBytes((0,n.ensureBytes)("sig",t),"der")}catch(s){if(!(s instanceof e.DER.Err))throw s}if(!r)try{r=P.fromBytes((0,n.ensureBytes)("sig",t),"compact")}catch(u){return!1}}return r||!1}(t):P.fromBytes((0,n.ensureBytes)("sig",t),f);if(!1===h)return!1;try{const e=o.fromBytes(i);if(u&&h.hasHighS())return!1;const{r:t,s:n}=h,s=H(r),a=y.inv(n),c=y.create(s*a),f=y.create(t*a),p=o.BASE.multiplyUnsafe(c).add(e.multiplyUnsafe(f));return!p.is0()&&y.create(p.x)===t}catch(p){return!1}},recoverPublicKey:function(e,t,r={}){const{prehash:n}=c(r,O);return t=R(t,n),P.fromBytes(e,"recovered").recoverPublicKey(t).toBytes()},Signature:P,hash:i})}function T(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp;let n=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(e=>Math.ceil(e/2)))):void 0;return{CURVE:t,curveOpts:{Fp:r,Fn:(0,i.Field)(t.n,{BITS:e.nBitLength,allowedLengths:n,modFromBytes:e.wrapPrivateKey}),allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes}}}function _(e,t,r){return function(n){const o=e.sqr(n),i=e.mul(o,n);return e.add(e.add(i,e.mul(n,t)),r)}}}(hu),Object.defineProperty(fu,"__esModule",{value:!0}),fu.getHash=function(e){return{hash:e}},fu.createCurve=function(e,t){const r=t=>(0,na.weierstrass)({...e,hash:t});return{...r(t),create:r}};const na=hu;var oa={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._DST_scalar=void 0,e.expand_message_xmd=a,e.expand_message_xof=c,e.hash_to_field=f,e.isogenyMap=function(e,t){const n=t.map(e=>Array.from(e).reverse());return(t,o)=>{const[i,s,u,a]=n.map(r=>r.reduce((r,n)=>e.add(e.mul(r,t),n))),[c,f]=(0,r.FpInvertBatch)(e,[s,a],!0);return t=e.mul(i,c),o=e.mul(o,e.mul(u,f)),{x:t,y:o}}},e.createHasher=function(t,r,n){if("function"!=typeof r)throw new Error("mapToCurve() must be defined");function o(e){return t.fromAffine(r(e))}function i(e){const r=e.clearCofactor();return r.equals(t.ZERO)?t.ZERO:(r.assertValidity(),r)}return{defaults:n,hashToCurve(e,t){const r=f(e,2,Object.assign({},n,t)),s=o(r[0]),u=o(r[1]);return i(s.add(u))},encodeToCurve(e,t){const r=n.encodeDST?{DST:n.encodeDST}:{};return i(o(f(e,1,Object.assign({},n,r,t))[0]))},mapToCurve(e){if(!Array.isArray(e))throw new Error("expected array of bigints");for(const t of e)if("bigint"!=typeof t)throw new Error("expected array of bigints");return i(o(e))},hashToScalar(r,o){const i=t.Fn.ORDER;return f(r,1,Object.assign({},n,{p:i,m:1,DST:e._DST_scalar},o))[0][0]}}};const t=lu,r=yu,n=t.bytesToNumberBE;function o(e,t){if(s(e),s(t),e<0||e>=1<<8*t)throw new Error("invalid I2OSP input: "+e);const r=Array.from({length:t}).fill(0);for(let n=t-1;n>=0;n--)r[n]=255&e,e>>>=8;return new Uint8Array(r)}function i(e,t){const r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t[n];return r}function s(e){if(!Number.isSafeInteger(e))throw new Error("number expected")}function u(e){if(!(0,t.isBytes)(e)&&"string"!=typeof e)throw new Error("DST must be Uint8Array or string");return"string"==typeof e?(0,t.utf8ToBytes)(e):e}function a(e,r,n,a){(0,t.abytes)(e),s(n),(r=u(r)).length>255&&(r=a((0,t.concatBytes)((0,t.utf8ToBytes)("H2C-OVERSIZE-DST-"),r)));const{outputLen:c,blockLen:f}=a,h=Math.ceil(n/c);if(n>65535||h>255)throw new Error("expand_message_xmd: invalid lenInBytes");const p=(0,t.concatBytes)(r,o(r.length,1)),l=o(0,f),d=o(n,2),y=new Array(h),w=a((0,t.concatBytes)(l,e,d,o(0,1),p));y[0]=a((0,t.concatBytes)(w,o(1,1),p));for(let s=1;s<=h;s++){const e=[i(w,y[s-1]),o(s+1,1),p];y[s]=a((0,t.concatBytes)(...e))}return(0,t.concatBytes)(...y).slice(0,n)}function c(e,r,n,i,a){if((0,t.abytes)(e),s(n),(r=u(r)).length>255){const e=Math.ceil(2*i/8);r=a.create({dkLen:e}).update((0,t.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(r).digest()}if(n>65535||r.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return a.create({dkLen:n}).update(e).update(o(n,2)).update(r).update(o(r.length,1)).digest()}function f(e,o,i){(0,t._validateObject)(i,{p:"bigint",m:"number",k:"number",hash:"function"});const{p:u,k:f,m:h,hash:p,expand:l,DST:d}=i;if(!(0,t.isHash)(i.hash))throw new Error("expected valid hash");(0,t.abytes)(e),s(o);const y=u.toString(2).length,w=Math.ceil((y+f)/8),g=o*h*w;let b;if("xmd"===l)b=a(e,d,g,p);else if("xof"===l)b=c(e,d,g,f,p);else{if("_internal_pass"!==l)throw new Error('expand must be "xmd" or "xof"');b=e}const m=new Array(o);for(let t=0;t<o;t++){const e=new Array(h);for(let o=0;o<h;o++){const i=w*(o+t*h),s=b.subarray(i,i+w);e[o]=(0,r.mod)(n(s),u)}m[t]=e}return m}e._DST_scalar=(0,t.utf8ToBytes)("HashToScalar-")}(oa),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.encodeToCurve=e.hashToCurve=e.secp256k1_hasher=e.schnorr=e.secp256k1=void 0;const t=ft,r=He,n=fu,o=oa,i=yu,s=hu,u=lu,a={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},c={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},f=BigInt(0),h=BigInt(1),p=BigInt(2),l=(0,i.Field)(a.p,{sqrt:function(e){const t=a.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),u=BigInt(23),c=BigInt(44),f=BigInt(88),h=e*e*e%t,d=h*h*e%t,y=(0,i.pow2)(d,r,t)*d%t,w=(0,i.pow2)(y,r,t)*d%t,g=(0,i.pow2)(w,p,t)*h%t,b=(0,i.pow2)(g,o,t)*g%t,m=(0,i.pow2)(b,s,t)*b%t,E=(0,i.pow2)(m,c,t)*m%t,S=(0,i.pow2)(E,f,t)*E%t,v=(0,i.pow2)(S,c,t)*m%t,T=(0,i.pow2)(v,r,t)*d%t,_=(0,i.pow2)(T,u,t)*b%t,I=(0,i.pow2)(_,n,t)*h%t,O=(0,i.pow2)(I,p,t);if(!l.eql(l.sqr(O),e))throw new Error("Cannot find square root");return O}});e.secp256k1=(0,n.createCurve)({...a,Fp:l,lowS:!0,endo:c},t.sha256);const d={};function y(e,...r){let n=d[e];if(void 0===n){const r=(0,t.sha256)((0,u.utf8ToBytes)(e));n=(0,u.concatBytes)(r,r),d[e]=n}return(0,t.sha256)((0,u.concatBytes)(n,...r))}const w=e=>e.toBytes(!0).slice(1),g=(()=>e.secp256k1.Point)(),b=e=>e%p===f;function m(e){const{Fn:t,BASE:r}=g,n=(0,s._normFnElement)(t,e),o=r.multiply(n);return{scalar:b(o.y)?n:t.neg(n),bytes:w(o)}}function E(e){const t=l;if(!t.isValidNot0(e))throw new Error("invalid x: Fail if x  p");const r=t.create(e*e),n=t.create(r*e+BigInt(7));let o=t.sqrt(n);b(o)||(o=t.neg(o));const i=g.fromAffine({x:e,y:o});return i.assertValidity(),i}const S=u.bytesToNumberBE;function v(...e){return g.Fn.create(S(y("BIP0340/challenge",...e)))}function T(e){return m(e).bytes}function _(e,t,n=(0,r.randomBytes)(32)){const{Fn:o}=g,i=(0,u.ensureBytes)("message",e),{bytes:s,scalar:a}=m(t),c=(0,u.ensureBytes)("auxRand",n,32),f=o.toBytes(a^S(y("BIP0340/aux",c))),h=y("BIP0340/nonce",f,s,i),{bytes:p,scalar:l}=m(h),d=v(p,s,i),w=new Uint8Array(64);if(w.set(p,0),w.set(o.toBytes(o.create(l+d*a)),32),!I(w,i,s))throw new Error("sign: Invalid signature produced");return w}function I(e,t,r){const{Fn:n,BASE:o}=g,i=(0,u.ensureBytes)("signature",e,64),s=(0,u.ensureBytes)("message",t),c=(0,u.ensureBytes)("publicKey",r,32);try{const e=E(S(c)),t=S(i.subarray(0,32));if(!(0,u.inRange)(t,h,a.p))return!1;const r=S(i.subarray(32,64));if(!(0,u.inRange)(r,h,a.n))return!1;const f=v(n.toBytes(t),w(e),s),p=o.multiplyUnsafe(r).add(e.multiplyUnsafe(n.neg(f))),{x:l,y:d}=p.toAffine();return!(p.is0()||!b(d)||l!==t)}catch(f){return!1}}e.schnorr=(()=>{const t=(e=(0,r.randomBytes)(48))=>(0,i.mapHashToField)(e,a.n);return e.secp256k1.utils.randomSecretKey,{keygen:function(e){const r=t(e);return{secretKey:r,publicKey:T(r)}},getPublicKey:T,sign:_,verify:I,Point:g,utils:{randomSecretKey:t,randomPrivateKey:t,taggedHash:y,lift_x:E,pointToBytes:w,numberToBytesBE:u.numberToBytesBE,bytesToNumberBE:u.bytesToNumberBE,mod:i.mod},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})();const O=(()=>(0,o.isogenyMap)(l,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(e=>BigInt(e)))))(),A=(()=>(0,s.mapToCurveSimpleSWU)(l,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:l.create(BigInt("-11"))}))();e.secp256k1_hasher=(0,o.createHasher)(e.secp256k1.Point,e=>{const{x:t,y:r}=A(l.create(e[0]));return O(t,r)},{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:l.ORDER,m:1,k:128,expand:"xmd",hash:t.sha256}),e.hashToCurve=e.secp256k1_hasher.hashToCurve,e.encodeToCurve=e.secp256k1_hasher.encodeToCurve}(cu);var ia={};Object.defineProperty(ia,"__esModule",{value:!0}),ia.isHash=ia.validateObject=ia.memoized=ia.notImplemented=ia.createHmacDrbg=ia.bitMask=ia.bitSet=ia.bitGet=ia.bitLen=ia.aInRange=ia.inRange=ia.asciiToBytes=ia.copyBytes=ia.equalBytes=ia.ensureBytes=ia.numberToVarBytesBE=ia.numberToBytesLE=ia.numberToBytesBE=ia.bytesToNumberLE=ia.bytesToNumberBE=ia.hexToNumber=ia.numberToHexUnpadded=ia.abool=ia.utf8ToBytes=ia.randomBytes=ia.isBytes=ia.hexToBytes=ia.concatBytes=ia.bytesToUtf8=ia.bytesToHex=ia.anumber=ia.abytes=void 0;const sa=lu;ia.abytes=sa.abytes,ia.anumber=sa.anumber,ia.bytesToHex=sa.bytesToHex,ia.bytesToUtf8=sa.bytesToUtf8,ia.concatBytes=sa.concatBytes,ia.hexToBytes=sa.hexToBytes,ia.isBytes=sa.isBytes,ia.randomBytes=sa.randomBytes,ia.utf8ToBytes=sa.utf8ToBytes,ia.abool=sa.abool,ia.numberToHexUnpadded=sa.numberToHexUnpadded,ia.hexToNumber=sa.hexToNumber,ia.bytesToNumberBE=sa.bytesToNumberBE,ia.bytesToNumberLE=sa.bytesToNumberLE,ia.numberToBytesBE=sa.numberToBytesBE,ia.numberToBytesLE=sa.numberToBytesLE,ia.numberToVarBytesBE=sa.numberToVarBytesBE,ia.ensureBytes=sa.ensureBytes,ia.equalBytes=sa.equalBytes,ia.copyBytes=sa.copyBytes,ia.asciiToBytes=sa.asciiToBytes,ia.inRange=sa.inRange,ia.aInRange=sa.aInRange,ia.bitLen=sa.bitLen,ia.bitGet=sa.bitGet,ia.bitSet=sa.bitSet,ia.bitMask=sa.bitMask,ia.createHmacDrbg=sa.createHmacDrbg,ia.notImplemented=sa.notImplemented,ia.memoized=sa.memoized,ia.validateObject=sa.validateObject,ia.isHash=sa.isHash;var ua=cu,aa=ia;function ca(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,Object.freeze(t)}var fa=ca(yu),ha=ca(aa);const pa=ua.secp256k1.ProjectivePoint,la="Expected Private",da="Expected Point",ya="Expected Tweak",wa="Expected Signature",ga="Expected Extra Data (32 bytes)",ba="Expected Scalar",ma=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,186,174,220,230,175,72,160,59,191,210,94,140,208,54,65,65]),Ea=new Uint8Array(32),Sa=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,69,81,35,25,80,183,95,196,64,45,161,114,47,201,186,238]),va=BigInt(1);function Ta(e,t){for(let r=0;r<32;++r)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function _a(e){return 0===Ta(e,Ea)}function Ia(e){return e instanceof Uint8Array&&32===e.length&&!(Ta(e,ma)>=0)}function Oa(e){return e instanceof Uint8Array&&64===e.length&&Ta(e.subarray(0,32),ma)<0&&Ta(e.subarray(32,64),ma)<0}function Aa(e){return e instanceof Uint8Array&&32===e.length}function Ba(e){return void 0===e||e instanceof Uint8Array&&32===e.length}function ka(e){let t;if("bigint"==typeof e)t=e;else if("number"==typeof e&&Number.isSafeInteger(e)&&e>=0)t=BigInt(e);else if("string"==typeof e){if(64!==e.length)throw new Error("Expected 32 bytes of private scalar");t=ha.hexToNumber(e)}else{if(!(e instanceof Uint8Array))throw new TypeError("Expected valid private scalar");if(32!==e.length)throw new Error("Expected 32 bytes of private scalar");t=ha.bytesToNumberBE(e)}if(t<0)throw new Error("Expected private scalar >= 0");return t}function Pa(e){return ua.secp256k1.utils.normPrivateKeyToScalar(e)}function xa(e,t,r){const n=Ra(e),o=ka(t),i=pa.BASE.multiplyAndAddUnsafe(n,o,va);if(!i)throw new Error("Tweaked point at infinity");return i.toRawBytes(r)}function Ha(e,t){return void 0===e?void 0===t||Fa(t):!!e}function Ua(e){try{return e()}catch(t){return null}}function Na(e){return ua.schnorr.utils.lift_x(ha.bytesToNumberBE(e))}function Ra(e){return 32===e.length?Na(e):pa.fromHex(e)}function Ca(e,t){if(32===e.length!==t)return!1;try{return t?!!Na(e):!!pa.fromHex(e)}catch(r){return!1}}function La(e){return Ca(e,!1)}function Fa(e){return Ca(e,!1)&&33===e.length}function Va(e){return ua.secp256k1.utils.isValidPrivateKey(e)}function Da(e){return Ca(e,!0)}function Ma(e){if(!La(e))throw new Error(da);return e.slice(1,33)}function Ka(e,t){if(!Va(e))throw new Error(la);return Ua(()=>ua.secp256k1.getPublicKey(e,Ha(t)))}var ja=au.isPoint=La,Ga=au.isPointCompressed=Fa,Wa=au.isPrivate=Va,qa=au.isXOnlyPoint=Da,Xa=au.pointAdd=function(e,t,r){if(!La(e)||!La(t))throw new Error(da);return Ua(()=>{const n=Ra(e),o=Ra(t);return n.equals(o.negate())?null:n.add(o).toRawBytes(Ha(r,e))})},$a=au.pointAddScalar=function(e,t,r){if(!La(e))throw new Error(da);if(!Ia(t))throw new Error(ya);return Ua(()=>xa(e,t,Ha(r,e)))},za=au.pointCompress=function(e,t){if(!La(e))throw new Error(da);return Ra(e).toRawBytes(Ha(t,e))},Ya=au.pointFromScalar=Ka,Za=au.pointMultiply=function(e,t,r){if(!La(e))throw new Error(da);if(!Ia(t))throw new Error(ya);return Ua(()=>function(e,t,r){const n=Ra(e),o="string"==typeof t?t:ha.bytesToHex(t),i=ha.hexToNumber(o);return n.multiply(i).toRawBytes(r)}(e,t,Ha(r,e)))},Ja=au.privateAdd=function(e,t){if(!Va(e))throw new Error(la);if(!Ia(t))throw new Error(ya);return Ua(()=>function(e,t){const r=Pa(e),n=ka(t),o=ha.numberToBytesBE(fa.mod(r+n,ua.secp256k1.CURVE.n),32);return ua.secp256k1.utils.isValidPrivateKey(o)?o:null}(e,t))},Qa=au.privateNegate=function(e){if(!Va(e))throw new Error(la);return function(e){const t=Pa(e),r=ha.numberToBytesBE(ua.secp256k1.CURVE.n-t,32);return ua.secp256k1.utils.isValidPrivateKey(r)?r:null}(e)},ec=au.privateSub=function(e,t){if(!Va(e))throw new Error(la);if(!Ia(t))throw new Error(ya);return Ua(()=>function(e,t){const r=Pa(e),n=ka(t),o=ha.numberToBytesBE(fa.mod(r-n,ua.secp256k1.CURVE.n),32);return ua.secp256k1.utils.isValidPrivateKey(o)?o:null}(e,t))},tc=au.recover=function(e,t,r,n){if(!Aa(e))throw new Error("Expected Hash");if(!Oa(t)||!function(e){return!(_a(e.subarray(0,32))||_a(e.subarray(32,64)))}(t))throw new Error(wa);if(2&r&&!function(e){return e instanceof Uint8Array&&64===e.length&&Ta(e.subarray(0,32),Sa)<0}(t))throw new Error("Bad Recovery Id");if(!Da(t.subarray(0,32)))throw new Error(wa);const o=ua.secp256k1.Signature.fromCompact(t).addRecoveryBit(r).recoverPublicKey(e);if(!o)throw new Error(wa);return o.toRawBytes(Ha(n))},rc=au.sign=function(e,t,r){if(!Va(t))throw new Error(la);if(!Aa(e))throw new Error(ba);if(!Ba(r))throw new Error(ga);return ua.secp256k1.sign(e,t,{extraEntropy:r}).toCompactRawBytes()},nc=au.signRecoverable=function(e,t,r){if(!Va(t))throw new Error(la);if(!Aa(e))throw new Error(ba);if(!Ba(r))throw new Error(ga);const n=ua.secp256k1.sign(e,t,{extraEntropy:r});return{signature:n.toCompactRawBytes(),recoveryId:n.recovery}},oc=au.signSchnorr=function(e,t,r){if(!Va(t))throw new Error(la);if(!Aa(e))throw new Error(ba);if(!Ba(r))throw new Error(ga);return ua.schnorr.sign(e,t,r)},ic=au.verify=function(e,t,r,n){if(!La(t))throw new Error(da);if(!Oa(r))throw new Error(wa);if(!Aa(e))throw new Error(ba);return ua.secp256k1.verify(r,e,t,{lowS:n})},sc=au.verifySchnorr=function(e,t,r){if(!Da(t))throw new Error(da);if(!Oa(r))throw new Error(wa);if(!Aa(e))throw new Error(ba);return ua.schnorr.verify(r,e,t)},uc=au.xOnlyPointAddTweak=function(e,t){if(!Da(e))throw new Error(da);if(!Ia(t))throw new Error(ya);return Ua(()=>{const r=xa(e,t,!0);return{parity:r[0]%2==1?1:0,xOnlyPubkey:r.slice(1)}})},ac=au.xOnlyPointFromPoint=Ma,cc=au.xOnlyPointFromScalar=function(e){if(!Va(e))throw new Error(la);return Ma(Ka(e))};const fc=e({__proto__:null,default:au,isPoint:ja,isPointCompressed:Ga,isPrivate:Wa,isXOnlyPoint:qa,pointAdd:Xa,pointAddScalar:$a,pointCompress:za,pointFromScalar:Ya,pointMultiply:Za,privateAdd:Ja,privateNegate:Qa,privateSub:ec,recover:tc,sign:rc,signRecoverable:nc,signSchnorr:oc,verify:ic,verifySchnorr:sc,xOnlyPointAddTweak:uc,xOnlyPointFromPoint:ac,xOnlyPointFromScalar:cc},[au]);export{y as B,fc as e,r as s};
