import{g as t}from"./bitcoin-utils-DDv8QE7C.js";/* empty css              */import{s as e,e as n}from"./bitcoin-CpxUx-D2.js";e.initEccLib(n);class a{constructor(t){this.canvas=document.getElementById(t),this.canvas&&(this.ctx=this.canvas.getContext("2d"),this.data=[],this.chartType="candles",this.period="24h",this.resize(),window.addEventListener("resize",()=>this.resize()))}resize(){if(!this.canvas)return;const t=this.canvas.parentElement.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height,this.draw()}generateFakeData(t){const e="24h"===t?24:"7d"===t?168:720,n=[];for(let a=0;a<e;a++){const t=.05,o=.1*Math.sin(a/10),r=(Math.random()-.5)*t,s=0===a?1.2:n[a-1].close,c=s*(1+o+r),l=Math.max(s,c)*(1+.02*Math.random()),i=Math.min(s,c)*(1-.02*Math.random());n.push({open:s,high:l,low:i,close:c,time:Date.now()-36e5*(e-a)})}this.data=n,this.draw()}draw(){if(!this.ctx||0===this.data.length)return;const{width:t,height:e}=this.canvas,n=this.ctx;n.fillStyle="rgba(5, 10, 5, 0.6)",n.fillRect(0,0,t,e);const a=this.data.flatMap(t=>[t.high,t.low]),o=.99*Math.min(...a),r=1.01*Math.max(...a),s=r-o,c={left:40,right:10,top:10,bottom:30},l=t-c.left-c.right,i=e-c.top-c.bottom;n.strokeStyle="rgba(42, 74, 42, 0.3)",n.lineWidth=1;for(let d=0;d<=4;d++){const e=c.top+i/4*d;n.beginPath(),n.moveTo(c.left,e),n.lineTo(t-c.right,e),n.stroke();const a=r-s/4*d;n.fillStyle="#888",n.font="10px IBM Plex Mono",n.textAlign="right",n.fillText(a.toFixed(3),c.left-5,e+4)}"candles"===this.chartType?this.drawCandles(n,c,l,i,o,s):this.drawLine(n,c,l,i,o,s)}drawCandles(t,e,n,a,o,r){const s=Math.max(2,n/this.data.length-2);this.data.forEach((c,l)=>{const i=e.left+n/this.data.length*l+(n/this.data.length-s)/2,d=e.top+a*(1-(c.open-o)/r),u=e.top+a*(1-(c.close-o)/r),h=e.top+a*(1-(c.high-o)/r),p=e.top+a*(1-(c.low-o)/r),m=c.close>=c.open;t.strokeStyle=m?"#66bb66":"#f97316",t.fillStyle=m?"rgba(102, 187, 102, 0.8)":"rgba(249, 115, 22, 0.8)",t.lineWidth=1,t.beginPath(),t.moveTo(i+s/2,h),t.lineTo(i+s/2,p),t.stroke();const g=Math.abs(u-d);t.fillRect(i,Math.min(d,u),s,Math.max(2,g))})}drawLine(t,e,n,a,o,r){t.strokeStyle="#66bb66",t.lineWidth=2,t.beginPath(),this.data.forEach((s,c)=>{const l=e.left+n/this.data.length*c,i=e.top+a*(1-(s.close-o)/r);0===c?t.moveTo(l,i):t.lineTo(l,i)}),t.stroke(),t.lineTo(e.left+n,e.top+a),t.lineTo(e.left,e.top+a),t.closePath(),t.fillStyle="rgba(102, 187, 102, 0.1)",t.fill()}setChartType(t){this.chartType=t,this.draw()}setPeriod(t){this.period=t,this.generateFakeData(t)}}let o={listings:[],myOrders:[],orderRecords:[],currentTab:"listed",sortBy:"price-low",wallet:{connected:!1,address:null,type:null},tokenData:{name:"OMR Token",ticker:"OMR",currentPrice:0,priceUsd:0,change24h:0,marketCap:0,volume24h:0,floorPrice:0,holders:0,totalSupply:0,totalTrades:0},currentBlock:0,chart:null};const r={btnConnect:document.getElementById("btnConnect"),btnConnectPanel:document.getElementById("btnConnectPanel"),btnLogout:document.getElementById("btnLogout"),statusText:document.getElementById("statusText"),currentBlock:document.getElementById("currentBlock"),tokenName:document.getElementById("tokenName"),tokenTicker:document.getElementById("tokenTicker"),currentPrice:document.getElementById("currentPrice"),priceUsd:document.getElementById("priceUsd"),priceChange:document.getElementById("priceChange"),marketCap:document.getElementById("marketCap"),volume24h:document.getElementById("volume24h"),floorPrice:document.getElementById("floorPrice"),holders:document.getElementById("holders"),totalSupply:document.getElementById("totalSupply"),totalTrades:document.getElementById("totalTrades"),tabListed:document.getElementById("tabListed"),tabRecords:document.getElementById("tabRecords"),tabMyOrders:document.getElementById("tabMyOrders"),sortDropdown:document.getElementById("sortDropdown"),listingsGrid:document.getElementById("listingsGrid"),swapButton:document.getElementById("swapButton")};async function s(){try{const t={name:"OMR Token",symbol:"OMR",holders:542,totalSupply:"21000000",floorPrice:"0.95",price:"1.2",priceUsd:"0.0012",change24h:15,volume24h:"1250000",marketCap:"25200000",totalTrades:20};o.tokenData={name:t.name,ticker:t.symbol,currentPrice:parseFloat(t.price),priceUsd:parseFloat(t.priceUsd),change24h:parseFloat(t.change24h),marketCap:parseFloat(t.marketCap),volume24h:parseFloat(t.volume24h),floorPrice:parseFloat(t.floorPrice),holders:parseInt(t.holders),totalSupply:parseFloat(t.totalSupply),totalTrades:parseInt(t.totalTrades)},p()}catch(t){p()}}async function c(){try{o.listings=l(),"listed"===o.currentTab&&m()}catch(t){o.listings=l(),m()}}function l(){const t=[],e=o.tokenData.currentPrice||1.2,n=[5e5,1e6,631424,1e5,25e4,75e4,2e6,5e4],a=["bc1p...huvs","bc1q...s2k6","bc1p...00tx","bc1q...xyz9","bc1p...abc5","bc1q...def2","bc1p...ghi8","bc1q...jkl3"];for(let o=0;o<12;o++){const r=n[o%n.length]+Math.floor(1e5*Math.random()),s=(e*(.95+.15*Math.random())).toFixed(2),c=Math.floor(r*s),l=(c/1e8).toFixed(8),i=(1e-6*c).toFixed(6);t.push({id:`listing-${o}`,amount:r,price:parseFloat(s),priceUsd:parseFloat(i),seller:a[o%a.length],satsAmount:c,btcValue:l,timestamp:Date.now()-36e5*o})}return t}async function i(){try{let t,e=localStorage.getItem("walletType");if(e||(e=await new Promise(t=>{const e=document.createElement("div");e.innerHTML='\n      <div id="walletModalOverlay" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);backdrop-filter:blur(5px);display:flex;justify-content:center;align-items:center;z-index:9999;">\n        <div style="background:rgba(10,20,10,0.95);border:2px solid #66bb66;border-radius:16px;padding:40px 30px;color:#d4ffd4;text-align:center;max-width:420px;width:90%;box-shadow:0 0 20px rgba(102,187,102,0.3);">\n          <h2 style="margin-bottom:20px;color:#66bb66;text-shadow:0 0 10px rgba(102,187,102,0.5);">ðŸ”— Select Wallet</h2>\n          <button id="chooseUnisat" style="width:80%;padding:14px;margin-bottom:12px;font-weight:700;background:linear-gradient(90deg,#f97316,#fb923c);border:none;border-radius:8px;color:#000;cursor:pointer;font-family:\'IBM Plex Mono\',monospace;">ðŸ¦Š Unisat</button>\n          <button id="chooseXverse" style="width:80%;padding:14px;font-weight:700;background:rgba(20,35,20,0.8);border:1px solid #66bb66;border-radius:8px;color:#d4ffd4;cursor:pointer;font-family:\'IBM Plex Mono\',monospace;">ðŸŒ€ Xverse</button>\n        </div>\n      </div>',document.body.appendChild(e);const n=e.querySelector("#walletModalOverlay");n.querySelector("#chooseUnisat").onclick=()=>{e.remove(),t("unisat")},n.querySelector("#chooseXverse").onclick=()=>{e.remove(),t("xverse")},n.addEventListener("click",a=>{a.target===n&&(e.remove(),t(null))})})),!e)return;if("unisat"===e)t=(await window.unisat.requestAccounts())[0];else if("xverse"===e){const e=window?.XverseProviders?.BitcoinProvider,n=await e.request("wallet_connect",{network:"Mainnet",addresses:["ordinals"],message:"Connect to OMR Marketplace"});t=n.result?.addresses?.find(t=>"ordinals"===t.purpose)?.address}localStorage.setItem("walletType",e),localStorage.setItem("taprootAddress",t),o.wallet={connected:!0,address:t,type:e},d()}catch(t){u()}}function d(){if(o.wallet.connected){const t=o.wallet.address;r.statusText.textContent=`âœ… Connected: ${t.slice(0,6)}...${t.slice(-6)}`,r.btnConnect.style.display="none",r.btnConnectPanel.style.display="none",r.btnLogout.style.display="inline-block"}}function u(){o.wallet={connected:!1,address:null,type:null},r.statusText.textContent="ðŸ”Œ Wallet not connected",r.btnConnect.style.display="inline-block",r.btnConnectPanel.style.display="inline-block",r.btnLogout.style.display="none"}function h(){["taprootAddress","walletType"].forEach(t=>localStorage.removeItem(t)),u()}function p(){const{name:t,ticker:e,currentPrice:n,priceUsd:a,change24h:s,marketCap:c,volume24h:l,floorPrice:i,holders:d,totalSupply:u,totalTrades:h}=o.tokenData;r.tokenName.textContent=t,r.tokenTicker.textContent=`${e} (Rune)`,r.currentPrice.textContent=n.toFixed(2),r.priceUsd.textContent=`$${a.toFixed(6)}`;const p=s>=0?"positive":"negative",m=s>=0?"+":"";r.priceChange.className=`price-change ${p}`,r.priceChange.textContent=`${m}${s.toFixed(2)}%`,r.marketCap.textContent=c.toLocaleString(),r.volume24h.textContent=l.toLocaleString(),r.floorPrice.textContent=`${i.toFixed(2)} sats`,r.holders.textContent=d.toLocaleString(),r.totalSupply.textContent=u.toLocaleString(),r.totalTrades.textContent=h.toLocaleString()}function m(){r.listingsGrid.innerHTML="";let t=[];switch(o.currentTab){case"listed":t=function(){const t=[...o.listings];switch(o.sortBy){case"price-low":t.sort((t,e)=>t.price-e.price);break;case"price-high":t.sort((t,e)=>e.price-t.price);break;case"amount-low":t.sort((t,e)=>t.amount-e.amount);break;case"amount-high":t.sort((t,e)=>e.amount-t.amount);break;case"newest":t.sort((t,e)=>e.timestamp-t.timestamp)}return t}();break;case"records":t=o.orderRecords;break;case"myOrders":t=o.myOrders}0!==t.length?t.forEach(t=>{r.listingsGrid.appendChild(function(t){const e=document.createElement("div");return e.className="listing-card",e.innerHTML=`\n    <div class="card-token">OMR</div>\n    <div class="card-amount">${t.amount.toLocaleString()}</div>\n    <div>\n      <span class="card-price">${t.price.toFixed(2)}</span>\n      <span class="card-price-unit">sats/OMR</span>\n    </div>\n    <div class="card-usd">$${t.priceUsd.toFixed(6)}</div>\n    <div class="card-seller">${t.seller}</div>\n    <div class="card-details">\n      <div>\n        <span class="card-sats-value">${t.satsAmount.toLocaleString()}</span>\n        <span class="card-sats"> sats</span>\n      </div>\n      <div class="card-btc">${t.btcValue} BTC</div>\n    </div>\n    <button class="btn-buy">Buy</button>\n  `,e.querySelector(".btn-buy").addEventListener("click",e=>{e.stopPropagation(),function(t){o.wallet.connected?window.confirm(`Buy ${t.amount.toLocaleString()} OMR for ${t.satsAmount.toLocaleString()} sats?\n\nPrice: ${t.price.toFixed(2)} sats/OMR\nSeller: ${t.seller}`)&&alert("Buy order placed! (Connect to your backend to process)"):alert("Please connect your wallet first")}(t)}),e}(t))}):r.listingsGrid.innerHTML=`\n      <div class="loading">\n        ${"myOrders"!==o.currentTab||o.wallet.connected?"No listings available":"Connect wallet to see your orders"}\n      </div>\n    `}function g(t){o.currentTab=t,document.querySelectorAll(".listing-tab").forEach(t=>t.classList.remove("active")),"listed"===t?r.tabListed.classList.add("active"):"records"===t?r.tabRecords.classList.add("active"):"myOrders"===t&&r.tabMyOrders.classList.add("active"),m()}async function y(){try{o.currentBlock=await t(),r.currentBlock.textContent=o.currentBlock.toLocaleString()}catch(e){}}!async function(){const t=localStorage.getItem("taprootAddress"),e=localStorage.getItem("walletType");t&&e&&(o.wallet={connected:!0,address:t,type:e},d()),o.chart=new a("priceChart"),o.chart.generateFakeData("24h"),r.btnConnect.addEventListener("click",i),r.btnConnectPanel.addEventListener("click",i),r.btnLogout.addEventListener("click",h),r.tabListed.addEventListener("click",()=>g("listed")),r.tabRecords.addEventListener("click",()=>g("records")),r.tabMyOrders.addEventListener("click",()=>g("myOrders")),r.sortDropdown.addEventListener("change",t=>{o.sortBy=t.target.value,m()}),document.querySelectorAll(".chart-tab").forEach(t=>{t.addEventListener("click",()=>{document.querySelectorAll(".chart-tab").forEach(t=>t.classList.remove("active")),t.classList.add("active");const e=t.dataset.type;o.chart&&o.chart.setChartType(e)})}),document.querySelectorAll(".time-tab").forEach(t=>{t.addEventListener("click",()=>{document.querySelectorAll(".time-tab").forEach(t=>t.classList.remove("active")),t.classList.add("active");const e=t.dataset.period;o.chart&&o.chart.setPeriod(e)})}),document.querySelector(".btn-list").addEventListener("click",()=>{o.wallet.connected?alert("List tokens dialog (implement your listing form)"):alert("Please connect your wallet to list tokens")}),document.querySelector(".btn-refresh").addEventListener("click",()=>{c()}),r.swapButton.addEventListener("click",()=>{o.wallet.connected?alert("Swap dialog (implement your swap functionality)"):alert("Please connect your wallet to swap")}),await y(),setInterval(y,3e4),await s(),await c(),setInterval(s,3e4),setInterval(c,3e4),setInterval(()=>{o.chart&&o.chart.generateFakeData(o.chart.period)},6e4)}();
